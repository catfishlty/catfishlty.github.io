<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Catfish</title><link>https://www.catfish.top/</link><description>Recent content on Catfish</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Fri, 23 Jul 2021 14:54:00 +0800</lastBuildDate><atom:link href="https://www.catfish.top/index.xml" rel="self" type="application/rss+xml"/><item><title>Kubernetes初探（十一）</title><link>https://www.catfish.top/p/k8s-basic-11/</link><pubDate>Fri, 23 Jul 2021 14:54:00 +0800</pubDate><guid>https://www.catfish.top/p/k8s-basic-11/</guid><description>&lt;img src="https://www.catfish.top/p/k8s-basic-11/kubernates.png" alt="Featured image of post Kubernetes初探（十一）" />&lt;blockquote>
&lt;p>Katacoda在线课：&lt;a class="link" href="https://www.katacoda.com/courses/kubernetes/helm-package-manager" target="_blank" rel="noopener"
>Helm Package Manager&lt;/a>&lt;/p>
&lt;p>本系列教程希望能通过交互式学习网站与传统方式结合，更高效、容易的学习知识。
本系列教程将使用 &lt;a class="link" href="https://www.katacoda.com" target="_blank" rel="noopener"
>Katacoda在线学习平台&lt;/a> 完成学习。&lt;/p>
&lt;/blockquote>
&lt;p>这个场景教你如何使用 &lt;em>Kubernetes&lt;/em> 的包管理器 &lt;em>Helm&lt;/em> 来部署 &lt;em>Redis&lt;/em>。 &lt;em>Helm&lt;/em> 简化了服务发现和部署到 &lt;em>Kubernetes&lt;/em> 集群的步骤。。&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>&amp;ldquo;Helm is the best way to find, share, and use software built for Kubernetes.&amp;quot;&lt;/strong>&lt;/p>
&lt;p>&lt;strong>&lt;em>Helm&lt;/em> 是查找、共享和使用为 &lt;em>Kubernetes&lt;/em> 构建的软件的最佳方式&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;p>更多细节可以前往官网：&lt;a class="link" href="http://www.helm.sh/" target="_blank" rel="noopener"
>http://www.helm.sh/&lt;/a>&lt;/p>
&lt;h2 id="安装-helm">安装 Helm&lt;/h2>
&lt;p>&lt;em>Helm&lt;/em> 是一个单独的二进制文件，用于管理将 &lt;em>Charts&lt;/em> 部署到 &lt;em>Kubernetes&lt;/em>。 &lt;em>Chart&lt;/em> 是 &lt;em>kubernetes&lt;/em> 应用的一个打包单元。&lt;em>Helm&lt;/em> 可以从 &lt;a class="link" href="https://github.com/kubernetes/helm/releases" target="_blank" rel="noopener"
>https://github.com/kubernetes/helm/releases&lt;/a> 下载。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ curl -LO https://storage.googleapis.com/kubernetes-helm/helm-v2.8.2-linux-amd64.tar.gz
% Total % Received % Xferd Average Speed Time Time Time Current
Dload Upload Total Spent Left Speed
&lt;span class="m">100&lt;/span> 14.2M &lt;span class="m">100&lt;/span> 14.2M &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> 19.4M &lt;span class="m">0&lt;/span> --:--:-- --:--:-- --:--:-- 19.4M
controlplane $ tar -xvf helm-v2.8.2-linux-amd64.tar.gz
linux-amd64/
linux-amd64/helm
linux-amd64/README.md
linux-amd64/LICENSE
controlplane $ mv linux-amd64/helm /usr/local/bin/
&lt;/code>&lt;/pre>&lt;/div>&lt;p>安装后，初始化更新本地缓存将最新的包与本地安装环境同步。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ helm init --stable-repo-url https://charts.helm.sh/stable
Creating /root/.helm
Creating /root/.helm/repository
Creating /root/.helm/repository/cache
Creating /root/.helm/repository/local
Creating /root/.helm/plugins
Creating /root/.helm/starters
Creating /root/.helm/cache/archive
Creating /root/.helm/repository/repositories.yaml
Adding stable repo with URL: https://charts.helm.sh/stable
Adding &lt;span class="nb">local&lt;/span> repo with URL: http://127.0.0.1:8879/charts
&lt;span class="nv">$HELM_HOME&lt;/span> has been configured at /root/.helm.
Tiller &lt;span class="o">(&lt;/span>the Helm server-side component&lt;span class="o">)&lt;/span> has been installed into your Kubernetes Cluster.
Please note: by default, Tiller is deployed with an insecure &lt;span class="s1">&amp;#39;allow unauthenticated users&amp;#39;&lt;/span> policy.
For more information on securing your installation see: https://docs.helm.sh/using_helm/#securing-your-helm-installation
Happy Helming!
controlplane $ helm repo update
Hang tight &lt;span class="k">while&lt;/span> we grab the latest from your chart repositories...
...Skip &lt;span class="nb">local&lt;/span> chart repository
...Successfully got an update from the &lt;span class="s2">&amp;#34;stable&amp;#34;&lt;/span> chart repository
Update Complete. ⎈ Happy Helming!⎈
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="搜索-chart">搜索 Chart&lt;/h2>
&lt;p>您现在可以开始部署软件。可以使用搜索命令查找可用图表 &lt;em>Chart&lt;/em> 。&lt;/p>
&lt;p>例如，要部署 Redis，我们需要找到一个 &lt;em>Redis&lt;/em> 的 &lt;em>Chart&lt;/em> 。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ helm search redis
NAME CHART VERSION APP VERSION DESCRIPTION
stable/prometheus-redis-exporter 3.5.1 1.3.4 DEPRECATED Prometheus exporter &lt;span class="k">for&lt;/span> Redis metrics
stable/redis 10.5.7 5.0.7 DEPRECATED Open source, advanced key-value stor...
stable/redis-ha 4.4.6 5.0.6 DEPRECATED - Highly available Kubernetes implem...
stable/sensu 0.2.5 0.28 DEPRECATED Sensu monitoring framework backed by..
&lt;/code>&lt;/pre>&lt;/div>&lt;p>通过 &lt;em>inspect&lt;/em> 命令，我们可以查看更多关于 &lt;em>stable/redis&lt;/em> 的信息，信息量很大。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ helm inspect stable/redis
apiVersion: v1
appVersion: 5.0.7
deprecated: &lt;span class="nb">true&lt;/span>
description: DEPRECATED Open source, advanced key-value store. It is often referred
to as a data structure server since keys can contain strings, hashes, lists, sets
and sorted sets.
engine: gotpl
home: http://redis.io/
icon: https://bitnami.com/assets/stacks/redis/img/redis-stack-220x234.png
keywords:
- redis
- keyvalue
- database
name: redis
sources:
- https://github.com/bitnami/bitnami-docker-redis
version: 10.5.7
---
&lt;span class="c1">## Global Docker image parameters&lt;/span>
&lt;span class="c1">## Please, note that this will override the image parameters, including dependencies, configured to use the global value&lt;/span>
&lt;span class="c1">## Current available global Docker image parameters: imageRegistry and imagePullSecrets&lt;/span>
&lt;span class="c1">##&lt;/span>
global:
&lt;span class="c1"># imageRegistry: myRegistryName&lt;/span>
&lt;span class="c1"># imagePullSecrets:&lt;/span>
&lt;span class="c1"># - myRegistryKeySecretName&lt;/span>
&lt;span class="c1"># storageClass: myStorageClass&lt;/span>
redis: &lt;span class="o">{}&lt;/span>
&lt;span class="c1">## Bitnami Redis image version&lt;/span>
&lt;span class="c1">## ref: https://hub.docker.com/r/bitnami/redis/tags/&lt;/span>
&lt;span class="c1">##&lt;/span>
image:
registry: docker.io
repository: bitnami/redis
&lt;span class="c1">## Bitnami Redis image tag&lt;/span>
&lt;span class="c1">## ref: https://github.com/bitnami/bitnami-docker-redis#supported-tags-and-respective-dockerfile-links&lt;/span>
&lt;span class="c1">##&lt;/span>
tag: 5.0.7-debian-10-r32
&lt;span class="c1">## Specify a imagePullPolicy&lt;/span>
&lt;span class="c1">## Defaults to &amp;#39;Always&amp;#39; if image tag is &amp;#39;latest&amp;#39;, else set to &amp;#39;IfNotPresent&amp;#39;&lt;/span>
&lt;span class="c1">## ref: http://kubernetes.io/docs/user-guide/images/#pre-pulling-images&lt;/span>
&lt;span class="c1">##&lt;/span>
pullPolicy: IfNotPresent
&lt;span class="c1">## Optionally specify an array of imagePullSecrets.&lt;/span>
&lt;span class="c1">## Secrets must be manually created in the namespace.&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># pullSecrets:&lt;/span>
&lt;span class="c1"># - myRegistryKeySecretName&lt;/span>
&lt;span class="c1">## String to partially override redis.fullname template (will maintain the release name)&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># nameOverride:&lt;/span>
&lt;span class="c1">## String to fully override redis.fullname template&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># fullnameOverride:&lt;/span>
&lt;span class="c1">## Cluster settings&lt;/span>
cluster:
enabled: &lt;span class="nb">true&lt;/span>
slaveCount: &lt;span class="m">2&lt;/span>
&lt;span class="c1">## Use redis sentinel in the redis pod. This will disable the master and slave services and&lt;/span>
&lt;span class="c1">## create one redis service with ports to the sentinel and the redis instances&lt;/span>
sentinel:
enabled: &lt;span class="nb">false&lt;/span>
&lt;span class="c1">## Require password authentication on the sentinel itself&lt;/span>
&lt;span class="c1">## ref: https://redis.io/topics/sentinel&lt;/span>
usePassword: &lt;span class="nb">true&lt;/span>
&lt;span class="c1">## Bitnami Redis Sentintel image version&lt;/span>
&lt;span class="c1">## ref: https://hub.docker.com/r/bitnami/redis-sentinel/tags/&lt;/span>
&lt;span class="c1">##&lt;/span>
image:
registry: docker.io
repository: bitnami/redis-sentinel
&lt;span class="c1">## Bitnami Redis image tag&lt;/span>
&lt;span class="c1">## ref: https://github.com/bitnami/bitnami-docker-redis-sentinel#supported-tags-and-respective-dockerfile-links&lt;/span>
&lt;span class="c1">##&lt;/span>
tag: 5.0.7-debian-10-r27
&lt;span class="c1">## Specify a imagePullPolicy&lt;/span>
&lt;span class="c1">## Defaults to &amp;#39;Always&amp;#39; if image tag is &amp;#39;latest&amp;#39;, else set to &amp;#39;IfNotPresent&amp;#39;&lt;/span>
&lt;span class="c1">## ref: http://kubernetes.io/docs/user-guide/images/#pre-pulling-images&lt;/span>
&lt;span class="c1">##&lt;/span>
pullPolicy: IfNotPresent
&lt;span class="c1">## Optionally specify an array of imagePullSecrets.&lt;/span>
&lt;span class="c1">## Secrets must be manually created in the namespace.&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># pullSecrets:&lt;/span>
&lt;span class="c1"># - myRegistryKeySecretName&lt;/span>
masterSet: mymaster
initialCheckTimeout: &lt;span class="m">5&lt;/span>
quorum: &lt;span class="m">2&lt;/span>
downAfterMilliseconds: &lt;span class="m">60000&lt;/span>
failoverTimeout: &lt;span class="m">18000&lt;/span>
parallelSyncs: &lt;span class="m">1&lt;/span>
port: &lt;span class="m">26379&lt;/span>
&lt;span class="c1">## Additional Redis configuration for the sentinel nodes&lt;/span>
&lt;span class="c1">## ref: https://redis.io/topics/config&lt;/span>
&lt;span class="c1">##&lt;/span>
configmap:
&lt;span class="c1">## Enable or disable static sentinel IDs for each replicas&lt;/span>
&lt;span class="c1">## If disabled each sentinel will generate a random id at startup&lt;/span>
&lt;span class="c1">## If enabled, each replicas will have a constant ID on each start-up&lt;/span>
&lt;span class="c1">##&lt;/span>
staticID: &lt;span class="nb">false&lt;/span>
&lt;span class="c1">## Configure extra options for Redis Sentinel liveness and readiness probes&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/#configure-probes)&lt;/span>
&lt;span class="c1">##&lt;/span>
livenessProbe:
enabled: &lt;span class="nb">true&lt;/span>
initialDelaySeconds: &lt;span class="m">5&lt;/span>
periodSeconds: &lt;span class="m">5&lt;/span>
timeoutSeconds: &lt;span class="m">5&lt;/span>
successThreshold: &lt;span class="m">1&lt;/span>
failureThreshold: &lt;span class="m">5&lt;/span>
readinessProbe:
enabled: &lt;span class="nb">true&lt;/span>
initialDelaySeconds: &lt;span class="m">5&lt;/span>
periodSeconds: &lt;span class="m">5&lt;/span>
timeoutSeconds: &lt;span class="m">1&lt;/span>
successThreshold: &lt;span class="m">1&lt;/span>
failureThreshold: &lt;span class="m">5&lt;/span>
&lt;span class="c1">## Redis Sentinel resource requests and limits&lt;/span>
&lt;span class="c1">## ref: http://kubernetes.io/docs/user-guide/compute-resources/&lt;/span>
&lt;span class="c1"># resources:&lt;/span>
&lt;span class="c1"># requests:&lt;/span>
&lt;span class="c1"># memory: 256Mi&lt;/span>
&lt;span class="c1"># cpu: 100m&lt;/span>
&lt;span class="c1">## Redis Sentinel Service properties&lt;/span>
service:
&lt;span class="c1">## Redis Sentinel Service type&lt;/span>
type: ClusterIP
sentinelPort: &lt;span class="m">26379&lt;/span>
redisPort: &lt;span class="m">6379&lt;/span>
&lt;span class="c1">## Specify the nodePort value for the LoadBalancer and NodePort service types.&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># sentinelNodePort:&lt;/span>
&lt;span class="c1"># redisNodePort:&lt;/span>
&lt;span class="c1">## Provide any additional annotations which may be required. This can be used to&lt;/span>
&lt;span class="c1">## set the LoadBalancer service type to internal only.&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer&lt;/span>
&lt;span class="c1">##&lt;/span>
annotations: &lt;span class="o">{}&lt;/span>
labels: &lt;span class="o">{}&lt;/span>
loadBalancerIP:
&lt;span class="c1">## Specifies the Kubernetes Cluster&amp;#39;s Domain Name.&lt;/span>
&lt;span class="c1">##&lt;/span>
clusterDomain: cluster.local
networkPolicy:
&lt;span class="c1">## Specifies whether a NetworkPolicy should be created&lt;/span>
&lt;span class="c1">##&lt;/span>
enabled: &lt;span class="nb">false&lt;/span>
&lt;span class="c1">## The Policy model to apply. When set to false, only pods with the correct&lt;/span>
&lt;span class="c1">## client label will have network access to the port Redis is listening&lt;/span>
&lt;span class="c1">## on. When true, Redis will accept connections from any source&lt;/span>
&lt;span class="c1">## (with the correct destination port).&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># allowExternal: true&lt;/span>
&lt;span class="c1">## Allow connections from other namespacess. Just set label for namespace and set label for pods (optional).&lt;/span>
&lt;span class="c1">##&lt;/span>
ingressNSMatchLabels: &lt;span class="o">{}&lt;/span>
ingressNSPodMatchLabels: &lt;span class="o">{}&lt;/span>
serviceAccount:
&lt;span class="c1">## Specifies whether a ServiceAccount should be created&lt;/span>
&lt;span class="c1">##&lt;/span>
create: &lt;span class="nb">false&lt;/span>
&lt;span class="c1">## The name of the ServiceAccount to use.&lt;/span>
&lt;span class="c1">## If not set and create is true, a name is generated using the fullname template&lt;/span>
name:
rbac:
&lt;span class="c1">## Specifies whether RBAC resources should be created&lt;/span>
&lt;span class="c1">##&lt;/span>
create: &lt;span class="nb">false&lt;/span>
role:
&lt;span class="c1">## Rules to create. It follows the role specification&lt;/span>
&lt;span class="c1"># rules:&lt;/span>
&lt;span class="c1"># - apiGroups:&lt;/span>
&lt;span class="c1"># - extensions&lt;/span>
&lt;span class="c1"># resources:&lt;/span>
&lt;span class="c1"># - podsecuritypolicies&lt;/span>
&lt;span class="c1"># verbs:&lt;/span>
&lt;span class="c1"># - use&lt;/span>
&lt;span class="c1"># resourceNames:&lt;/span>
&lt;span class="c1"># - gce.unprivileged&lt;/span>
rules: &lt;span class="o">[]&lt;/span>
&lt;span class="c1">## Redis pod Security Context&lt;/span>
securityContext:
enabled: &lt;span class="nb">true&lt;/span>
fsGroup: &lt;span class="m">1001&lt;/span>
runAsUser: &lt;span class="m">1001&lt;/span>
&lt;span class="c1">## sysctl settings for master and slave pods&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1">## Uncomment the setting below to increase the net.core.somaxconn value&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># sysctls:&lt;/span>
&lt;span class="c1"># - name: net.core.somaxconn&lt;/span>
&lt;span class="c1"># value: &amp;#34;10000&amp;#34;&lt;/span>
&lt;span class="c1">## Use password authentication&lt;/span>
usePassword: &lt;span class="nb">true&lt;/span>
&lt;span class="c1">## Redis password (both master and slave)&lt;/span>
&lt;span class="c1">## Defaults to a random 10-character alphanumeric string if not set and usePassword is true&lt;/span>
&lt;span class="c1">## ref: https://github.com/bitnami/bitnami-docker-redis#setting-the-server-password-on-first-run&lt;/span>
&lt;span class="c1">##&lt;/span>
password: &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;span class="c1">## Use existing secret (ignores previous password)&lt;/span>
&lt;span class="c1"># existingSecret:&lt;/span>
&lt;span class="c1">## Password key to be retrieved from Redis secret&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># existingSecretPasswordKey:&lt;/span>
&lt;span class="c1">## Mount secrets as files instead of environment variables&lt;/span>
usePasswordFile: &lt;span class="nb">false&lt;/span>
&lt;span class="c1">## Persist data to a persistent volume (Redis Master)&lt;/span>
persistence: &lt;span class="o">{}&lt;/span>
&lt;span class="c1">## A manually managed Persistent Volume and Claim&lt;/span>
&lt;span class="c1">## Requires persistence.enabled: true&lt;/span>
&lt;span class="c1">## If defined, PVC must be created manually before volume will be bound&lt;/span>
&lt;span class="c1"># existingClaim:&lt;/span>
&lt;span class="c1"># Redis port&lt;/span>
redisPort: &lt;span class="m">6379&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1">## Redis Master parameters&lt;/span>
&lt;span class="c1">##&lt;/span>
master:
&lt;span class="c1">## Redis command arguments&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1">## Can be used to specify command line arguments, for example:&lt;/span>
&lt;span class="c1">##&lt;/span>
command: &lt;span class="s2">&amp;#34;/run.sh&amp;#34;&lt;/span>
&lt;span class="c1">## Additional Redis configuration for the master nodes&lt;/span>
&lt;span class="c1">## ref: https://redis.io/topics/config&lt;/span>
&lt;span class="c1">##&lt;/span>
configmap:
&lt;span class="c1">## Redis additional command line flags&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1">## Can be used to specify command line flags, for example:&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1">## extraFlags:&lt;/span>
&lt;span class="c1">## - &amp;#34;--maxmemory-policy volatile-ttl&amp;#34;&lt;/span>
&lt;span class="c1">## - &amp;#34;--repl-backlog-size 1024mb&amp;#34;&lt;/span>
extraFlags: &lt;span class="o">[]&lt;/span>
&lt;span class="c1">## Comma-separated list of Redis commands to disable&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1">## Can be used to disable Redis commands for security reasons.&lt;/span>
&lt;span class="c1">## Commands will be completely disabled by renaming each to an empty string.&lt;/span>
&lt;span class="c1">## ref: https://redis.io/topics/security#disabling-of-specific-commands&lt;/span>
&lt;span class="c1">##&lt;/span>
disableCommands:
- FLUSHDB
- FLUSHALL
&lt;span class="c1">## Redis Master additional pod labels and annotations&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/&lt;/span>
podLabels: &lt;span class="o">{}&lt;/span>
podAnnotations: &lt;span class="o">{}&lt;/span>
&lt;span class="c1">## Redis Master resource requests and limits&lt;/span>
&lt;span class="c1">## ref: http://kubernetes.io/docs/user-guide/compute-resources/&lt;/span>
&lt;span class="c1"># resources:&lt;/span>
&lt;span class="c1"># requests:&lt;/span>
&lt;span class="c1"># memory: 256Mi&lt;/span>
&lt;span class="c1"># cpu: 100m&lt;/span>
&lt;span class="c1">## Use an alternate scheduler, e.g. &amp;#34;stork&amp;#34;.&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/tasks/administer-cluster/configure-multiple-schedulers/&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># schedulerName:&lt;/span>
&lt;span class="c1">## Configure extra options for Redis Master liveness and readiness probes&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/#configure-probes)&lt;/span>
&lt;span class="c1">##&lt;/span>
livenessProbe:
enabled: &lt;span class="nb">true&lt;/span>
initialDelaySeconds: &lt;span class="m">5&lt;/span>
periodSeconds: &lt;span class="m">5&lt;/span>
timeoutSeconds: &lt;span class="m">5&lt;/span>
successThreshold: &lt;span class="m">1&lt;/span>
failureThreshold: &lt;span class="m">5&lt;/span>
readinessProbe:
enabled: &lt;span class="nb">true&lt;/span>
initialDelaySeconds: &lt;span class="m">5&lt;/span>
periodSeconds: &lt;span class="m">5&lt;/span>
timeoutSeconds: &lt;span class="m">1&lt;/span>
successThreshold: &lt;span class="m">1&lt;/span>
failureThreshold: &lt;span class="m">5&lt;/span>
&lt;span class="c1">## Redis Master Node selectors and tolerations for pod assignment&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#taints-and-tolerations-beta-feature&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># nodeSelector: {&amp;#34;beta.kubernetes.io/arch&amp;#34;: &amp;#34;amd64&amp;#34;}&lt;/span>
&lt;span class="c1"># tolerations: []&lt;/span>
&lt;span class="c1">## Redis Master pod/node affinity/anti-affinity&lt;/span>
&lt;span class="c1">##&lt;/span>
affinity: &lt;span class="o">{}&lt;/span>
&lt;span class="c1">## Redis Master Service properties&lt;/span>
service:
&lt;span class="c1">## Redis Master Service type&lt;/span>
type: ClusterIP
port: &lt;span class="m">6379&lt;/span>
&lt;span class="c1">## Specify the nodePort value for the LoadBalancer and NodePort service types.&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># nodePort:&lt;/span>
&lt;span class="c1">## Provide any additional annotations which may be required. This can be used to&lt;/span>
&lt;span class="c1">## set the LoadBalancer service type to internal only.&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer&lt;/span>
&lt;span class="c1">##&lt;/span>
annotations: &lt;span class="o">{}&lt;/span>
labels: &lt;span class="o">{}&lt;/span>
loadBalancerIP:
&lt;span class="c1"># loadBalancerSourceRanges: [&amp;#34;10.0.0.0/8&amp;#34;]&lt;/span>
&lt;span class="c1">## Enable persistence using Persistent Volume Claims&lt;/span>
&lt;span class="c1">## ref: http://kubernetes.io/docs/user-guide/persistent-volumes/&lt;/span>
&lt;span class="c1">##&lt;/span>
persistence:
enabled: &lt;span class="nb">true&lt;/span>
&lt;span class="c1">## The path the volume will be mounted at, useful when using different&lt;/span>
&lt;span class="c1">## Redis images.&lt;/span>
path: /data
&lt;span class="c1">## The subdirectory of the volume to mount to, useful in dev environments&lt;/span>
&lt;span class="c1">## and one PV for multiple services.&lt;/span>
subPath: &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;span class="c1">## redis data Persistent Volume Storage Class&lt;/span>
&lt;span class="c1">## If defined, storageClassName: &amp;lt;storageClass&amp;gt;&lt;/span>
&lt;span class="c1">## If set to &amp;#34;-&amp;#34;, storageClassName: &amp;#34;&amp;#34;, which disables dynamic provisioning&lt;/span>
&lt;span class="c1">## If undefined (the default) or set to null, no storageClassName spec is&lt;/span>
&lt;span class="c1">## set, choosing the default provisioner. (gp2 on AWS, standard on&lt;/span>
&lt;span class="c1">## GKE, AWS &amp;amp; OpenStack)&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># storageClass: &amp;#34;-&amp;#34;&lt;/span>
accessModes:
- ReadWriteOnce
size: 8Gi
&lt;span class="c1">## Persistent Volume selectors&lt;/span>
&lt;span class="c1">## https://kubernetes.io/docs/concepts/storage/persistent-volumes/#selector&lt;/span>
matchLabels: &lt;span class="o">{}&lt;/span>
matchExpressions: &lt;span class="o">{}&lt;/span>
&lt;span class="c1">## Update strategy, can be set to RollingUpdate or onDelete by default.&lt;/span>
&lt;span class="c1">## https://kubernetes.io/docs/tutorials/stateful-application/basic-stateful-set/#updating-statefulsets&lt;/span>
statefulset:
updateStrategy: RollingUpdate
&lt;span class="c1">## Partition update strategy&lt;/span>
&lt;span class="c1">## https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#partitions&lt;/span>
&lt;span class="c1"># rollingUpdatePartition:&lt;/span>
&lt;span class="c1">## Redis Master pod priorityClassName&lt;/span>
&lt;span class="c1"># priorityClassName: {}&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1">## Redis Slave properties&lt;/span>
&lt;span class="c1">## Note: service.type is a mandatory parameter&lt;/span>
&lt;span class="c1">## The rest of the parameters are either optional or, if undefined, will inherit those declared in Redis Master&lt;/span>
&lt;span class="c1">##&lt;/span>
slave:
&lt;span class="c1">## Slave Service properties&lt;/span>
service:
&lt;span class="c1">## Redis Slave Service type&lt;/span>
type: ClusterIP
&lt;span class="c1">## Redis port&lt;/span>
port: &lt;span class="m">6379&lt;/span>
&lt;span class="c1">## Specify the nodePort value for the LoadBalancer and NodePort service types.&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># nodePort:&lt;/span>
&lt;span class="c1">## Provide any additional annotations which may be required. This can be used to&lt;/span>
&lt;span class="c1">## set the LoadBalancer service type to internal only.&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer&lt;/span>
&lt;span class="c1">##&lt;/span>
annotations: &lt;span class="o">{}&lt;/span>
labels: &lt;span class="o">{}&lt;/span>
loadBalancerIP:
&lt;span class="c1"># loadBalancerSourceRanges: [&amp;#34;10.0.0.0/8&amp;#34;]&lt;/span>
&lt;span class="c1">## Redis slave port&lt;/span>
port: &lt;span class="m">6379&lt;/span>
&lt;span class="c1">## Can be used to specify command line arguments, for example:&lt;/span>
&lt;span class="c1">##&lt;/span>
command: &lt;span class="s2">&amp;#34;/run.sh&amp;#34;&lt;/span>
&lt;span class="c1">## Additional Redis configuration for the slave nodes&lt;/span>
&lt;span class="c1">## ref: https://redis.io/topics/config&lt;/span>
&lt;span class="c1">##&lt;/span>
configmap:
&lt;span class="c1">## Redis extra flags&lt;/span>
extraFlags: &lt;span class="o">[]&lt;/span>
&lt;span class="c1">## List of Redis commands to disable&lt;/span>
disableCommands:
- FLUSHDB
- FLUSHALL
&lt;span class="c1">## Redis Slave pod/node affinity/anti-affinity&lt;/span>
&lt;span class="c1">##&lt;/span>
affinity: &lt;span class="o">{}&lt;/span>
&lt;span class="c1">## Configure extra options for Redis Slave liveness and readiness probes&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/#configure-probes)&lt;/span>
&lt;span class="c1">##&lt;/span>
livenessProbe:
enabled: &lt;span class="nb">true&lt;/span>
initialDelaySeconds: &lt;span class="m">30&lt;/span>
periodSeconds: &lt;span class="m">10&lt;/span>
timeoutSeconds: &lt;span class="m">5&lt;/span>
successThreshold: &lt;span class="m">1&lt;/span>
failureThreshold: &lt;span class="m">5&lt;/span>
readinessProbe:
enabled: &lt;span class="nb">true&lt;/span>
initialDelaySeconds: &lt;span class="m">5&lt;/span>
periodSeconds: &lt;span class="m">10&lt;/span>
timeoutSeconds: &lt;span class="m">10&lt;/span>
successThreshold: &lt;span class="m">1&lt;/span>
failureThreshold: &lt;span class="m">5&lt;/span>
&lt;span class="c1">## Redis slave Resource&lt;/span>
&lt;span class="c1"># resources:&lt;/span>
&lt;span class="c1"># requests:&lt;/span>
&lt;span class="c1"># memory: 256Mi&lt;/span>
&lt;span class="c1"># cpu: 100m&lt;/span>
&lt;span class="c1">## Redis slave selectors and tolerations for pod assignment&lt;/span>
&lt;span class="c1"># nodeSelector: {&amp;#34;beta.kubernetes.io/arch&amp;#34;: &amp;#34;amd64&amp;#34;}&lt;/span>
&lt;span class="c1"># tolerations: []&lt;/span>
&lt;span class="c1">## Use an alternate scheduler, e.g. &amp;#34;stork&amp;#34;.&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/tasks/administer-cluster/configure-multiple-schedulers/&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># schedulerName:&lt;/span>
&lt;span class="c1">## Redis slave pod Annotation and Labels&lt;/span>
podLabels: &lt;span class="o">{}&lt;/span>
podAnnotations: &lt;span class="o">{}&lt;/span>
&lt;span class="c1">## Redis slave pod priorityClassName&lt;/span>
&lt;span class="c1"># priorityClassName: {}&lt;/span>
&lt;span class="c1">## Enable persistence using Persistent Volume Claims&lt;/span>
&lt;span class="c1">## ref: http://kubernetes.io/docs/user-guide/persistent-volumes/&lt;/span>
&lt;span class="c1">##&lt;/span>
persistence:
enabled: &lt;span class="nb">true&lt;/span>
&lt;span class="c1">## The path the volume will be mounted at, useful when using different&lt;/span>
&lt;span class="c1">## Redis images.&lt;/span>
path: /data
&lt;span class="c1">## The subdirectory of the volume to mount to, useful in dev environments&lt;/span>
&lt;span class="c1">## and one PV for multiple services.&lt;/span>
subPath: &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;span class="c1">## redis data Persistent Volume Storage Class&lt;/span>
&lt;span class="c1">## If defined, storageClassName: &amp;lt;storageClass&amp;gt;&lt;/span>
&lt;span class="c1">## If set to &amp;#34;-&amp;#34;, storageClassName: &amp;#34;&amp;#34;, which disables dynamic provisioning&lt;/span>
&lt;span class="c1">## If undefined (the default) or set to null, no storageClassName spec is&lt;/span>
&lt;span class="c1">## set, choosing the default provisioner. (gp2 on AWS, standard on&lt;/span>
&lt;span class="c1">## GKE, AWS &amp;amp; OpenStack)&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># storageClass: &amp;#34;-&amp;#34;&lt;/span>
accessModes:
- ReadWriteOnce
size: 8Gi
&lt;span class="c1">## Persistent Volume selectors&lt;/span>
&lt;span class="c1">## https://kubernetes.io/docs/concepts/storage/persistent-volumes/#selector&lt;/span>
matchLabels: &lt;span class="o">{}&lt;/span>
matchExpressions: &lt;span class="o">{}&lt;/span>
&lt;span class="c1">## Update strategy, can be set to RollingUpdate or onDelete by default.&lt;/span>
&lt;span class="c1">## https://kubernetes.io/docs/tutorials/stateful-application/basic-stateful-set/#updating-statefulsets&lt;/span>
statefulset:
updateStrategy: RollingUpdate
&lt;span class="c1">## Partition update strategy&lt;/span>
&lt;span class="c1">## https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#partitions&lt;/span>
&lt;span class="c1"># rollingUpdatePartition:&lt;/span>
&lt;span class="c1">## Prometheus Exporter / Metrics&lt;/span>
&lt;span class="c1">##&lt;/span>
metrics:
enabled: &lt;span class="nb">false&lt;/span>
image:
registry: docker.io
repository: bitnami/redis-exporter
tag: 1.4.0-debian-10-r3
pullPolicy: IfNotPresent
&lt;span class="c1">## Optionally specify an array of imagePullSecrets.&lt;/span>
&lt;span class="c1">## Secrets must be manually created in the namespace.&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># pullSecrets:&lt;/span>
&lt;span class="c1"># - myRegistryKeySecretName&lt;/span>
&lt;span class="c1">## Metrics exporter resource requests and limits&lt;/span>
&lt;span class="c1">## ref: http://kubernetes.io/docs/user-guide/compute-resources/&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># resources: {}&lt;/span>
&lt;span class="c1">## Extra arguments for Metrics exporter, for example:&lt;/span>
&lt;span class="c1">## extraArgs:&lt;/span>
&lt;span class="c1">## check-keys: myKey,myOtherKey&lt;/span>
&lt;span class="c1"># extraArgs: {}&lt;/span>
&lt;span class="c1">## Metrics exporter pod Annotation and Labels&lt;/span>
podAnnotations:
prometheus.io/scrape: &lt;span class="s2">&amp;#34;true&amp;#34;&lt;/span>
prometheus.io/port: &lt;span class="s2">&amp;#34;9121&amp;#34;&lt;/span>
&lt;span class="c1"># podLabels: {}&lt;/span>
&lt;span class="c1"># Enable this if you&amp;#39;re using https://github.com/coreos/prometheus-operator&lt;/span>
serviceMonitor:
enabled: &lt;span class="nb">false&lt;/span>
&lt;span class="c1">## Specify a namespace if needed&lt;/span>
&lt;span class="c1"># namespace: monitoring&lt;/span>
&lt;span class="c1"># fallback to the prometheus default unless specified&lt;/span>
&lt;span class="c1"># interval: 10s&lt;/span>
&lt;span class="c1">## Defaults to what&amp;#39;s used if you follow CoreOS [Prometheus Install Instructions](https://github.com/helm/charts/tree/master/stable/prometheus-operator#tldr)&lt;/span>
&lt;span class="c1">## [Prometheus Selector Label](https://github.com/helm/charts/tree/master/stable/prometheus-operator#prometheus-operator-1)&lt;/span>
&lt;span class="c1">## [Kube Prometheus Selector Label](https://github.com/helm/charts/tree/master/stable/prometheus-operator#exporters)&lt;/span>
selector:
prometheus: kube-prometheus
&lt;span class="c1">## Custom PrometheusRule to be defined&lt;/span>
&lt;span class="c1">## The value is evaluated as a template, so, for example, the value can depend on .Release or .Chart&lt;/span>
&lt;span class="c1">## ref: https://github.com/coreos/prometheus-operator#customresourcedefinitions&lt;/span>
prometheusRule:
enabled: &lt;span class="nb">false&lt;/span>
additionalLabels: &lt;span class="o">{}&lt;/span>
namespace: &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
rules: &lt;span class="o">[]&lt;/span>
&lt;span class="c1">## These are just examples rules, please adapt them to your needs.&lt;/span>
&lt;span class="c1">## Make sure to constraint the rules to the current postgresql service.&lt;/span>
&lt;span class="c1"># - alert: RedisDown&lt;/span>
&lt;span class="c1"># expr: redis_up{service=&amp;#34;{{ template &amp;#34;redis.fullname&amp;#34; . }}-metrics&amp;#34;} == 0&lt;/span>
&lt;span class="c1"># for: 2m&lt;/span>
&lt;span class="c1"># labels:&lt;/span>
&lt;span class="c1"># severity: error&lt;/span>
&lt;span class="c1"># annotations:&lt;/span>
&lt;span class="c1"># summary: Redis instance {{ &amp;#34;{{ $instance }}&amp;#34; }} down&lt;/span>
&lt;span class="c1"># description: Redis instance {{ &amp;#34;{{ $instance }}&amp;#34; }} is down.&lt;/span>
&lt;span class="c1"># - alert: RedisMemoryHigh&lt;/span>
&lt;span class="c1"># expr: &amp;gt;&lt;/span>
&lt;span class="c1"># redis_memory_used_bytes{service=&amp;#34;{{ template &amp;#34;redis.fullname&amp;#34; . }}-metrics&amp;#34;} * 100&lt;/span>
&lt;span class="c1"># /&lt;/span>
&lt;span class="c1"># redis_memory_max_bytes{service=&amp;#34;{{ template &amp;#34;redis.fullname&amp;#34; . }}-metrics&amp;#34;}&lt;/span>
&lt;span class="c1"># &amp;gt; 90 =&amp;lt; 100&lt;/span>
&lt;span class="c1"># for: 2m&lt;/span>
&lt;span class="c1"># labels:&lt;/span>
&lt;span class="c1"># severity: error&lt;/span>
&lt;span class="c1"># annotations:&lt;/span>
&lt;span class="c1"># summary: Redis instance {{ &amp;#34;{{ $instance }}&amp;#34; }} is using too much memory&lt;/span>
&lt;span class="c1"># description: Redis instance {{ &amp;#34;{{ $instance }}&amp;#34; }} is using {{ &amp;#34;{{ $value }}&amp;#34; }}% of its available memory.&lt;/span>
&lt;span class="c1"># - alert: RedisKeyEviction&lt;/span>
&lt;span class="c1"># expr: increase(redis_evicted_keys_total{service=&amp;#34;{{ template &amp;#34;redis.fullname&amp;#34; . }}-metrics&amp;#34;}[5m]) &amp;gt; 0&lt;/span>
&lt;span class="c1"># for: 1s&lt;/span>
&lt;span class="c1"># labels:&lt;/span>
&lt;span class="c1"># severity: error&lt;/span>
&lt;span class="c1"># annotations:&lt;/span>
&lt;span class="c1"># summary: Redis instance {{ &amp;#34;{{ $instance }}&amp;#34; }} has evicted keys&lt;/span>
&lt;span class="c1"># description: Redis instance {{ &amp;#34;{{ $instance }}&amp;#34; }} has evicted {{ &amp;#34;{{ $value }}&amp;#34; }} keys in the last 5 minutes.&lt;/span>
&lt;span class="c1">## Metrics exporter pod priorityClassName&lt;/span>
&lt;span class="c1"># priorityClassName: {}&lt;/span>
service:
type: ClusterIP
&lt;span class="c1">## Use serviceLoadBalancerIP to request a specific static IP,&lt;/span>
&lt;span class="c1">## otherwise leave blank&lt;/span>
&lt;span class="c1"># loadBalancerIP:&lt;/span>
annotations: &lt;span class="o">{}&lt;/span>
labels: &lt;span class="o">{}&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1">## Init containers parameters:&lt;/span>
&lt;span class="c1">## volumePermissions: Change the owner of the persist volume mountpoint to RunAsUser:fsGroup&lt;/span>
&lt;span class="c1">##&lt;/span>
volumePermissions:
enabled: &lt;span class="nb">false&lt;/span>
image:
registry: docker.io
repository: bitnami/minideb
tag: buster
pullPolicy: Always
&lt;span class="c1">## Optionally specify an array of imagePullSecrets.&lt;/span>
&lt;span class="c1">## Secrets must be manually created in the namespace.&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># pullSecrets:&lt;/span>
&lt;span class="c1"># - myRegistryKeySecretName&lt;/span>
resources: &lt;span class="o">{}&lt;/span>
&lt;span class="c1"># resources:&lt;/span>
&lt;span class="c1"># requests:&lt;/span>
&lt;span class="c1"># memory: 128Mi&lt;/span>
&lt;span class="c1"># cpu: 100m&lt;/span>
&lt;span class="c1">## Redis config file&lt;/span>
&lt;span class="c1">## ref: https://redis.io/topics/config&lt;/span>
&lt;span class="c1">##&lt;/span>
configmap: &lt;span class="p">|&lt;/span>-
&lt;span class="c1"># Enable AOF https://redis.io/topics/persistence#append-only-file&lt;/span>
appendonly yes
&lt;span class="c1"># Disable RDB persistence, AOF persistence already enabled.&lt;/span>
save &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;span class="c1">## Sysctl InitContainer&lt;/span>
&lt;span class="c1">## used to perform sysctl operation to modify Kernel settings (needed sometimes to avoid warnings)&lt;/span>
sysctlImage:
enabled: &lt;span class="nb">false&lt;/span>
command: &lt;span class="o">[]&lt;/span>
registry: docker.io
repository: bitnami/minideb
tag: buster
pullPolicy: Always
&lt;span class="c1">## Optionally specify an array of imagePullSecrets.&lt;/span>
&lt;span class="c1">## Secrets must be manually created in the namespace.&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/&lt;/span>
&lt;span class="c1">##&lt;/span>
&lt;span class="c1"># pullSecrets:&lt;/span>
&lt;span class="c1"># - myRegistryKeySecretName&lt;/span>
mountHostSys: &lt;span class="nb">false&lt;/span>
resources: &lt;span class="o">{}&lt;/span>
&lt;span class="c1"># resources:&lt;/span>
&lt;span class="c1"># requests:&lt;/span>
&lt;span class="c1"># memory: 128Mi&lt;/span>
&lt;span class="c1"># cpu: 100m&lt;/span>
&lt;span class="c1">## PodSecurityPolicy configuration&lt;/span>
&lt;span class="c1">## ref: https://kubernetes.io/docs/concepts/policy/pod-security-policy/&lt;/span>
&lt;span class="c1">##&lt;/span>
podSecurityPolicy:
&lt;span class="c1">## Specifies whether a PodSecurityPolicy should be created&lt;/span>
&lt;span class="c1">##&lt;/span>
create: &lt;span class="nb">false&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="部署-redis">部署 Redis&lt;/h2>
&lt;p>使用 &lt;em>install&lt;/em> 命令部署 &lt;em>Chart&lt;/em> 至集群中。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ helm install stable/redis
NAME: iced-ibis
LAST DEPLOYED: Mon Jul &lt;span class="m">26&lt;/span> 05:44:02 &lt;span class="m">2021&lt;/span>
NAMESPACE: default
STATUS: DEPLOYED
RESOURCES:
&lt;span class="o">==&lt;/span>&amp;gt; v1/Service
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
iced-ibis-redis-headless ClusterIP None &amp;lt;none&amp;gt; 6379/TCP 1s
iced-ibis-redis-master ClusterIP 10.105.234.211 &amp;lt;none&amp;gt; 6379/TCP 0s
iced-ibis-redis-slave ClusterIP 10.107.214.148 &amp;lt;none&amp;gt; 6379/TCP &lt;span class="nv">0s&lt;/span>
&lt;span class="o">==&lt;/span>&amp;gt; v1/StatefulSet
NAME DESIRED CURRENT AGE
iced-ibis-redis-master &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 0s
iced-ibis-redis-slave &lt;span class="m">2&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="nv">0s&lt;/span>
&lt;span class="o">==&lt;/span>&amp;gt; v1/Pod&lt;span class="o">(&lt;/span>related&lt;span class="o">)&lt;/span>
NAME READY STATUS RESTARTS AGE
iced-ibis-redis-master-0 0/1 Pending &lt;span class="m">0&lt;/span> 0s
iced-ibis-redis-slave-0 0/1 Pending &lt;span class="m">0&lt;/span> &lt;span class="nv">0s&lt;/span>
&lt;span class="o">==&lt;/span>&amp;gt; v1/Secret
NAME TYPE DATA AGE
iced-ibis-redis Opaque &lt;span class="m">1&lt;/span> &lt;span class="nv">1s&lt;/span>
&lt;span class="o">==&lt;/span>&amp;gt; v1/ConfigMap
NAME DATA AGE
iced-ibis-redis &lt;span class="m">3&lt;/span> 1s
iced-ibis-redis-health &lt;span class="m">6&lt;/span> 1s
NOTES:
This Helm chart is deprecated
Given the &lt;span class="sb">`&lt;/span>stable&lt;span class="sb">`&lt;/span> deprecation timeline &lt;span class="o">(&lt;/span>https://github.com/helm/charts#deprecation-timeline&lt;span class="o">)&lt;/span>, the Bitnami maintained Redis Helm chart is now located at bitnami/charts &lt;span class="o">(&lt;/span>https://github.com/bitnami/charts/&lt;span class="o">)&lt;/span>.
The Bitnami repository is already included in the Hubs and we will &lt;span class="k">continue&lt;/span> providing the same cadence of updates, support, etc that we&lt;span class="s1">&amp;#39;ve been keeping here these years. Installation instructions are very similar, just adding the _bitnami_ repo and using it during the installation (`bitnami/&amp;lt;chart&amp;gt;` instead of `stable/&amp;lt;chart&amp;gt;`)
&lt;/span>&lt;span class="s1">
&lt;/span>&lt;span class="s1">\\`\\`\\`bash
&lt;/span>&lt;span class="s1">$ helm repo add bitnami https://charts.bitnami.com/bitnami
&lt;/span>&lt;span class="s1">$ helm install my-release bitnami/&amp;lt;chart&amp;gt; # Helm 3
&lt;/span>&lt;span class="s1">$ helm install --name my-release bitnami/&amp;lt;chart&amp;gt; # Helm 2
&lt;/span>&lt;span class="s1">\\`\\`\\`
&lt;/span>&lt;span class="s1">
&lt;/span>&lt;span class="s1">To update an exisiting _stable_ deployment with a chart hosted in the bitnami repository you can execute
&lt;/span>&lt;span class="s1">\\`\\`\\`bash $ helm repo add bitnami https://charts.bitnami.com/bitnami
&lt;/span>&lt;span class="s1">$ helm upgrade my-release bitnami/&amp;lt;chart&amp;gt;
&lt;/span>&lt;span class="s1">\\`\\`\\`
&lt;/span>&lt;span class="s1">
&lt;/span>&lt;span class="s1"> Issues and PRs related to the chart itself will be redirected to `bitnami/charts` GitHub repository. In the same way, we&amp;#39;&lt;/span>ll be happy to answer questions related to this migration process in this issue &lt;span class="o">(&lt;/span>https://github.com/helm/charts/issues/20969&lt;span class="o">)&lt;/span> created as a common place &lt;span class="k">for&lt;/span> discussion.
** Please be patient &lt;span class="k">while&lt;/span> the chart is being deployed **
Redis can be accessed via port &lt;span class="m">6379&lt;/span> on the following DNS names from within your cluster:
iced-ibis-redis-master.default.svc.cluster.local &lt;span class="k">for&lt;/span> read/write operations
iced-ibis-redis-slave.default.svc.cluster.local &lt;span class="k">for&lt;/span> read-only operations
To get your password run:
&lt;span class="nb">export&lt;/span> &lt;span class="nv">REDIS_PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>kubectl get secret --namespace default iced-ibis-redis -o &lt;span class="nv">jsonpath&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;{.data.redis-password}&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> base64 --decode&lt;span class="k">)&lt;/span>
To connect to your Redis server:
1. Run a Redis pod that you can use as a client:
kubectl run --namespace default iced-ibis-redis-client --rm --tty -i --restart&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Never&amp;#39;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --env &lt;span class="nv">REDIS_PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$REDIS_PASSWORD&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --image docker.io/bitnami/redis:5.0.7-debian-10-r32 -- bash
2. Connect using the Redis CLI:
redis-cli -h iced-ibis-redis-master -a &lt;span class="nv">$REDIS_PASSWORD&lt;/span>
redis-cli -h iced-ibis-redis-slave -a &lt;span class="nv">$REDIS_PASSWORD&lt;/span>
To connect to your database from outside the cluster execute the following commands:
kubectl port-forward --namespace default svc/iced-ibis-redis-master 6379:6379 &lt;span class="p">&amp;amp;&lt;/span>
redis-cli -h 127.0.0.1 -p &lt;span class="m">6379&lt;/span> -a &lt;span class="nv">$REDIS_PASSWORD&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>Helm&lt;/em> 现在将启动所需的 &lt;em>Pod&lt;/em>。您可以使用 &lt;code>helm ls&lt;/code> 查看所有包。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ helm ls
NAME REVISION UPDATED STATUS CHART NAMESPACE
iced-ibis &lt;span class="m">1&lt;/span> Mon Jul &lt;span class="m">26&lt;/span> 05:44:02 &lt;span class="m">2021&lt;/span> DEPLOYED redis-10.5.7 default
&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果您收到 &lt;em>Helm&lt;/em> &lt;em>无法找到准备好的 Pod&lt;/em> 的错误消息，则表示 &lt;em>helm&lt;/em> 仍在部署中。稍等片刻，直到 &lt;em>Docker Image&lt;/em> 完成下载。&lt;/p>
&lt;p>在下一步中，我们将验证部署状态。&lt;/p>
&lt;h2 id="查看结果">查看结果&lt;/h2>
&lt;p>&lt;em>Helm&lt;/em> 部署了所有 &lt;em>Pod&lt;/em>、&lt;em>Replication Controller&lt;/em> 和 &lt;em>Controller&lt;/em> 。使用 &lt;em>kubectl&lt;/em> 找出部署的内容。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get all
NAME READY STATUS RESTARTS AGE
pod/iced-ibis-redis-master-0 0/1 Pending &lt;span class="m">0&lt;/span> 12m
pod/iced-ibis-redis-slave-0 0/1 Pending &lt;span class="m">0&lt;/span> 12m
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
service/iced-ibis-redis-headless ClusterIP None &amp;lt;none&amp;gt; 6379/TCP 12m
service/iced-ibis-redis-master ClusterIP 10.105.234.211 &amp;lt;none&amp;gt; 6379/TCP 12m
service/iced-ibis-redis-slave ClusterIP 10.107.214.148 &amp;lt;none&amp;gt; 6379/TCP 12m
service/kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 53m
NAME READY AGE
statefulset.apps/iced-ibis-redis-master 0/1 12m
statefulset.apps/iced-ibis-redis-slave 0/2 12m
&lt;/code>&lt;/pre>&lt;/div>&lt;p>在下载 &lt;em>Docker&lt;/em> 镜像时，&lt;em>Pod&lt;/em> 将处于 &lt;em>pending&lt;/em> 状态，直到 &lt;em>Persistent Volume&lt;/em> 可用。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl apply -f pv.yaml
persistentvolume/pv-volume1 created
persistentvolume/pv-volume2 created
persistentvolume/pv-volume3 created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>pv.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">PersistentVolume&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pv-volume1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">local&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">capacity&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">10Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">accessModes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteOnce&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/mnt/data1&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">PersistentVolume&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pv-volume2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">local&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">capacity&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">10Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">accessModes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteOnce&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/mnt/data2&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">PersistentVolume&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pv-volume3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">local&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">capacity&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">10Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">accessModes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteOnce&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/mnt/data3&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>Redis&lt;/em> 需要写入权限。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ chmod &lt;span class="m">777&lt;/span> -R /mnt/data*
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get all
NAME READY STATUS RESTARTS AGE
pod/iced-ibis-redis-master-0 1/1 Running &lt;span class="m">3&lt;/span> 18m
pod/iced-ibis-redis-slave-0 0/1 CrashLoopBackOff &lt;span class="m">3&lt;/span> 18m
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
service/iced-ibis-redis-headless ClusterIP None &amp;lt;none&amp;gt; 6379/TCP 18m
service/iced-ibis-redis-master ClusterIP 10.105.234.211 &amp;lt;none&amp;gt; 6379/TCP 18m
service/iced-ibis-redis-slave ClusterIP 10.107.214.148 &amp;lt;none&amp;gt; 6379/TCP 18m
service/kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 58m
NAME READY AGE
statefulset.apps/iced-ibis-redis-master 1/1 18m
statefulset.apps/my-release-redis-master 1/1 36s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>一旦完成，它将进入&lt;em>running&lt;/em> 状态。您现在将拥有一个在 &lt;em>Kubernetes&lt;/em> 之上运行的 &lt;em>Redis&lt;/em> 集群。&lt;/p>
&lt;p>&lt;em>Helm&lt;/em> 能够为部署的组件提供自定义的名称，例如：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">helm install --name my-release stable/redis
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Kubernetes初探（十）</title><link>https://www.catfish.top/p/k8s-basic-10/</link><pubDate>Fri, 23 Jul 2021 14:54:00 +0800</pubDate><guid>https://www.catfish.top/p/k8s-basic-10/</guid><description>&lt;img src="https://www.catfish.top/p/k8s-basic-10/kubernates.png" alt="Featured image of post Kubernetes初探（十）" />&lt;blockquote>
&lt;p>Katacoda在线课：&lt;a class="link" href="https://www.katacoda.com/courses/kubernetes/managing-secrets" target="_blank" rel="noopener"
>Use Kubernetes To Manage Secrets And Passwords&lt;/a>&lt;/p>
&lt;p>本系列教程希望能通过交互式学习网站与传统方式结合，更高效、容易的学习知识。
本系列教程将使用 &lt;a class="link" href="https://www.katacoda.com" target="_blank" rel="noopener"
>Katacoda在线学习平台&lt;/a> 完成学习。&lt;/p>
&lt;/blockquote>
&lt;p>在此场景中，您将了解如何使用 &lt;em>Kubernetes&lt;/em> 管理 &lt;em>Secrets&lt;/em> 。 &lt;em>Kubernetes&lt;/em> 允许您创建通过环境变量或作为卷挂载到 &lt;em>Pod&lt;/em> 的 &lt;em>Secrets&lt;/em> 。&lt;/p>
&lt;p>只允许 &lt;em>Secrets&lt;/em> （例如 SSL 证书或密码）通过基础架构团队以安全的方式进行管理，而不是将密码存储在应用程序的部署工件中。&lt;/p>
&lt;h2 id="启动-kubernetes">启动 Kubernetes&lt;/h2>
&lt;p>首先，我们需要启动一个 &lt;em>Kubernetes&lt;/em> 集群。&lt;/p>
&lt;p>执行以下命令启动集群组件并下载 &lt;em>Kubectl CLI&lt;/em>。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ launch.sh
Waiting &lt;span class="k">for&lt;/span> Kubernetes to start...
Kubernetes started
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="创建-secrets">创建 Secrets&lt;/h2>
&lt;p>&lt;em>Kubernetes&lt;/em> 要求将 &lt;em>Secrets&lt;/em> 编码为 &lt;em>Base64&lt;/em> 的字符串。&lt;/p>
&lt;p>使用命令行工具，我们可以创建 &lt;em>Base64&lt;/em> 字符串并将它们存储为变量在文件中使用。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ &lt;span class="nv">username&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> -n &lt;span class="s2">&amp;#34;admin&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> base64&lt;span class="k">)&lt;/span>
controlplane $ &lt;span class="nv">password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> -n &lt;span class="s2">&amp;#34;a62fjbd37942dcs&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> base64&lt;span class="k">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>Secrets&lt;/em> 是使用 &lt;em>YAML&lt;/em> 定义的。下面我们将使用上面定义的变量，并为它们提供我们的应用程序可以使用的标签。这将创建一个可以通过名称访问的键/值秘密的集合。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;apiVersion: v1
&lt;/span>&lt;span class="s2">kind: Secret
&lt;/span>&lt;span class="s2">metadata:
&lt;/span>&lt;span class="s2"> name: test-secret
&lt;/span>&lt;span class="s2">type: Opaque
&lt;/span>&lt;span class="s2">data:
&lt;/span>&lt;span class="s2"> username: &lt;/span>&lt;span class="nv">$username&lt;/span>&lt;span class="s2">
&lt;/span>&lt;span class="s2"> password: &lt;/span>&lt;span class="nv">$password&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &amp;gt;&amp;gt; secret.yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>secret.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Secret&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">test-secret&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Opaque&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">data&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">username&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">YWRtaW4=&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">password&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">YTYyZmpiZDM3OTQyZGNz&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这个 &lt;em>YAML&lt;/em> 文件中定义可以与 &lt;em>Kubectl&lt;/em> 一起使用来创建我们的 &lt;em>Secrets&lt;/em> 。在启动需要访问密钥的 &lt;em>Pod&lt;/em> 时，我们将通过名称引用集合。&lt;/p>
&lt;h2 id="任务-创建-secret">任务: 创建 Secret&lt;/h2>
&lt;p>使用 &lt;em>kubectl&lt;/em> 创建 &lt;em>Secret&lt;/em>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl create -f secret.yaml
secret/test-secret created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>以下命令允许您查看定义的所有&lt;em>Secret&lt;/em>集合。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get secrets
NAME TYPE DATA AGE
default-token-z8shh kubernetes.io/service-account-token &lt;span class="m">3&lt;/span> 14m
test-secret Opaque &lt;span class="m">2&lt;/span> 26s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>在下一步中，我们将通过 &lt;em>Pod&lt;/em> 使用这些 &lt;em>Secret&lt;/em> 。&lt;/p>
&lt;h2 id="通过环境变量使用-secret">通过环境变量使用 &lt;em>Secret&lt;/em>&lt;/h2>
&lt;p>在文件 &lt;em>secret-env.yaml&lt;/em> 中，我们定义了一个有先前创建的 &lt;em>Secret&lt;/em> 为环境变量的 &lt;em>Pod&lt;/em> 。&lt;/p>
&lt;p>使用 &lt;code>cat secret-env.yaml&lt;/code> 查看文件&lt;/p>
&lt;p>&lt;strong>secret-env.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">secret-env-pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mycontainer&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">alpine:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;sleep&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;9999&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">env&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">SECRET_USERNAME&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">valueFrom&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">secretKeyRef&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">test-secret&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">key&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">username&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">SECRET_PASSWORD&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">valueFrom&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">secretKeyRef&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">test-secret&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">key&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">password&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">restartPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Never&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>为了填充环境变量，我们定义了名称，在本例中为 &lt;em>SECRET_USERNAME&lt;/em>，以及 &lt;em>Secret&lt;/em> 集合的名称和包含数据的密钥。&lt;/p>
&lt;p>结构如下所示：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">SECRET_USERNAME&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">valueFrom&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">secretKeyRef&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">test-secret&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">key&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">username&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="任务">任务&lt;/h3>
&lt;p>使用 &lt;code>kubectl create -f secret-env.yaml&lt;/code> 启动 &lt;em>Pod&lt;/em> 。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl create -f secret-env.yaml
pod/secret-env-pod created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>Pod&lt;/em> 启动后，将输出填充的环境变量。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl &lt;span class="nb">exec&lt;/span> -it secret-env-pod env &lt;span class="p">|&lt;/span> grep SECRET_
&lt;span class="nv">SECRET_USERNAME&lt;/span>&lt;span class="o">=&lt;/span>admin
&lt;span class="nv">SECRET_PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>a62fjbd37942dcs
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>Kubernetes&lt;/em> 在填充环境变量时解码 base64 值。您应该会看到我们定义的原始用户名/密码组合。这些变量现在可用于访问 API、数据库等。&lt;/p>
&lt;p>您可以使用 &lt;code>kubectl get pods&lt;/code> 检查 &lt;em>Pod&lt;/em> 的状态。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pods
NAME READY STATUS RESTARTS AGE
secret-env-pod 1/1 Running &lt;span class="m">0&lt;/span> 34s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>在下一步中，我们将把 &lt;em>Secret&lt;/em> 挂载为文件。&lt;/p>
&lt;h2 id="通过文件使用-secret">通过文件使用 &lt;em>Secret&lt;/em>&lt;/h2>
&lt;p>使用环境变量在内存中存储 &lt;em>Secret&lt;/em> 可能会导致它们意外泄漏。推荐的方法是将它们作为卷安装。&lt;/p>
&lt;p>&lt;em>Pod&lt;/em> 定义可以使用 &lt;code>cat secret-pod.yaml&lt;/code> 查看。&lt;/p>
&lt;p>&lt;strong>secret-pod.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">secret-vol-pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">secret-volume&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">secret&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">secretName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">test-secret&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">test-container&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">alpine:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;sleep&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;9999&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">secret-volume&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/etc/secret-volume&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>要将 &lt;em>Secret&lt;/em> 安装为卷，我们首先定义一个具有名称的卷，在本例中为 &lt;em>Secret&lt;/em> 卷，并为其提供我们存储的 &lt;em>Secret&lt;/em> 。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">secret-volume&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">secret&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">secretName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">test-secret&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>当我们定义容器时，我们将创建的卷挂载到特定目录。应用程序将从该路径读取&lt;em>Secret&lt;/em> 作为文件。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">secret-volume&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/etc/secret-volume&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="任务-1">任务&lt;/h3>
&lt;p>使用 &lt;code>kubectl create -f secret-pod.yaml&lt;/code> 创建我们的新 &lt;em>Pod&lt;/em> 。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl create -f secret-pod.yaml
pod/secret-vol-pod created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>启动后，您可以与安装的&lt;em>Secret&lt;/em> 进行交互。例如，您可以列出所有可用的 &lt;em>Secret&lt;/em> ，就好像它们是常规数据一样。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl &lt;span class="nb">exec&lt;/span> -it secret-vol-pod ls /etc/secret-volume
password username
&lt;/code>&lt;/pre>&lt;/div>&lt;p>读取文件允许我们访问解码的 &lt;em>Secret&lt;/em> 值。要访问我们使用的用户名&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl &lt;span class="nb">exec&lt;/span> -it secret-vol-pod cat /etc/secret-volume/username
admin
&lt;/code>&lt;/pre>&lt;/div>&lt;p>对于密码，我们会读取密码文件。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">admincontrolplane $ kubectl &lt;span class="nb">exec&lt;/span> -it secret-vol-pod cat /etc/secret-volume/password
a62fjbd37942dcs
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Kubernetes初探（九）</title><link>https://www.catfish.top/p/k8s-basic-9/</link><pubDate>Fri, 23 Jul 2021 14:23:00 +0800</pubDate><guid>https://www.catfish.top/p/k8s-basic-9/</guid><description>&lt;img src="https://www.catfish.top/p/k8s-basic-9/kubernates.png" alt="Featured image of post Kubernetes初探（九）" />&lt;blockquote>
&lt;p>Katacoda在线课：&lt;a class="link" href="https://www.katacoda.com/courses/kubernetes/storage-introduction" target="_blank" rel="noopener"
>Running Stateful Services on Kubernetes&lt;/a>&lt;/p>
&lt;p>本系列教程希望能通过交互式学习网站与传统方式结合，更高效、容易的学习知识。
本系列教程将使用 &lt;a class="link" href="https://www.katacoda.com" target="_blank" rel="noopener"
>Katacoda在线学习平台&lt;/a> 完成学习。&lt;/p>
&lt;/blockquote>
&lt;h2 id="部署-nfs-服务器">部署 NFS 服务器&lt;/h2>
&lt;p>&lt;em>NFS&lt;/em> 是一种允许节点通过网络读 / 写数据的协议。该协议的工作原理是让主节点运行 &lt;em>NFS&lt;/em> 守护程序并存储数据。此主节点使某些目录可通过网络使用。&lt;/p>
&lt;p>客户端访问通过驱动器挂载共享的主服务器。从应用程序的角度来看，它们正在写入本地磁盘。在背后，&lt;em>NFS&lt;/em> 协议将其写入主服务器。&lt;/p>
&lt;h3 id="任务">任务&lt;/h3>
&lt;p>在此场景中，出于演示和学习目的，&lt;em>NFS&lt;/em> 服务器的角色由自定义容器处理。容器通过 NFS 提供目录并将数据存储在容器内。在生产环境中，建议配置专用的 &lt;em>NFS Server&lt;/em>。&lt;/p>
&lt;p>使用 &lt;code>docker run -d --net=host \ --privileged --name nfs-server \ katacoda/contained-nfs-server:centos7 \ /exports/data-0001 /exports/data-0002&lt;/code> 命令启动 &lt;em>NFS&lt;/em> 服务器&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ docker run -d --net&lt;span class="o">=&lt;/span>host &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span>&amp;gt; --privileged --name nfs-server &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span>&amp;gt; katacoda/contained-nfs-server:centos7 &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span>&amp;gt; /exports/data-0001 /exports/data-0002
Unable to find image &lt;span class="s1">&amp;#39;katacoda/contained-nfs-server:centos7&amp;#39;&lt;/span> locally
centos7: Pulling from katacoda/contained-nfs-server
8d30e94188e7: Pull &lt;span class="nb">complete&lt;/span>
2b2b27f1f462: Pull &lt;span class="nb">complete&lt;/span>
133e63cf95fe: Pull &lt;span class="nb">complete&lt;/span>
Digest: sha256:5f2ea4737fe27f26be5b5cabaa23e24180079a4dce8d5db235492ec48c5552d1
Status: Downloaded newer image &lt;span class="k">for&lt;/span> katacoda/contained-nfs-server:centos7
65699a0a96bfc489fe2141a815ef12b03917f9bb667340b1be68dfe838d14bf3
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>NFS&lt;/em> 服务器公开两个目录，&lt;em>data-0001&lt;/em> 和 &lt;em>data-0002&lt;/em>。在接下来的步骤中，这将用于存储数据。&lt;/p>
&lt;h2 id="部署-persistent-volume">部署 Persistent Volume&lt;/h2>
&lt;p>为了让 Kubernetes 了解可用的 &lt;em>NFS&lt;/em> 共享，它需要一个 &lt;em>PersistentVolume&lt;/em> 配置。 &lt;em>PersistentVolume&lt;/em> 支持不同的数据存储协议，例如 &lt;em>AWS EBS&lt;/em> 卷、&lt;em>GCE&lt;/em> 存储、&lt;em>OpenStack Cinder&lt;/em>、&lt;em>Glusterfs&lt;/em> 和 &lt;em>NFS&lt;/em>。该配置提供了存储和 &lt;em>API&lt;/em> 之间的抽象，从而实现了一致的体验。&lt;/p>
&lt;p>在使用 &lt;em>NFS&lt;/em> 的情况下，一个 &lt;em>PersistentVolume&lt;/em> 与一个 &lt;em>NFS&lt;/em> 目录相关联。当容器使用完卷后，数据可以 &lt;strong>保留&lt;/strong> 以备将来使用，也可以 &lt;strong>回收&lt;/strong>，这意味着所有数据都将被删除。该策略由 &lt;em>persistentVolumeReclaimPolicy&lt;/em> 选项定义。&lt;/p>
&lt;p>&lt;em>YAML&lt;/em> 文件结构：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">PersistentVolume&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt;friendly-name&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">capacity&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">1Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">accessModes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteOnce&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteMany&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">persistentVolumeReclaimPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Recycle&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">nfs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt;server-name&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt;shared-path&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>该规范定义了关于 &lt;em>PersistentVolume&lt;/em> 的额外元数据，包括有多少可用空间以及它是否具有读 / 写访问权限。&lt;/p>
&lt;h3 id="任务-1">任务&lt;/h3>
&lt;p>使用 &lt;code>cat nfs-0001.yaml nfs-0002.yaml&lt;/code> 查看 &lt;em>YAML&lt;/em> 文件的内容。&lt;/p>
&lt;p>&lt;strong>nfs-0001.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">PersistentVolume&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nfs-0001&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">capacity&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">2Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">accessModes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteOnce&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteMany&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">persistentVolumeReclaimPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Recycle&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">nfs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">172.17.0.45&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/exports/data-0001&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>nfs-0002.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">PersistentVolume&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nfs-0002&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">capacity&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">5Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">accessModes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteOnce&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteMany&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">persistentVolumeReclaimPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Recycle&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">nfs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">172.17.0.45&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/exports/data-0002&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>创建两个新的 &lt;em>PersistentVolume&lt;/em> 定义并指向两个可用的 NFS 共享。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl create -f nfs-0001.yaml
persistentvolume/nfs-0001 created
controlplane $ kubectl create -f nfs-0002.yaml
persistentvolume/nfs-0002 created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>创建后，使用 &lt;code>kubectl get pv&lt;/code> 命令查看集群中的所有 &lt;em>PersistentVolumes&lt;/em>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pv
NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE
nfs-0001 2Gi RWO,RWX Recycle Available 66s
nfs-0002 5Gi RWO,RWX Recycle Available 61s
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="部署-persistent-volume-claim">部署 Persistent Volume Claim&lt;/h2>
&lt;p>一旦 &lt;em>PersistentVolume&lt;/em> 可用，应用程序就可以声明该卷供其使用。该声明旨在阻止应用程序意外写入同一卷并导致冲突和数据损坏。&lt;/p>
&lt;p>&lt;em>Persistent Volume Claim&lt;/em> 指定了卷的要求。这包括所需的读/写访问和存储空间。一个例子如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">PersistentVolumeClaim&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">claim-mysql&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">accessModes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteOnce&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">requests&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">3Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="任务-2">任务&lt;/h2>
&lt;p>使用 &lt;code>cat pvc-mysql.yaml pvc-http.yaml&lt;/code> 查看文件的内容&lt;/p>
&lt;p>&lt;strong>pvc-mysql.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">PersistentVolumeClaim&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">claim-mysql&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">accessModes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteOnce&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">requests&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">3Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>pvc-http.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">PersistentVolumeClaim&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">claim-http&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">accessModes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteOnce&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">requests&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">1Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>为两个不同的应用程序创建两个声明。 &lt;em>MySQL Pod&lt;/em> 将使用一个声明，另一个由 &lt;em>HTTP&lt;/em> 服务器使用。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl create -f pvc-mysql.yaml
persistentvolumeclaim/claim-mysql created
controlplane $ kubectl create -f pvc-http.yaml
persistentvolumeclaim/claim-http created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>创建后，使用 &lt;code>kubectl get pvc&lt;/code> 查看集群中的所有 &lt;em>PersistentVolumesClaims&lt;/em>，将打印出声明映射到的卷。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pvc
NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE
claim-http Bound nfs-0001 2Gi RWO,RWX 53s
claim-mysql Bound nfs-0002 5Gi RWO,RWX 56s
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="volume-的使用">Volume 的使用&lt;/h2>
&lt;p>定义部署后，它可以将自己分配给先前的声明。以下代码段定义了目录 &lt;em>/var/lib/mysql/data&lt;/em> 的卷挂载，该目录映射到存储 &lt;em>mysql-persistent-storage&lt;/em>。名为 &lt;em>mysql-persistent-storage&lt;/em> 的存储映射到名为 &lt;em>claim-mysql&lt;/em> 的声明中。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mysql-persistent-storage&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/var/lib/mysql/data&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mysql-persistent-storage&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">persistentVolumeClaim&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">claimName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">claim-mysql&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="任务-3">任务&lt;/h2>
&lt;p>使用以下命令查看 &lt;em>Pod&lt;/em> 的定义。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ cat pod-mysql.yaml pod-www.yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>pod-mysql.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mysql&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mysql&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mysql&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">openshift/mysql-55-centos7&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">env&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">MYSQL_ROOT_PASSWORD&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">yourpassword&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">MYSQL_USER&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">wp_user&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">MYSQL_PASSWORD&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">wp_pass&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">MYSQL_DATABASE&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">wp_db&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">3306&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mysql&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mysql-persistent-storage&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/var/lib/mysql/data&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mysql-persistent-storage&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">persistentVolumeClaim&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">claimName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">claim-mysql&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>pod-http.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">www&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">www&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">www&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx:alpine&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">www&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">www-persistent-storage&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/usr/share/nginx/html&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">www-persistent-storage&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">persistentVolumeClaim&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">claimName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">claim-http&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>启动两个具有 &lt;em>Persistent Volume Claims&lt;/em> 的新 &lt;em>Pod&lt;/em>。当 &lt;em>Pod&lt;/em> 开始允许应用程序像本地目录一样读/写时，卷被映射到正确的目录。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl create -f pod-mysql.yaml
pod/mysql created
controlplane $ kubectl create -f pod-www.yaml
pod/www created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以使用 &lt;code>kubectl get pods&lt;/code> 开始查看 Pod 的状态&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pods
NAME READY STATUS RESTARTS AGE
mysql 1/1 Running &lt;span class="m">0&lt;/span> 27s
www 1/1 Running &lt;span class="m">0&lt;/span> 25s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果 &lt;em>Persistent Volume Claim&lt;/em> 未分配给 &lt;em>Persistent Volume&lt;/em>，则 &lt;em>Pod&lt;/em> 将处于 &lt;em>Pending&lt;/em> 模式，直到它变为可用。在下一步中，我们将向卷读/写数据。&lt;/p>
&lt;h2 id="数据读写">数据读写&lt;/h2>
&lt;p>我们的 &lt;em>Pod&lt;/em> 现在可以进行读/写。 &lt;em>MySQL&lt;/em> 将所有数据库更改存储到 &lt;em>NFS&lt;/em> 服务器，而 &lt;em>HTTP&lt;/em> 服务器将从 &lt;em>NFS&lt;/em> 驱动器提供静态服务。升级、重新启动或将容器移动到不同的机器时，数据仍然可以访问。&lt;/p>
&lt;p>要测试 &lt;em>HTTP 服务器&lt;/em>，请编写一个“Hello World”&lt;em>index.html&lt;/em> 主页。在这种情况下，我们知道 &lt;em>HTTP&lt;/em> 目录将基于 &lt;em>data-0001&lt;/em>，因为卷定义没有驱动足够的空间来满足 &lt;em>MySQL&lt;/em> 大小要求。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ docker &lt;span class="nb">exec&lt;/span> -it nfs-server bash -c &lt;span class="s2">&amp;#34;echo &amp;#39;Hello World&amp;#39; &amp;gt; /exports/data-0001/index.html&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>根据 &lt;em>Pod&lt;/em> 的 &lt;em>IP&lt;/em>，访问 &lt;em>Pod&lt;/em> 时，应该返回预期的响应。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ &lt;span class="nv">ip&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>kubectl get pod www -o yaml &lt;span class="p">|&lt;/span>grep podIP &lt;span class="p">|&lt;/span> awk &lt;span class="s1">&amp;#39;{split($0,a,&amp;#34;:&amp;#34;); print a[2]}&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$ip&lt;/span>
10.32.0.6
controlplane $ curl &lt;span class="nv">$ip&lt;/span>
Hello World
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="更新数据">更新数据&lt;/h3>
&lt;p>当 &lt;em>NFS&lt;/em> 共享上的数据发生变化时，&lt;em>Pod&lt;/em> 会读取新更新的数据。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ docker &lt;span class="nb">exec&lt;/span> -it nfs-server bash -c &lt;span class="s2">&amp;#34;echo &amp;#39;Hello NFS World&amp;#39; &amp;gt; /exports/data-0001/index.html&amp;#34;&lt;/span>
controlplane $ curl &lt;span class="nv">$ip&lt;/span>
Hello NFS World
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="重建-pod">重建 Pod&lt;/h2>
&lt;p>因为使用远程 &lt;em>NFS&lt;/em> 服务器存储数据，如果 &lt;em>Pod&lt;/em> 或主机宕机，那么数据仍然可用。&lt;/p>
&lt;h3 id="任务-4">任务&lt;/h3>
&lt;p>删除 &lt;em>Pod&lt;/em> 将导致它删除对任何持久卷的声明。新 &lt;em>Pod&lt;/em> 可以获取并重新使用 &lt;em>NFS&lt;/em> 共享。&lt;/p>
&lt;p>&lt;strong>pod-www2.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">www2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">www2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">www2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx:alpine&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">www2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">www-persistent-storage&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/usr/share/nginx/html&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">www-persistent-storage&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">persistentVolumeClaim&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">claimName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">claim-http&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl delete pod www
pod &lt;span class="s2">&amp;#34;www&amp;#34;&lt;/span> deleted
controlplane $ kubectl create -f pod-www2.yaml
pod/www2 created
controlplane $ &lt;span class="nv">ip&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>kubectl get pod www2 -o yaml &lt;span class="p">|&lt;/span>grep podIP &lt;span class="p">|&lt;/span> awk &lt;span class="s1">&amp;#39;{split($0,a,&amp;#34;:&amp;#34;); print a[2]}&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="p">;&lt;/span> curl &lt;span class="nv">$ip&lt;/span>
Hello NFS World
&lt;/code>&lt;/pre>&lt;/div>&lt;p>应用程序现在使用远程 &lt;em>NFS&lt;/em> 进行数据存储。根据具体要求，这种相同的方法适用于其他存储引擎，例如 &lt;em>GlusterFS&lt;/em>、&lt;em>AWS EBS&lt;/em>、&lt;em>GCE&lt;/em> 存储或 &lt;em>OpenStack Cinder&lt;/em>。&lt;/p></description></item><item><title>Kubernetes初探（八）</title><link>https://www.catfish.top/p/k8s-basic-8/</link><pubDate>Fri, 23 Jul 2021 13:07:00 +0800</pubDate><guid>https://www.catfish.top/p/k8s-basic-8/</guid><description>&lt;img src="https://www.catfish.top/p/k8s-basic-8/kubernates.png" alt="Featured image of post Kubernetes初探（八）" />&lt;blockquote>
&lt;p>Katacoda在线课：&lt;a class="link" href="https://www.katacoda.com/courses/kubernetes/liveness-readiness-healthchecks" target="_blank" rel="noopener"
>Liveness and Readiness Healthchecks&lt;/a>&lt;/p>
&lt;p>本系列教程希望能通过交互式学习网站与传统方式结合，更高效、容易的学习知识。
本系列教程将使用 &lt;a class="link" href="https://www.katacoda.com" target="_blank" rel="noopener"
>Katacoda在线学习平台&lt;/a> 完成学习。&lt;/p>
&lt;/blockquote>
&lt;p>在此场景中，您将了解 &lt;em>Kubernetes&lt;/em> 如何使用 &lt;em>Readiness and Liveness Probes&lt;/em> 检查容器运行状况。&lt;/p>
&lt;p>&lt;em>Readiness Probe&lt;/em> 检查应用是否准备好开始处理流量。此探针解决了容器已启动的问题，但该进程仍在预热和配置自身，这意味着它尚未准备好接收流量。&lt;/p>
&lt;p>&lt;em>Liveness Probe&lt;/em> 确保应用程序健康并能够处理请求。&lt;/p>
&lt;h2 id="启动集群">启动集群&lt;/h2>
&lt;p>首先，我们需要启动一个 &lt;em>Kubernetes&lt;/em> 集群。&lt;/p>
&lt;p>执行以下命令启动集群组件并下载 &lt;em>Kubectl CLI&lt;/em>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ launch.sh
Waiting &lt;span class="k">for&lt;/span> Kubernetes to start...
Kubernetes started
&lt;/code>&lt;/pre>&lt;/div>&lt;p>集群启动后，使用 &lt;code>kubectl apply -f deploy.yaml&lt;/code> 部署演示应用程序。&lt;/p>
&lt;p>&lt;strong>deploy.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">List&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">items&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ReplicationController&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">katacoda/docker-http-server:health&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">readinessProbe&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">httpGet&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">initialDelaySeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">timeoutSeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">livenessProbe&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">httpGet&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">initialDelaySeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">timeoutSeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ReplicationController&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bad-frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bad-frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bad-frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bad-frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bad-frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">katacoda/docker-http-server:unhealthy&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">readinessProbe&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">httpGet&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">initialDelaySeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">timeoutSeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">livenessProbe&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">httpGet&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">initialDelaySeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">timeoutSeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>- &lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kubernetes.io/cluster-service&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;true&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NodePort&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">nodePort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">30080&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl apply -f deploy.yaml
replicationcontroller/frontend created
replicationcontroller/bad-frontend created
service/frontend created
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="readiness-probe">Readiness Probe&lt;/h2>
&lt;p>在部署集群时，还部署了两个 &lt;em>Pod&lt;/em> 来演示健康检查。您可以使用 &lt;code>cat deploy.yaml&lt;/code> 查看部署。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">livenessProbe&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">httpGet&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">initialDelaySeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">timeoutSeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以根据您的应用程序更改设置来调用不同的端点，例如 &lt;em>/ping&lt;/em>。&lt;/p>
&lt;h3 id="获取状态">获取状态&lt;/h3>
&lt;p>第一个 &lt;em>Pod&lt;/em> &lt;em>bad-frontend&lt;/em> 是一个 &lt;em>HTTP&lt;/em> 服务，它总是返回 500 错误，表明它没有正确启动。您可以使用 &lt;code>kubectl get pods --selector=&amp;quot;name=bad-frontend&amp;quot;&lt;/code> 命令查看 Pod 的状态。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pods --selector&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;name=bad-frontend&amp;#34;&lt;/span>
NAME READY STATUS RESTARTS AGE
bad-frontend-jk5z2 0/1 Running &lt;span class="m">2&lt;/span> 78s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>Kubectl&lt;/em> 将返回使用我们的特定标签部署的 &lt;em>Pod&lt;/em>。因为健康检查失败，它会显示没有容器为准备就绪的状态，同时它还将显示容器的重启尝试次数。&lt;/p>
&lt;p>要了解有关失败原因的更多详细信息，请对该 &lt;em>Pod&lt;/em> 使用描述命令。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ &lt;span class="nv">pod&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>kubectl get pods --selector&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;name=bad-frontend&amp;#34;&lt;/span> --output&lt;span class="o">=&lt;/span>&lt;span class="nv">jsonpath&lt;/span>&lt;span class="o">={&lt;/span>.items..metadata.name&lt;span class="o">}&lt;/span>&lt;span class="k">)&lt;/span>
controlplane $ kubectl describe pod &lt;span class="nv">$pod&lt;/span>
Name: bad-frontend-jk5z2
Namespace: default
Priority: &lt;span class="m">0&lt;/span>
PriorityClassName: &amp;lt;none&amp;gt;
Node: controlplane/172.17.0.67
Start Time: Fri, &lt;span class="m">23&lt;/span> Jul &lt;span class="m">2021&lt;/span> 05:54:59 +0000
Labels: &lt;span class="nv">name&lt;/span>&lt;span class="o">=&lt;/span>bad-frontend
Annotations: &amp;lt;none&amp;gt;
Status: Running
IP: 10.32.0.6
Controlled By: ReplicationController/bad-frontend
Containers:
bad-frontend:
Container ID: docker://811c3fa6d76c13f4b5bc7a6b2d6f514292e9673be46572a79b8f2d3d5e36bc62
Image: katacoda/docker-http-server:unhealthy
Image ID: docker-pullable://katacoda/docker-http-server@sha256:bea95c69c299c690103c39ebb3159c39c5061fee1dad13aa1b0625e0c6b52f22
Port: &amp;lt;none&amp;gt;
Host Port: &amp;lt;none&amp;gt;
State: Waiting
Reason: CrashLoopBackOff
Last State: Terminated
Reason: Error
Exit Code: &lt;span class="m">2&lt;/span>
Started: Fri, &lt;span class="m">23&lt;/span> Jul &lt;span class="m">2021&lt;/span> 05:57:07 +0000
Finished: Fri, &lt;span class="m">23&lt;/span> Jul &lt;span class="m">2021&lt;/span> 05:57:37 +0000
Ready: False
Restart Count: &lt;span class="m">4&lt;/span>
Liveness: http-get http://:80/ &lt;span class="nv">delay&lt;/span>&lt;span class="o">=&lt;/span>1s &lt;span class="nv">timeout&lt;/span>&lt;span class="o">=&lt;/span>1s &lt;span class="nv">period&lt;/span>&lt;span class="o">=&lt;/span>10s &lt;span class="c1">#success=1 #failure=3&lt;/span>
Readiness: http-get http://:80/ &lt;span class="nv">delay&lt;/span>&lt;span class="o">=&lt;/span>1s &lt;span class="nv">timeout&lt;/span>&lt;span class="o">=&lt;/span>1s &lt;span class="nv">period&lt;/span>&lt;span class="o">=&lt;/span>10s &lt;span class="c1">#success=1 #failure=3&lt;/span>
Environment: &amp;lt;none&amp;gt;
Mounts:
/var/run/secrets/kubernetes.io/serviceaccount from default-token-5n24z &lt;span class="o">(&lt;/span>ro&lt;span class="o">)&lt;/span>
Conditions:
Type Status
Initialized True
Ready False
ContainersReady False
PodScheduled True
Volumes:
default-token-5n24z:
Type: Secret &lt;span class="o">(&lt;/span>a volume populated by a Secret&lt;span class="o">)&lt;/span>
SecretName: default-token-5n24z
Optional: &lt;span class="nb">false&lt;/span>
QoS Class: BestEffort
Node-Selectors: &amp;lt;none&amp;gt;
Tolerations: node.kubernetes.io/not-ready:NoExecute &lt;span class="k">for&lt;/span> 300s
node.kubernetes.io/unreachable:NoExecute &lt;span class="k">for&lt;/span> 300s
Events:
Type Reason Age From Message
---- ------ ---- ---- -------
Normal Scheduled 2m53s default-scheduler Successfully assigned default/bad-frontend-jk5z2 to controlplane
Normal Pulling 2m52s kubelet, controlplane Pulling image &lt;span class="s2">&amp;#34;katacoda/docker-http-server:unhealthy&amp;#34;&lt;/span>
Normal Pulled 2m45s kubelet, controlplane Successfully pulled image &lt;span class="s2">&amp;#34;katacoda/docker-http-server:unhealthy&amp;#34;&lt;/span>
Normal Created 105s &lt;span class="o">(&lt;/span>x3 over 2m45s&lt;span class="o">)&lt;/span> kubelet, controlplane Created container bad-frontend
Normal Started 105s &lt;span class="o">(&lt;/span>x3 over 2m45s&lt;span class="o">)&lt;/span> kubelet, controlplane Started container bad-frontend
Warning Unhealthy 105s &lt;span class="o">(&lt;/span>x6 over 2m35s&lt;span class="o">)&lt;/span> kubelet, controlplane Liveness probe failed: HTTP probe failed with statuscode: &lt;span class="m">500&lt;/span>
Normal Killing 105s &lt;span class="o">(&lt;/span>x2 over 2m15s&lt;span class="o">)&lt;/span> kubelet, controlplane Container bad-frontend failed liveness probe, will be restarted
Normal Pulled 105s &lt;span class="o">(&lt;/span>x2 over 2m15s&lt;span class="o">)&lt;/span> kubelet, controlplane Container image &lt;span class="s2">&amp;#34;katacoda/docker-http-server:unhealthy&amp;#34;&lt;/span> already present on machine
Warning Unhealthy 103s &lt;span class="o">(&lt;/span>x7 over 2m43s&lt;span class="o">)&lt;/span> kubelet, controlplane Readiness probe failed: HTTP probe failed with statuscode: &lt;span class="m">500&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="readiness">Readiness&lt;/h3>
&lt;p>我们的第二个 Pod，&lt;em>frontend&lt;/em>，在启动时返回 &lt;em>OK&lt;/em> 状态。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pods --selector&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;name=frontend&amp;#34;&lt;/span>
NAME READY STATUS RESTARTS AGE
frontend-54czd 1/1 Running &lt;span class="m">0&lt;/span> 4m9s
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="liveness-probe">Liveness Probe&lt;/h4>
&lt;p>由于我们的第二个 &lt;em>Pod&lt;/em> 当前处于健康状态，我们可以模拟发生的故障。&lt;/p>
&lt;p>目前，该 &lt;em>Pod&lt;/em> 应该没有发生崩溃。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pods --selector&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;name=frontend&amp;#34;&lt;/span>
NAME READY STATUS RESTARTS AGE
frontend-54czd 1/1 Running &lt;span class="m">0&lt;/span> 7m17s
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="让服务崩溃">让服务崩溃&lt;/h3>
&lt;p>&lt;em>HTTP&lt;/em> 服务器有一个额外的端点，这将导致它返回 &lt;em>500&lt;/em> 错误。使用 &lt;em>kubectl exec&lt;/em> 可以调用端点。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ &lt;span class="nv">pod&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>kubectl get pods --selector&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;name=frontend&amp;#34;&lt;/span> --output&lt;span class="o">=&lt;/span>&lt;span class="nv">jsonpath&lt;/span>&lt;span class="o">={&lt;/span>.items..metadata.name&lt;span class="o">}&lt;/span>&lt;span class="k">)&lt;/span>
controlplane $ kubectl &lt;span class="nb">exec&lt;/span> &lt;span class="nv">$pod&lt;/span> -- /usr/bin/curl -s localhost/unhealthy
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="liveness">Liveness&lt;/h2>
&lt;p>&lt;em>Kubernetes&lt;/em> 将根据配置执行 &lt;em>Liveness Probe&lt;/em>。如果探测器失败，&lt;em>Kubernetes&lt;/em> 将销毁并重新创建失败的容器。执行上面的命令使服务崩溃并观察 &lt;em>Kubernetes&lt;/em> 自动恢复它。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pods --selector&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;name=frontend&amp;#34;&lt;/span>
NAME READY STATUS RESTARTS AGE
frontend-54czd 1/1 Running &lt;span class="m">1&lt;/span> 9m42s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>检查可能需要一些时间才能检测到。&lt;/p></description></item><item><title>Kubernetes初探（七）</title><link>https://www.catfish.top/p/k8s-basic-7/</link><pubDate>Tue, 20 Jul 2021 15:30:00 +0800</pubDate><guid>https://www.catfish.top/p/k8s-basic-7/</guid><description>&lt;img src="https://www.catfish.top/p/k8s-basic-7/kubernates.png" alt="Featured image of post Kubernetes初探（七）" />&lt;blockquote>
&lt;p>Katacoda在线课：&lt;a class="link" href="https://www.katacoda.com/courses/kubernetes/create-kubernetes-ingress-routes" target="_blank" rel="noopener"
>Create Ingress Routing&lt;/a>&lt;/p>
&lt;p>本系列教程希望能通过交互式学习网站与传统方式结合，更高效、容易的学习知识。
本系列教程将使用 &lt;a class="link" href="https://www.katacoda.com" target="_blank" rel="noopener"
>Katacoda在线学习平台&lt;/a> 完成学习。&lt;/p>
&lt;/blockquote>
&lt;p>&lt;em>Kubernetes&lt;/em> 具有先进的网络功能，允许 &lt;em>Pod&lt;/em> 和 &lt;em>Service&lt;/em> 在集群网络内部进行通信。 &lt;em>Ingress&lt;/em> 开启了到集群的入站连接，允许外部流量到达正确的 &lt;em>Pod&lt;/em>。&lt;/p>
&lt;p>&lt;em>Ingress&lt;/em> 能够提供外部可访问的 &lt;em>URL&lt;/em>、负载平衡流量、终止 SSL、为 &lt;em>Kubernetes&lt;/em> 集群提供基于名称的虚拟主机。&lt;/p>
&lt;p>在此场景中，您将学习如何部署和配置 &lt;em>Ingress&lt;/em> 规则来管理传入的 &lt;em>HTTP&lt;/em> 请求。&lt;/p>
&lt;h2 id="创建-deployment">创建 Deployment&lt;/h2>
&lt;p>首先，部署一个示例 &lt;em>HTTP&lt;/em> 服务器，它将成为我们请求的目标。部署中包含三个部署，分别为 &lt;em>webapp1&lt;/em>， &lt;em>webapp2&lt;/em>， &lt;em>webapp3&lt;/em>，每个部署都有一个服务。&lt;/p>
&lt;p>&lt;strong>deployment.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">katacoda/docker-http-server:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">katacoda/docker-http-server:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">katacoda/docker-http-server:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-svc&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp2-svc&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp3-svc&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="任务">任务&lt;/h3>
&lt;p>使用 &lt;code>kubectl apply -f deployment.yaml&lt;/code> 命令部署 &lt;em>YAML&lt;/em> 定义。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl apply -f deployment.yaml
deployment.apps/webapp1 created
deployment.apps/webapp2 created
deployment.apps/webapp3 created
service/webapp1-svc created
service/webapp2-svc created
service/webapp3-svc created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以用 &lt;code>kubectl get deployment&lt;/code> 查看状态。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get deployment
NAME READY UP-TO-DATE AVAILABLE AGE
webapp1 1/1 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 15s
webapp2 1/1 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 15s
webapp3 1/1 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 15s
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get svc
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 7m41s
webapp1-svc ClusterIP 10.98.236.192 &amp;lt;none&amp;gt; 80/TCP 41s
webapp2-svc ClusterIP 10.105.201.139 &amp;lt;none&amp;gt; 80/TCP 41s
webapp3-svc ClusterIP 10.103.159.185 &amp;lt;none&amp;gt; 80/TCP 41s
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="部署-ingress">部署 Ingress&lt;/h2>
&lt;p>&lt;em>ingress.yaml&lt;/em> 文件中定义了一个基于 &lt;em>Nginx&lt;/em> 的 &lt;em>Ingress&lt;/em> 控制器以及一个 &lt;em>Service&lt;/em> ，开放 &lt;em>80&lt;/em> 端口用于使用 &lt;em>External IPs&lt;/em> 的外部连接。如果 &lt;em>Kubernetes&lt;/em> 集群在云服务商上运行，那么它将为 &lt;em>LoadBalancer&lt;/em> 服务类型。&lt;/p>
&lt;p>&lt;em>ServiceAccount&lt;/em> 定义了带有权限的、连接集群以操作定义的入口规则的一组的帐户。默认服务器密钥是其他 &lt;em>Nginx&lt;/em> 示例 &lt;em>SSL&lt;/em> 连接的自签名证书，并且是&lt;a class="link" href="https://github.com/nginxinc/kubernetes-ingress/tree/master/deployments" target="_blank" rel="noopener"
>Nginx Default Example&lt;/a> 中所必须的。&lt;/p>
&lt;p>&lt;strong>ingress.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Namespace&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Secret&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">default-server-secret&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kubernetes.io/tls&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">data&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">tls.crt&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN2akNDQWFZQ0NRREFPRjl0THNhWFhEQU5CZ2txaGtpRzl3MEJBUXNGQURBaE1SOHdIUVlEVlFRRERCWk8KUjBsT1dFbHVaM0psYzNORGIyNTBjbTlzYkdWeU1CNFhEVEU0TURreE1qRTRNRE16TlZvWERUSXpNRGt4TVRFNApNRE16TlZvd0lURWZNQjBHQTFVRUF3d1dUa2RKVGxoSmJtZHlaWE56UTI5dWRISnZiR3hsY2pDQ0FTSXdEUVlKCktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUwvN2hIUEtFWGRMdjNyaUM3QlBrMTNpWkt5eTlyQ08KR2xZUXYyK2EzUDF0azIrS3YwVGF5aGRCbDRrcnNUcTZzZm8vWUk1Y2Vhbkw4WGM3U1pyQkVRYm9EN2REbWs1Qgo4eDZLS2xHWU5IWlg0Rm5UZ0VPaStlM2ptTFFxRlBSY1kzVnNPazFFeUZBL0JnWlJVbkNHZUtGeERSN0tQdGhyCmtqSXVuektURXUyaDU4Tlp0S21ScUJHdDEwcTNRYzhZT3ExM2FnbmovUWRjc0ZYYTJnMjB1K1lYZDdoZ3krZksKWk4vVUkxQUQ0YzZyM1lma1ZWUmVHd1lxQVp1WXN2V0RKbW1GNWRwdEMzN011cDBPRUxVTExSakZJOTZXNXIwSAo1TmdPc25NWFJNV1hYVlpiNWRxT3R0SmRtS3FhZ25TZ1JQQVpQN2MwQjFQU2FqYzZjNGZRVXpNQ0F3RUFBVEFOCkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQWpLb2tRdGRPcEsrTzhibWVPc3lySmdJSXJycVFVY2ZOUitjb0hZVUoKdGhrYnhITFMzR3VBTWI5dm15VExPY2xxeC9aYzJPblEwMEJCLzlTb0swcitFZ1U2UlVrRWtWcitTTFA3NTdUWgozZWI4dmdPdEduMS9ienM3bzNBaS9kclkrcUI5Q2k1S3lPc3FHTG1US2xFaUtOYkcyR1ZyTWxjS0ZYQU80YTY3Cklnc1hzYktNbTQwV1U3cG9mcGltU1ZmaXFSdkV5YmN3N0NYODF6cFErUyt1eHRYK2VBZ3V0NHh3VlI5d2IyVXYKelhuZk9HbWhWNThDd1dIQnNKa0kxNXhaa2VUWXdSN0diaEFMSkZUUkk3dkhvQXprTWIzbjAxQjQyWjNrN3RXNQpJUDFmTlpIOFUvOWxiUHNoT21FRFZkdjF5ZytVRVJxbStGSis2R0oxeFJGcGZnPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">tls.key&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBdi91RWM4b1JkMHUvZXVJTHNFK1RYZUprckxMMnNJNGFWaEMvYjVyYy9XMlRiNHEvClJOcktGMEdYaVN1eE9ycXgrajlnamx4NXFjdnhkenRKbXNFUkJ1Z1B0ME9hVGtIekhvb3FVWmcwZGxmZ1dkT0EKUTZMNTdlT1l0Q29VOUZ4amRXdzZUVVRJVUQ4R0JsRlNjSVo0b1hFTkhzbysyR3VTTWk2Zk1wTVM3YUhudzFtMApxWkdvRWEzWFNyZEJ6eGc2clhkcUNlUDlCMXl3VmRyYURiUzc1aGQzdUdETDU4cGszOVFqVUFQaHpxdmRoK1JWClZGNGJCaW9CbTVpeTlZTW1hWVhsMm0wTGZzeTZuUTRRdFFzdEdNVWozcGJtdlFmazJBNnljeGRFeFpkZFZsdmwKMm82MjBsMllxcHFDZEtCRThCay90elFIVTlKcU56cHpoOUJUTXdJREFRQUJBb0lCQVFDZklHbXowOHhRVmorNwpLZnZJUXQwQ0YzR2MxNld6eDhVNml4MHg4Mm15d1kxUUNlL3BzWE9LZlRxT1h1SENyUlp5TnUvZ2IvUUQ4bUFOCmxOMjRZTWl0TWRJODg5TEZoTkp3QU5OODJDeTczckM5bzVvUDlkazAvYzRIbjAzSkVYNzZ5QjgzQm9rR1FvYksKMjhMNk0rdHUzUmFqNjd6Vmc2d2szaEhrU0pXSzBwV1YrSjdrUkRWYmhDYUZhNk5nMUZNRWxhTlozVDhhUUtyQgpDUDNDeEFTdjYxWTk5TEI4KzNXWVFIK3NYaTVGM01pYVNBZ1BkQUk3WEh1dXFET1lvMU5PL0JoSGt1aVg2QnRtCnorNTZud2pZMy8yUytSRmNBc3JMTnIwMDJZZi9oY0IraVlDNzVWYmcydVd6WTY3TWdOTGQ5VW9RU3BDRkYrVm4KM0cyUnhybnhBb0dCQU40U3M0ZVlPU2huMVpQQjdhTUZsY0k2RHR2S2ErTGZTTXFyY2pOZjJlSEpZNnhubmxKdgpGenpGL2RiVWVTbWxSekR0WkdlcXZXaHFISy9iTjIyeWJhOU1WMDlRQ0JFTk5jNmtWajJTVHpUWkJVbEx4QzYrCk93Z0wyZHhKendWelU0VC84ajdHalRUN05BZVpFS2FvRHFyRG5BYWkyaW5oZU1JVWZHRXFGKzJyQW9HQkFOMVAKK0tZL0lsS3RWRzRKSklQNzBjUis3RmpyeXJpY05iWCtQVzUvOXFHaWxnY2grZ3l4b25BWlBpd2NpeDN3QVpGdwpaZC96ZFB2aTBkWEppc1BSZjRMazg5b2pCUmpiRmRmc2l5UmJYbyt3TFU4NUhRU2NGMnN5aUFPaTVBRHdVU0FkCm45YWFweUNweEFkREtERHdObit3ZFhtaTZ0OHRpSFRkK3RoVDhkaVpBb0dCQUt6Wis1bG9OOTBtYlF4VVh5YUwKMjFSUm9tMGJjcndsTmVCaWNFSmlzaEhYa2xpSVVxZ3hSZklNM2hhUVRUcklKZENFaHFsV01aV0xPb2I2NTNyZgo3aFlMSXM1ZUtka3o0aFRVdnpldm9TMHVXcm9CV2xOVHlGanIrSWhKZnZUc0hpOGdsU3FkbXgySkJhZUFVWUNXCndNdlQ4NmNLclNyNkQrZG8wS05FZzFsL0FvR0FlMkFVdHVFbFNqLzBmRzgrV3hHc1RFV1JqclRNUzRSUjhRWXQKeXdjdFA4aDZxTGxKUTRCWGxQU05rMXZLTmtOUkxIb2pZT2pCQTViYjhibXNVU1BlV09NNENoaFJ4QnlHbmR2eAphYkJDRkFwY0IvbEg4d1R0alVZYlN5T294ZGt5OEp0ek90ajJhS0FiZHd6NlArWDZDODhjZmxYVFo5MWpYL3RMCjF3TmRKS2tDZ1lCbyt0UzB5TzJ2SWFmK2UwSkN5TGhzVDQ5cTN3Zis2QWVqWGx2WDJ1VnRYejN5QTZnbXo5aCsKcDNlK2JMRUxwb3B0WFhNdUFRR0xhUkcrYlNNcjR5dERYbE5ZSndUeThXczNKY3dlSTdqZVp2b0ZpbmNvVlVIMwphdmxoTUVCRGYxSjltSDB5cDBwWUNaS2ROdHNvZEZtQktzVEtQMjJhTmtsVVhCS3gyZzR6cFE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ServiceAccount&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-ingress &lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ConfigMap&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-config&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">data&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="c"># Described at: https://docs.nginx.com/nginx-ingress-controller/installation/installation-with-manifests/&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="c"># Source from: https://github.com/nginxinc/kubernetes-ingress/blob/master/deployments/common/ingress-class.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">networking.k8s.io/v1beta1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">IngressClass&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># annotations:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># ingressclass.kubernetes.io/is-default-class: &amp;#34;true&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">controller&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx.org/ingress-controller&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceAccountName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx/nginx-ingress:edge&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">imagePullPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Always&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">443&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">env&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">POD_NAMESPACE&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">valueFrom&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">fieldRef&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">fieldPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">metadata.namespace&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">POD_NAME&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">valueFrom&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">fieldRef&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">fieldPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">metadata.name&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- -&lt;span class="l">nginx-configmaps=$(POD_NAMESPACE)/nginx-config&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- -&lt;span class="l">default-server-tls-secret=$(POD_NAMESPACE)/default-server-secret&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NodePort &lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">targetPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">protocol&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TCP&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">443&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">targetPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">443&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">protocol&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TCP&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">externalIPs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="m">172.17.0.46&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="任务-1">任务&lt;/h3>
&lt;p>&lt;em>Ingress&lt;/em> 控制器以同样的方式部署到 &lt;em>Kubernetes&lt;/em> 集群，使用 &lt;code>kubectl create -f ingress.yaml&lt;/code>命令操作。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl create -f ingress.yaml
namespace/nginx-ingress created
secret/default-server-secret created
serviceaccount/nginx-ingress created
configmap/nginx-config created
ingressclass.networking.k8s.io/nginx created
deployment.apps/nginx-ingress created
service/nginx-ingress created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以使用 &lt;code>kubectl get deployment -n nginx-ingress&lt;/code> 查看状态。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get deployment -n nginx-ingress
NAME READY UP-TO-DATE AVAILABLE AGE
nginx-ingress 1/1 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 35s
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="部署-ingress-rules">部署 Ingress Rules&lt;/h2>
&lt;p>&lt;em>Ingress Rules&lt;/em> 是 Kubernetes 的对象类型。规则可以基于请求主机（域），或请求的路径，或两者的组合。&lt;/p>
&lt;p>&lt;code>cat ingress-rules.yaml&lt;/code> 中定义了一组示例规则。&lt;/p>
&lt;p>&lt;strong>ingress-rules.yaml&lt;/strong>&lt;/p>
&lt;pre>&lt;code>apiVersion: extensions/v1beta1
kind: Ingress
metadata:
name: webapp-ingress
spec:
ingressClassName: nginx
rules:
- host: my.kubernetes.example
http:
paths:
- path: /webapp1
backend:
serviceName: webapp1-svc
servicePort: 80
- path: /webapp2
backend:
serviceName: webapp2-svc
servicePort: 80
- backend:
serviceName: webapp3-svc
servicePort: 80
&lt;/code>&lt;/pre>&lt;p>规则的重要部分定义如下。&lt;/p>
&lt;p>这些规则适用于对主机 &lt;em>my.kubernetes.example&lt;/em> 的请求。基于路径请求定义了两个规则，并使用一个 &lt;em>catch all&lt;/em> 定义。对路径 &lt;em>/webapp1&lt;/em> 的请求被转发到服务 &lt;em>webapp1-svc&lt;/em>。同样，对 &lt;em>/webapp2&lt;/em> 的请求被转发到 &lt;em>webapp2-svc&lt;/em>。如果没有规则适用，将使用 &lt;em>webapp3-svc&lt;/em>。&lt;/p>
&lt;p>这演示了应用的 &lt;em>URL&lt;/em> 结构如何独立于应用程序的部署方式。&lt;/p>
&lt;h3 id="任务-2">任务&lt;/h3>
&lt;p>与所有 &lt;em>Kubernetes 对象一样&lt;/em>，它们可以通过 &lt;code>kubectl create -f ingress-rules.yaml&lt;/code> 进行部署。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl create -f ingress-rules.yaml
ingress.extensions/webapp-ingress created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>部署后，可以通过 &lt;code>kubectl get ing&lt;/code> 查看所有 &lt;em>Ingress&lt;/em> 规则的状态&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get ing
NAME CLASS HOSTS ADDRESS PORTS AGE
webapp-ingress nginx my.kubernetes.example &lt;span class="m">80&lt;/span> 41s
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="测试">测试&lt;/h2>
&lt;p>应用入口规则后，流量将被路由到定义的位置。&lt;/p>
&lt;p>第一个请求将由 &lt;em>webapp1&lt;/em> 处理。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ curl -H &lt;span class="s2">&amp;#34;Host: my.kubernetes.example&amp;#34;&lt;/span> 172.17.0.68/webapp1
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-7c456784b7-cg6sk&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>第二个请求将由 &lt;em>webapp2&lt;/em> 处理。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ curl -H &lt;span class="s2">&amp;#34;Host: my.kubernetes.example&amp;#34;&lt;/span> 172.17.0.68/webapp2
&amp;lt;h1&amp;gt;This request was processed by host: webapp2-79f9947d45-25j6l&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>最后，所有的其他请求将由 &lt;em>webapp3&lt;/em> 处理。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ curl -H &lt;span class="s2">&amp;#34;Host: my.kubernetes.example&amp;#34;&lt;/span> 172.17.0.68
&amp;lt;h1&amp;gt;This request was processed by host: webapp3-777f4dd675-n2pqs&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Kubernetes初探（六）</title><link>https://www.catfish.top/p/k8s-basic-6/</link><pubDate>Tue, 20 Jul 2021 13:36:00 +0800</pubDate><guid>https://www.catfish.top/p/k8s-basic-6/</guid><description>&lt;img src="https://www.catfish.top/p/k8s-basic-6/kubernates.png" alt="Featured image of post Kubernetes初探（六）" />&lt;blockquote>
&lt;p>Katacoda在线课：&lt;a class="link" href="https://www.katacoda.com/courses/kubernetes/networking-introduction" target="_blank" rel="noopener"
>Networking Introduction&lt;/a>&lt;/p>
&lt;p>本系列教程希望能通过交互式学习网站与传统方式结合，更高效、容易的学习知识。
本系列教程将使用 &lt;a class="link" href="https://www.katacoda.com" target="_blank" rel="noopener"
>Katacoda在线学习平台&lt;/a> 完成学习。&lt;/p>
&lt;/blockquote>
&lt;p>&lt;em>Kubernetes&lt;/em> 具有先进的网络功能，允许 &lt;em>Pod&lt;/em> 和 &lt;em>Service&lt;/em> 在集群网络内部和外部进行通信。&lt;/p>
&lt;p>在此场景中，您将学习以下类型的 &lt;em>Kubernetes&lt;/em> &lt;em>Service&lt;/em>。&lt;/p>
&lt;ul>
&lt;li>Cluster IP&lt;/li>
&lt;li>Target Ports&lt;/li>
&lt;li>NodePort&lt;/li>
&lt;li>External IPs&lt;/li>
&lt;li>Load Balancer&lt;/li>
&lt;/ul>
&lt;p>&lt;em>Kubernetes&lt;/em> 服务是一个抽象，它定义了如何访问一组 &lt;em>Pod&lt;/em> 的策略和方法。可以通过 &lt;em>Service&lt;/em> 访问基于标签选择器的 &lt;em>Pod&lt;/em> 集合。&lt;/p>
&lt;h2 id="cluster-ip">Cluster IP&lt;/h2>
&lt;p>&lt;em>Cluster IP&lt;/em> 是创建 &lt;em>Kubernetes&lt;/em> 服务时的默认方法。该服务被分配了一个内部 IP，其他组件可以使用它来访问 &lt;em>Pod&lt;/em>。&lt;/p>
&lt;p>&lt;em>Service&lt;/em> 能够通过单个 &lt;em>IP&lt;/em> 地址在多个 &lt;em>Pod&lt;/em> 之间进行负载平衡。&lt;/p>
&lt;p>通过 &lt;code>kubectl apply -f clusterip.yaml&lt;/code> 命令部署服务。&lt;/p>
&lt;p>在 &lt;em>cat clusterip.yaml&lt;/em> 可以查看相关定义。&lt;/p>
&lt;p>&lt;strong>clusterip.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-clusterip-svc&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-clusterip&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-clusterip&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">extensions/v1beta1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-clusterip-deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-clusterip&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-clusterip-pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">katacoda/docker-http-server:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl apply -f clusterip.yaml
service/webapp1-clusterip-svc created
deployment.extensions/webapp1-clusterip-deployment created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>该文件定义了部署具有两个副本的 &lt;em>Web&lt;/em> 应用程序，用来展示负载平衡和服务。
可以通过 &lt;code>kubectl get pods&lt;/code> 命令查看 &lt;em>Pod&lt;/em> 状态。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pods
NAME READY STATUS RESTARTS AGE
webapp1-clusterip-deployment-669c7c65c4-r6k2l 1/1 Running &lt;span class="m">0&lt;/span> 15s
webapp1-clusterip-deployment-669c7c65c4-xdsd4 1/1 Running &lt;span class="m">0&lt;/span> 15s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>同时也部署了一个 &lt;em>Service&lt;/em>，可以通过 &lt;code>kubectl get svc&lt;/code> 命令查看。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 8m12s
webapp1-clusterip-svc ClusterIP 10.108.32.169 &amp;lt;none&amp;gt; 80/TCP 39s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以通过 &lt;code>kubectl describe svc/webapp1-clusterip-svc&lt;/code> 命令查看有关服务配置和活动端点 (&lt;em>Pod&lt;/em>) 的更多详细信息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl describe svc/webapp1-clusterip-svc
Name: webapp1-clusterip-svc
Namespace: default
Labels: &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>webapp1-clusterip
Annotations: kubectl.kubernetes.io/last-applied-configuration:
&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;apiVersion&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;v1&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;kind&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Service&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;annotations&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;app&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;webapp1-clusterip&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>,&lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;webapp1-clusterip-svc&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;name...
&lt;/span>&lt;span class="s2">Selector: app=webapp1-clusterip
&lt;/span>&lt;span class="s2">Type: ClusterIP
&lt;/span>&lt;span class="s2">IP: 10.108.32.169
&lt;/span>&lt;span class="s2">Port: &amp;lt;unset&amp;gt; 80/TCP
&lt;/span>&lt;span class="s2">TargetPort: 80/TCP
&lt;/span>&lt;span class="s2">Endpoints: 10.32.0.5:80,10.32.0.6:80
&lt;/span>&lt;span class="s2">Session Affinity: None
&lt;/span>&lt;span class="s2">Events: &amp;lt;none&amp;gt;
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>部署完成后，可以通过分配的 &lt;em>Cluster IP&lt;/em> 访问该服务。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ &lt;span class="nb">export&lt;/span> &lt;span class="nv">CLUSTER_IP&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>kubectl get services/webapp1-clusterip-svc -o go-template&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;{{(index .spec.clusterIP)}}&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
controlplane $ &lt;span class="nb">echo&lt;/span> &lt;span class="nv">CLUSTER_IP&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$CLUSTER_IP&lt;/span>
&lt;span class="nv">CLUSTER_IP&lt;/span>&lt;span class="o">=&lt;/span>10.108.32.169
controlplane $ curl &lt;span class="nv">$CLUSTER_IP&lt;/span>:80
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-clusterip-deployment-669c7c65c4-r6k2l&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>将通过多个请求来展示基于公共标签选择器的跨多个* Pod* 的负载均衡器。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ curl &lt;span class="nv">$CLUSTER_IP&lt;/span>:80
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-clusterip-deployment-669c7c65c4-xdsd4&amp;lt;/h1&amp;gt;
controlplane $ curl &lt;span class="nv">$CLUSTER_IP&lt;/span>:80
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-clusterip-deployment-669c7c65c4-r6k2l&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="target-port">Target Port&lt;/h2>
&lt;p>&lt;em>TargetPort&lt;/em> 允许我们将服务可用的端口与应用程序正在侦听的端口分开。 &lt;em>TargetPort&lt;/em> 是应用配置为侦听的端口。端口是从外部访问应用的方式。&lt;/p>
&lt;p>与之前类似，&lt;em>Service&lt;/em> 和额外的 &lt;em>Pod&lt;/em> 是通过 &lt;code>kubectl apply -f clusterip-target.yaml&lt;/code> 命令来部署的。&lt;/p>
&lt;p>**clusterip-target.yaml **&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-clusterip-targetport-svc&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-clusterip-targetport&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8080&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">targetPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-clusterip-targetport&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">extensions/v1beta1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-clusterip-targetport-deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-clusterip-targetport&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-clusterip-targetport-pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">katacoda/docker-http-server:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>以下命令将创建服务。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl apply -f clusterip-target.yaml
service/webapp1-clusterip-targetport-svc created
deployment.extensions/webapp1-clusterip-targetport-deployment created
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get svc
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 13m
webapp1-clusterip-svc ClusterIP 10.108.32.169 &amp;lt;none&amp;gt; 80/TCP 5m29s
webapp1-clusterip-targetport-svc ClusterIP 10.102.59.206 &amp;lt;none&amp;gt; 8080/TCP 40s
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl describe svc/webapp1-clusterip-targetport-svc
Name: webapp1-clusterip-targetport-svc
Namespace: default
Labels: &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>webapp1-clusterip-targetport
Annotations: kubectl.kubernetes.io/last-applied-configuration:
&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;apiVersion&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;v1&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;kind&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Service&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;annotations&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;app&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;webapp1-clusterip-targetport&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>,&lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;webapp1-clusterip...
&lt;/span>&lt;span class="s2">Selector: app=webapp1-clusterip-targetport
&lt;/span>&lt;span class="s2">Type: ClusterIP
&lt;/span>&lt;span class="s2">IP: 10.102.59.206
&lt;/span>&lt;span class="s2">Port: &amp;lt;unset&amp;gt; 8080/TCP
&lt;/span>&lt;span class="s2">TargetPort: 80/TCP
&lt;/span>&lt;span class="s2">Endpoints: 10.32.0.7:80,10.32.0.8:80
&lt;/span>&lt;span class="s2">Session Affinity: None
&lt;/span>&lt;span class="s2">Events: &amp;lt;none&amp;gt;
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>Service&lt;/em> 和 &lt;em>Pod&lt;/em> 部署完成后，可以像以前一样通过 &lt;em>Cluster IP&lt;/em> 访问，但这次是在定义的端口 8080 上。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ &lt;span class="nb">export&lt;/span> &lt;span class="nv">CLUSTER_IP&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>kubectl get services/webapp1-clusterip-targetport-svc -o go-template&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;{{(index .spec.clusterIP)}}&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
controlplane $ &lt;span class="nb">echo&lt;/span> &lt;span class="nv">CLUSTER_IP&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$CLUSTER_IP&lt;/span>
&lt;span class="nv">CLUSTER_IP&lt;/span>&lt;span class="o">=&lt;/span>10.102.59.206
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ curl &lt;span class="nv">$CLUSTER_IP&lt;/span>:8080
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-clusterip-targetport-deployment-5599945ff4-96fqh&amp;lt;/h1&amp;gt;
controlplane $ curl &lt;span class="nv">$CLUSTER_IP&lt;/span>:8080
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-clusterip-targetport-deployment-5599945ff4-zwr8f&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>应用程序本身仍然配置为侦听 &lt;em>80&lt;/em> 端口。&lt;em>Kubernetes&lt;/em> 服务管理着两者之间的转换。&lt;/p>
&lt;h2 id="nodeport">NodePort&lt;/h2>
&lt;p>虽然 &lt;em>TargetPort&lt;/em> 和 &lt;em>ClusterIP&lt;/em> 使其可用于集群内部，但 &lt;em>NodePort&lt;/em> 通过定义的静态端口在每个节点的 &lt;em>IP&lt;/em> 上公开服务。无论访问集群内的哪个节点，都可以通过定义的端口号直接访问该服务。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl apply -f nodeport.yaml
service/webapp1-nodeport-svc created
deployment.extensions/webapp1-nodeport-deployment created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看服务定义时，注意定义的附加类型和 &lt;em>NodePort&lt;/em> 属性。&lt;/p>
&lt;p>&lt;strong>nodeport.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-nodeport-svc&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-nodeport&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NodePort&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">nodePort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">30080&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-nodeport&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">extensions/v1beta1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-nodeport-deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-nodeport&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-nodeport-pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">katacoda/docker-http-server:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get svc
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 22m
webapp1-clusterip-svc ClusterIP 10.108.32.169 &amp;lt;none&amp;gt; 80/TCP 14m
webapp1-clusterip-targetport-svc ClusterIP 10.102.59.206 &amp;lt;none&amp;gt; 8080/TCP 9m44s
webapp1-nodeport-svc NodePort 10.102.135.99 &amp;lt;none&amp;gt; 80:30080/TCP 5m52s
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl describe svc/webapp1-nodeport-svc
Name: webapp1-nodeport-svc
Namespace: default
Labels: &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>webapp1-nodeport
Annotations: kubectl.kubernetes.io/last-applied-configuration:
&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;apiVersion&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;v1&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;kind&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Service&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;annotations&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;app&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;webapp1-nodeport&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>,&lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;webapp1-nodeport-svc&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;namesp...
&lt;/span>&lt;span class="s2">Selector: app=webapp1-nodeport
&lt;/span>&lt;span class="s2">Type: NodePort
&lt;/span>&lt;span class="s2">IP: 10.102.135.99
&lt;/span>&lt;span class="s2">Port: &amp;lt;unset&amp;gt; 80/TCP
&lt;/span>&lt;span class="s2">TargetPort: 80/TCP
&lt;/span>&lt;span class="s2">NodePort: &amp;lt;unset&amp;gt; 30080/TCP
&lt;/span>&lt;span class="s2">Endpoints: 10.32.0.10:80,10.32.0.9:80
&lt;/span>&lt;span class="s2">Session Affinity: None
&lt;/span>&lt;span class="s2">External Traffic Policy: Cluster
&lt;/span>&lt;span class="s2">Events: &amp;lt;none&amp;gt;
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以通过 &lt;em>NodePort&lt;/em> 定义的 &lt;em>Node&lt;/em> 的 &lt;em>IP&lt;/em> 地址访问到服务。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ curl 172.17.0.31:30080
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-nodeport-deployment-677bd89b96-j256b&amp;lt;/h1&amp;gt;
controlplane $ curl 172.17.0.31:30080
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-nodeport-deployment-677bd89b96-88qj5&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="external-ip">External IP&lt;/h2>
&lt;p>另一种方法是通过外部 &lt;em>IP&lt;/em> 地址让服务在集群外可用。&lt;/p>
&lt;p>将定义中的 &lt;em>externalIPs&lt;/em> 更新为当前集群的 IP 地址&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ sed -i &lt;span class="s1">&amp;#39;s/HOSTIP/172.17.0.31/g&amp;#39;&lt;/span> externalip.yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>externalip.yaml&lt;/strong>&lt;/p>
&lt;pre>&lt;code>apiVersion: v1
kind: Service
metadata:
name: webapp1-externalip-svc
labels:
app: webapp1-externalip
spec:
ports:
- port: 80
externalIPs:
- 172.17.0.30
selector:
app: webapp1-externalip
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
name: webapp1-externalip-deployment
spec:
replicas: 2
template:
metadata:
labels:
app: webapp1-externalip
spec:
containers:
- name: webapp1-externalip-pod
image: katacoda/docker-http-server:latest
ports:
- containerPort: 80
---
controlplane $ cat externalip.yaml
apiVersion: v1
kind: Service
metadata:
name: webapp1-externalip-svc
labels:
app: webapp1-externalip
spec:
ports:
- port: 80
externalIPs:
- 172.17.0.30
selector:
app: webapp1-externalip
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
name: webapp1-externalip-deployment
spec:
replicas: 2
template:
metadata:
labels:
app: webapp1-externalip
spec:
containers:
- name: webapp1-externalip-pod
image: katacoda/docker-http-server:latest
ports:
- containerPort: 80
---
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl apply -f externalip.yaml
service/webapp1-externalip-svc created
deployment.extensions/webapp1-externalip-deployment created
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get svc
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 28m
webapp1-clusterip-svc ClusterIP 10.108.32.169 &amp;lt;none&amp;gt; 80/TCP 20m
webapp1-clusterip-targetport-svc ClusterIP 10.102.59.206 &amp;lt;none&amp;gt; 8080/TCP 15m
webapp1-externalip-svc ClusterIP 10.109.28.108 172.17.0.31 80/TCP 8s
webapp1-nodeport-svc NodePort 10.102.135.99 &amp;lt;none&amp;gt; 80:30080/TCP 12m
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl describe svc/webapp1-externalip-svc
Name: webapp1-externalip-svc
Namespace: default
Labels: &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>webapp1-externalip
Annotations: kubectl.kubernetes.io/last-applied-configuration:
&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;apiVersion&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;v1&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;kind&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Service&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;annotations&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;app&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;webapp1-externalip&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>,&lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;webapp1-externalip-svc&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;na...
&lt;/span>&lt;span class="s2">Selector: app=webapp1-externalip
&lt;/span>&lt;span class="s2">Type: ClusterIP
&lt;/span>&lt;span class="s2">IP: 10.109.28.108
&lt;/span>&lt;span class="s2">External IPs: 172.17.0.31
&lt;/span>&lt;span class="s2">Port: &amp;lt;unset&amp;gt; 80/TCP
&lt;/span>&lt;span class="s2">TargetPort: 80/TCP
&lt;/span>&lt;span class="s2">Endpoints: 10.32.0.11:80,10.32.0.12:80
&lt;/span>&lt;span class="s2">Session Affinity: None
&lt;/span>&lt;span class="s2">Events: &amp;lt;none&amp;gt;
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>该服务现在绑定到主节点的 &lt;em>IP&lt;/em> 地址和 &lt;em>80&lt;/em>端口 。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ curl 172.17.0.31
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-externalip-deployment-6446b488f8-dxdb5&amp;lt;/h1&amp;gt;
controlplane $ curl 172.17.0.31
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-externalip-deployment-6446b488f8-2zw2p&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="load-balancer">Load Balancer&lt;/h2>
&lt;p>在例如 &lt;em>EC2&lt;/em> 或 &lt;em>Azure&lt;/em> 的云服务中运行时，可以通过云服务商配置和分配发布的公网 &lt;em>IP&lt;/em> 地址。这将通过负载均衡器（例如 &lt;em>ELB&lt;/em>）发出，允许将额外的公网 &lt;em>IP&lt;/em> 地址分配给 &lt;em>Kubernetes&lt;/em> 集群，而无需直接与云提供商交互。&lt;/p>
&lt;p>由于 &lt;em>Katacoda&lt;/em> 不是云服务商，因此仍然可以为 &lt;em>LoadBalancer&lt;/em> 类型的服务动态分配 &lt;em>IP&lt;/em> 地址。这是通过使用 &lt;code>kubectl apply -f cloudprovider.yaml&lt;/code> 部署 &lt;em>Cloud Provider&lt;/em> 来完成的。并不是必需在云服务商提供的服务中运行的。&lt;/p>
&lt;p>&lt;strong>cloudprovider.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">extensions/v1beta1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">DaemonSet&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-keepalived-vip&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-system&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-keepalived-vip&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostNetwork&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">gcr.io/google_containers/kube-keepalived-vip:0.9&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-keepalived-vip&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">imagePullPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Always&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">securityContext&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">privileged&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/lib/modules&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">modules&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">readOnly&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/dev&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dev&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># use downward API&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">env&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">POD_NAME&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">valueFrom&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">fieldRef&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">fieldPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">metadata.name&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">POD_NAMESPACE&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">valueFrom&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">fieldRef&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">fieldPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">metadata.namespace&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># to use unicast&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- --&lt;span class="l">services-configmap=kube-system/vip-configmap&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># unicast uses the ip of the nodes instead of multicast&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># this is useful if running in cloud providers (like AWS)&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#- --use-unicast=true&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">modules&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/lib/modules&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dev&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/dev&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># type: worker # adjust this to match your worker nodes&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="c">## We also create an empty ConfigMap to hold our config&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ConfigMap&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">vip-configmap&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-system&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">data&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1beta1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">keepalived-cloud-provider&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">keepalived-cloud-provider&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-system&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">revisionHistoryLimit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">keepalived-cloud-provider&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">strategy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">RollingUpdate&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">annotations&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">scheduler.alpha.kubernetes.io/critical-pod&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">scheduler.alpha.kubernetes.io/tolerations&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;[{&amp;#34;key&amp;#34;:&amp;#34;CriticalAddonsOnly&amp;#34;, &amp;#34;operator&amp;#34;:&amp;#34;Exists&amp;#34;}]&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">keepalived-cloud-provider&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">keepalived-cloud-provider&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">quay.io/munnerz/keepalived-cloud-provider:0.0.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">imagePullPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">IfNotPresent&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">env&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">KEEPALIVED_NAMESPACE&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-system&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">KEEPALIVED_CONFIG_MAP&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">vip-configmap&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">KEEPALIVED_SERVICE_CIDR&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10.10.0.0&lt;/span>&lt;span class="l">/26&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># pick a CIDR that is explicitly reserved for keepalived&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">certs&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/etc/ssl/certs&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">requests&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">cpu&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">200m&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">livenessProbe&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">httpGet&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/healthz&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10252&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">127.0.0.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">initialDelaySeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">15&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">timeoutSeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">15&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">failureThreshold&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">certs&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/etc/ssl/certs&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl apply -f cloudprovider.yaml
daemonset.extensions/kube-keepalived-vip configured
configmap/vip-configmap configured
deployment.apps/keepalived-cloud-provider created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>当服务请求负载均衡时，负载均衡的提供商将从配置中定义的 10.10.0.0/26 范围中分配一个 &lt;em>IP&lt;/em>。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pods -n kube-system
NAME READY STATUS RESTARTS AGE
coredns-fb8b8dccf-6rvjq 1/1 Running &lt;span class="m">0&lt;/span> 39m
coredns-fb8b8dccf-p5lxm 1/1 Running &lt;span class="m">0&lt;/span> 39m
etcd-controlplane 1/1 Running &lt;span class="m">0&lt;/span> 38m
katacoda-cloud-provider-66d7758d5d-bn748 1/1 Running &lt;span class="m">0&lt;/span> 39m
keepalived-cloud-provider-78fc4468b-bk8wn 1/1 Running &lt;span class="m">0&lt;/span> 6m16s
kube-apiserver-controlplane 1/1 Running &lt;span class="m">0&lt;/span> 39m
kube-controller-manager-controlplane 1/1 Running &lt;span class="m">2&lt;/span> 39m
kube-keepalived-vip-42ql5 1/1 Running &lt;span class="m">0&lt;/span> 38m
kube-proxy-d5q4m 1/1 Running &lt;span class="m">0&lt;/span> 39m
kube-scheduler-controlplane 1/1 Running &lt;span class="m">3&lt;/span> 39m
weave-net-9rc2g 2/2 Running &lt;span class="m">1&lt;/span> 39m
&lt;/code>&lt;/pre>&lt;/div>&lt;p>该服务是通过负载均衡配置的，如 &lt;em>cat loadbalancer.yaml&lt;/em> 中所定义所示。&lt;/p>
&lt;p>&lt;strong>loadbalancer.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-loadbalancer-svc&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-loadbalancer&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">LoadBalancer&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-loadbalancer&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">extensions/v1beta1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-loadbalancer-deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-loadbalancer&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-loadbalancer-pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">katacoda/docker-http-server:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl apply -f loadbalancer.yaml
service/webapp1-loadbalancer-svc created
deployment.extensions/webapp1-loadbalancer-deployment created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>在定义 &lt;em>IP&lt;/em> 地址时，服务将显示 &lt;em>Pending&lt;/em>。分配后，它将出现在服务列表中。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get svc
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 38m
webapp1-clusterip-svc ClusterIP 10.108.32.169 &amp;lt;none&amp;gt; 80/TCP 31m
webapp1-clusterip-targetport-svc ClusterIP 10.102.59.206 &amp;lt;none&amp;gt; 8080/TCP 26m
webapp1-externalip-svc ClusterIP 10.109.28.108 172.17.0.31 80/TCP 10m
webapp1-loadbalancer-svc LoadBalancer 10.105.60.108 172.17.0.31 80:30626/TCP 7s
webapp1-nodeport-svc NodePort 10.102.135.99 &amp;lt;none&amp;gt; 80:30080/TCP 22m
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl describe svc/webapp1-loadbalancer-svc
Name: webapp1-loadbalancer-svc
Namespace: default
Labels: &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>webapp1-loadbalancer
Annotations: kubectl.kubernetes.io/last-applied-configuration:
&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;apiVersion&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;v1&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;kind&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Service&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;annotations&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;app&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;webapp1-loadbalancer&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>,&lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;webapp1-loadbalancer-svc&amp;#34;&lt;/span>...
Selector: &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>webapp1-loadbalancer
Type: LoadBalancer
IP: 10.105.60.108
LoadBalancer Ingress: 172.17.0.31
Port: &amp;lt;unset&amp;gt; 80/TCP
TargetPort: 80/TCP
NodePort: &amp;lt;unset&amp;gt; 30626/TCP
Endpoints: 10.32.0.14:80,10.32.0.15:80
Session Affinity: None
External Traffic Policy: Cluster
Events:
Type Reason Age From Message
---- ------ ---- ---- -------
Normal CreatingLoadBalancer 95s service-controller Creating load balancer
Normal CreatedLoadBalancer 95s service-controller Created load balancer
&lt;/code>&lt;/pre>&lt;/div>&lt;p>现在可以通过分配的 &lt;em>IP&lt;/em> 地址访问该服务，在本例中的范围是 &lt;em>10.10.0.0/26&lt;/em> 。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ &lt;span class="nb">export&lt;/span> &lt;span class="nv">LoadBalancerIP&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>kubectl get services/webapp1-loadbalancer-svc -o go-template&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;{{(index .status.loadBalancer.ingress 0).ip}}&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
controlplane $ &lt;span class="nb">echo&lt;/span> &lt;span class="nv">LoadBalancerIP&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$LoadBalancerIP&lt;/span>
&lt;span class="nv">LoadBalancerIP&lt;/span>&lt;span class="o">=&lt;/span>172.17.0.31
controlplane $ curl &lt;span class="nv">$LoadBalancerIP&lt;/span>
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-externalip-deployment-6446b488f8-2zw2p&amp;lt;/h1&amp;gt;
controlplane $ curl &lt;span class="nv">$LoadBalancerIP&lt;/span>
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-externalip-deployment-6446b488f8-dxdb5&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Kubernetes初探（五）</title><link>https://www.catfish.top/p/k8s-basic-5/</link><pubDate>Tue, 20 Jul 2021 13:18:00 +0800</pubDate><guid>https://www.catfish.top/p/k8s-basic-5/</guid><description>&lt;img src="https://www.catfish.top/p/k8s-basic-5/kubernates.png" alt="Featured image of post Kubernetes初探（五）" />&lt;blockquote>
&lt;p>Katacoda在线课：&lt;a class="link" href="https://www.katacoda.com/courses/kubernetes/guestbook" target="_blank" rel="noopener"
>Deploy Guestbook Web App Example&lt;/a>&lt;/p>
&lt;p>本系列教程希望能通过交互式学习网站与传统方式结合，更高效、容易的学习知识。
本系列教程将使用 &lt;a class="link" href="https://www.katacoda.com" target="_blank" rel="noopener"
>Katacoda在线学习平台&lt;/a> 完成学习。&lt;/p>
&lt;/blockquote>
&lt;p>本场景说明了如何使用 &lt;em>Kubernetes&lt;/em> 和 &lt;em>Docker&lt;/em> 启动简单的多层 &lt;em>Web&lt;/em> 应用。留言簿示例应用程序通过调用* JavaScript API* 将访客的笔记存储在 *Redis* 中。 *Redis* 包含一个 master（用于存储）和一组 *slave* 复制集。&lt;/p>
&lt;h3 id="核心概念">核心概念&lt;/h3>
&lt;p>在此场景中将涵盖以下核心概念。这些是理解 &lt;em>Kubernetes&lt;/em> 的基础。&lt;/p>
&lt;ul>
&lt;li>Pods&lt;/li>
&lt;li>Replication Controllers&lt;/li>
&lt;li>Services&lt;/li>
&lt;li>NodePorts&lt;/li>
&lt;/ul>
&lt;h2 id="启动-kubernetes">启动 Kubernetes&lt;/h2>
&lt;p>首先，我们需要一个正在运行的 &lt;em>Kubernetes&lt;/em> 集群。详细信息在 &lt;a class="link" href="https://www.katacoda.com/courses/kubernetes/launch-cluster" target="_blank" rel="noopener"
>Launch Kubernetes cluster&lt;/a>&lt;/p>
&lt;h3 id="任务">任务&lt;/h3>
&lt;p>使用初始化程序脚本启动单节点集群。初始化脚本将启动 &lt;em>API&lt;/em>、&lt;em>Master&lt;/em>、&lt;em>Proxy&lt;/em> 和 &lt;em>DNS Discovery&lt;/em>。 &lt;em>Web App&lt;/em> 使用 &lt;em>DNS Discovery&lt;/em> 来查找 &lt;em>Redis slave&lt;/em> 来存储数据。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">launch.sh
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="健康检查">健康检查&lt;/h3>
&lt;p>使用 &lt;code>kubectl cluster-info&lt;/code> 和 &lt;code>kubectl get nodes&lt;/code>命令来检查部署的集群的节点健康信息。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl cluster-info
Kubernetes master is running at https://172.17.0.81:6443
KubeDNS is running at https://172.17.0.81:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
To further debug and diagnose cluster problems, use &lt;span class="s1">&amp;#39;kubectl cluster-info dump&amp;#39;&lt;/span>.
controlplane $ kubectl get nodes
NAME STATUS ROLES AGE VERSION
controlplane Ready master 2m15s v1.14.0
node01 Ready &amp;lt;none&amp;gt; 114s v1.14.0
&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果节点返回 &lt;em>NotReady&lt;/em>，则它仍在等待。请等待几秒钟后再重新启动。&lt;/p>
&lt;h2 id="redis-master---replication-controller">Redis Master - Replication Controller&lt;/h2>
&lt;p>启动应用的第一步是启动&lt;em>Redis Master&lt;/em>。 &lt;em>Kubernetes&lt;/em> 服务部署至少有两个部分，分别为 &lt;em>Replication Controller&lt;/em> 和 &lt;em>Service&lt;/em>。&lt;/p>
&lt;p>&lt;em>Replication Controller&lt;/em> 定义了运行的实例数量、要使用的 &lt;em>Docker&lt;/em> 镜像以及服务标识名称。其他选项可用于配置和发现。使用上面的编辑器查看 &lt;em>YAML&lt;/em> 定义。&lt;/p>
&lt;p>如果 &lt;em>Redis&lt;/em> 出现故障，&lt;em>Replication Controller&lt;/em> 将在活动节点上重新启动它。&lt;/p>
&lt;h3 id="创建-replication-controller">创建 &lt;em>Replication Controller&lt;/em>&lt;/h3>
&lt;p>&lt;strong>redis-master-controller.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ReplicationController&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis-master&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis-master&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis-master&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis-master&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">master&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis:3.0.7-alpine&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">6379&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在本示例中，&lt;em>YAML&lt;/em> 使用官方 &lt;em>redis&lt;/em> 设置端口 &lt;em>6379&lt;/em> 运行了一个名为 &lt;em>redis-master&lt;/em> 的 redis 服务器。&lt;/p>
&lt;p>&lt;em>kubectl create&lt;/em> 命令采用 &lt;em>YAML&lt;/em> 定义并指示 &lt;em>master&lt;/em> 启动控制器。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl create -f redis-master-controller.yaml
replicationcontroller/redis-master created
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="查看运行的组件">查看运行的组件&lt;/h3>
&lt;p>上面的命令创建了一个 &lt;em>Replication Controller&lt;/em> 。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get rc
NAME DESIRED CURRENT READY AGE
redis-master &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 2m9s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>所有容器都被描述为 &lt;em>Pod&lt;/em>。 &lt;em>Pod&lt;/em> 是构成特定应用程序（例如 &lt;em>Redis&lt;/em>）的容器集合。可以使用 &lt;em>kubectl&lt;/em> 查看 &lt;em>Pod&lt;/em> 信息。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pods
NAME READY STATUS RESTARTS AGE
redis-master-qkfxw 1/1 Running &lt;span class="m">0&lt;/span> 2m54s
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="redis-master---service">Redis Master - Service&lt;/h2>
&lt;p>第二步是 &lt;em>Service&lt;/em>。 &lt;em>Kubernetes&lt;/em> &lt;em>Service&lt;/em> 是一种命名负载均衡器，它将流量代理到一个或多个容器。即使容器位于不同的节点上，代理也能工作。&lt;/p>
&lt;p>服务代理在集群内通信，很少将端口暴露给外部接口。&lt;/p>
&lt;p>当启动服务时，似乎无法使用 &lt;em>curl&lt;/em> 或 &lt;em>netcat&lt;/em> 进行连接，除非=将其作为 &lt;em>Kubernetes&lt;/em> 的一部分启动。推荐的方法是使用 &lt;em>LoadBalancer&lt;/em> 服务来处理外部通信。&lt;/p>
&lt;p>&lt;strong>redis-master-service.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis-master&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis-master&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># the port that this service should serve on&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">6379&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">targetPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">6379&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis-master&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="创建-service">创建 Service&lt;/h3>
&lt;p>YAML 定义了 &lt;em>Service&lt;/em> 的名称&lt;em>redis-master&lt;/em>，以及应该被代理的端口。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl create -f redis-master-service.yaml
service/redis-master created
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="查看-service-列表与详情">查看 Service 列表与详情&lt;/h3>
&lt;p>bash
controlplane $ kubectl get services
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE
kubernetes ClusterIP 10.96.0.1 &lt;!-- raw HTML omitted --> 443/TCP 10m
redis-master ClusterIP 10.100.28.180 &lt;!-- raw HTML omitted --> 6379/TCP 43s&lt;/p>
&lt;p>controlplane $ kubectl describe services redis-master
Name: redis-master
Namespace: default
Labels: name=redis-master
Annotations: &lt;!-- raw HTML omitted -->
Selector: name=redis-master
Type: ClusterIP
IP: 10.100.28.180
Port: &lt;!-- raw HTML omitted --> 6379/TCP
TargetPort: 6379/TCP
Endpoints: 10.32.0.193:6379
Session Affinity: None
Events: &lt;!-- raw HTML omitted -->&lt;/p>
&lt;pre>&lt;code>
## Redis Slave Pods
在本示例中，我们将运行 *Redis Slaves*，它会从 *master* 复制数据。有关 *Redis* 复制的更多详细信息，请访问 [http://redis.io/topics/replication](http://redis.io/topics/replication)
如前所述，*Controller* 定义了 *Service* 的运行方式。在这个例子中，我们需要确定 *Service* 是如何发现其他 *Pod*。 *YAML* 将 *GET_HOSTS_FROM* 属性表示为 *DNS*。您可以将其更改为在 *YAML* 中使用环境变量，但这会引入创建顺序依赖关系，因为需要运行服务才能定义环境变量。
**redis-slave-controller.yaml**
```yaml
apiVersion: v1
kind: ReplicationController
metadata:
name: redis-slave
labels:
name: redis-slave
spec:
replicas: 2
selector:
name: redis-slave
template:
metadata:
labels:
name: redis-slave
spec:
containers:
- name: worker
image: gcr.io/google_samples/gb-redisslave:v1
env:
- name: GET_HOSTS_FROM
value: dns
# If your cluster config does not include a dns service, then to
# instead access an environment variable to find the master
# service's host, comment out the 'value: dns' line above, and
# uncomment the line below.
# value: env
ports:
- containerPort: 6379
&lt;/code>&lt;/pre>&lt;h3 id="启动-redis-slave-controller">启动 Redis Slave Controller&lt;/h3>
&lt;p>在这种情况下，我们将使用镜像 &lt;em>kubernetes/redis-slave:v2&lt;/em> 启动 &lt;em>Pod&lt;/em> 的两个实例。它将通过 &lt;em>DNS&lt;/em> 链接到 &lt;em>redis-master&lt;/em>。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl create -f redis-slave-controller.yaml
replicationcontroller/redis-slave created
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="列出-replication-controller">列出 &lt;em>Replication Controller&lt;/em>&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">NAME DESIRED CURRENT READY AGE
redis-master &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 11m
redis-slave &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> 26s
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="redis-slave-service">Redis Slave Service&lt;/h2>
&lt;p>和以前一样，我们需要启动一个与 &lt;em>redis-slave&lt;/em> 通信的&lt;code>Service&lt;/code>来让&lt;code>Slave&lt;/code>能够接收传入的请求。&lt;/p>
&lt;p>因为我们有两个复制的 &lt;em>Pod&lt;/em>，该服务还将在两个节点之间提供负载平衡。&lt;/p>
&lt;p>&lt;strong>redis-slave-service.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis-slave&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis-slave&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># the port that this service should serve on&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">6379&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis-slave&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="start-redis-slave-service">Start Redis Slave Service&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl create -f redis-slave-service.yaml
service/redis-slave created
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get services
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 2m20s
redis-master ClusterIP 10.100.144.249 &amp;lt;none&amp;gt; 6379/TCP 46s
redis-slave ClusterIP 10.105.27.32 &amp;lt;none&amp;gt; 6379/TCP 16s
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="前端-replicated-pods">前端 Replicated Pods&lt;/h2>
&lt;p>启动数据服务后，我们现在可以部署 &lt;em>Web&lt;/em> 应用。部署 &lt;em>Web&lt;/em> 应用的模式与我们之前部署的 &lt;em>Pod&lt;/em> 相同。&lt;/p>
&lt;h3 id="启动前端">启动前端&lt;/h3>
&lt;p>&lt;em>YAML&lt;/em> 定义了一个名为 &lt;em>frontend&lt;/em> 的服务，该服务使用 &lt;em>gcr.io/google_samples/gb-frontend:v3&lt;/em> 的镜像。&lt;em>Replication Controller&lt;/em> 将确保三个 &lt;em>Pod&lt;/em> 始终存在。&lt;/p>
&lt;p>&lt;strong>frontend-controller.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ReplicationController&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">php-redis&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">gcr.io/google_samples/gb-frontend:v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">env&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">GET_HOSTS_FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dns&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># If your cluster config does not include a dns service, then to&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># instead access environment variables to find service host&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># info, comment out the &amp;#39;value: dns&amp;#39; line above, and uncomment the&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># line below.&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># value: env&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl create -f frontend-controller.yaml
replicationcontroller/frontend created
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="列出-controllers-和-pods">列出 Controllers 和 Pods&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get rc
NAME DESIRED CURRENT READY AGE
frontend &lt;span class="m">3&lt;/span> &lt;span class="m">3&lt;/span> &lt;span class="m">3&lt;/span> 34s
redis-master &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 8m20s
redis-slave &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> 8m6s
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pods
NAME READY STATUS RESTARTS AGE
frontend-88lvf 1/1 Running &lt;span class="m">0&lt;/span> 42s
frontend-phhhv 1/1 Running &lt;span class="m">0&lt;/span> 42s
frontend-rq8tt 1/1 Running &lt;span class="m">0&lt;/span> 42s
redis-master-7h9t2 1/1 Running &lt;span class="m">0&lt;/span> 8m28s
redis-slave-gnhfh 1/1 Running &lt;span class="m">0&lt;/span> 8m14s
redis-slave-mtn2r 1/1 Running &lt;span class="m">0&lt;/span> 8m14s
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="php-代码">PHP 代码&lt;/h3>
&lt;p>&lt;em>PHP&lt;/em> 代码使用 &lt;em>HTTP&lt;/em> 和 &lt;em>JSON&lt;/em> 与 &lt;em>Redis&lt;/em> 通信。当设置一个值时，请求转到 &lt;em>redis-master&lt;/em>，而读取的数据来自 &lt;em>redis-slave&lt;/em> 节点。&lt;/p>
&lt;h2 id="用户手册前端-service">用户手册前端 Service&lt;/h2>
&lt;p>为了能够访问前端，我们需要启动一个 &lt;em>Service&lt;/em> 来配置代理。&lt;/p>
&lt;h3 id="启动代理">启动代理&lt;/h3>
&lt;p>&lt;em>YAML&lt;/em> 将服务定义为 &lt;em>NodePort&lt;/em> 。 &lt;em>NodePort&lt;/em> 允许您设置在整个集群中共享的特点端口，这就像 Docker 中的 &lt;em>-p 80:80&lt;/em>。&lt;/p>
&lt;p>在这种情况下，我们定义我们的 &lt;em>Web&lt;/em> 应用在端口 &lt;em>80&lt;/em> 上运行，在 &lt;em>30080&lt;/em> 上开放服务。&lt;/p>
&lt;p>&lt;strong>frontend-service.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># if your cluster supports it, uncomment the following to automatically create&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># an external load-balanced IP for the frontend service.&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># type: LoadBalancer&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NodePort&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># the port that this service should serve on&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">nodePort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">30080&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">frontend&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl create -f frontend-service.yaml
service/frontend created
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get services
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
frontend NodePort 10.98.211.171 &amp;lt;none&amp;gt; 80:30080/TCP 3s
kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 13m
redis-master ClusterIP 10.100.144.249 &amp;lt;none&amp;gt; 6379/TCP 11m
redis-slave ClusterIP 10.105.27.32 &amp;lt;none&amp;gt; 6379/TCP 11m
&lt;/code>&lt;/pre>&lt;/div>&lt;p>我们将在未来的场景中讨论 &lt;em>NodePort&lt;/em> 。&lt;/p>
&lt;h2 id="访问用户手册前端">访问用户手册前端&lt;/h2>
&lt;p>定义了所有 &lt;em>Controller&lt;/em> 和 &lt;em>Service&lt;/em> 后，&lt;em>Kubernetes&lt;/em> 将开始将它们作为 &lt;em>Pod&lt;/em> 启动。根据实际发生的情况，&lt;em>Pod&lt;/em> 可以具有不同的状态。例如，如果 &lt;em>Docker&lt;/em> 映像仍在下载无法启动，则 &lt;em>Pod&lt;/em> 将处于 &lt;em>pending&lt;/em> 状态。准备就绪后，状态将会变更为 &lt;em>running&lt;/em>。&lt;/p>
&lt;h3 id="查看-pods-状态">查看 Pods 状态&lt;/h3>
&lt;p>可以使用下列命令查看所有 &lt;em>Pod&lt;/em> 的状态。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pods
NAME READY STATUS RESTARTS AGE
frontend-88lvf 1/1 Running &lt;span class="m">0&lt;/span> 9m3s
frontend-phhhv 1/1 Running &lt;span class="m">0&lt;/span> 9m3s
frontend-rq8tt 1/1 Running &lt;span class="m">0&lt;/span> 9m3s
redis-master-7h9t2 1/1 Running &lt;span class="m">0&lt;/span> 16m
redis-slave-gnhfh 1/1 Running &lt;span class="m">0&lt;/span> 16m
redis-slave-mtn2r 1/1 Running &lt;span class="m">0&lt;/span> 16m
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="查找-nodeport">查找 NodePort&lt;/h3>
&lt;p>如果您没有分配 &lt;em>众所周知&lt;/em>（well-known） 的 &lt;em>NodePort&lt;/em>，那么 &lt;em>Kubernetes&lt;/em> 将随机分配一个可用端口。您可以使用 &lt;em>kubectl&lt;/em> 找到分配的 &lt;em>NodePort&lt;/em>。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl describe service frontend &lt;span class="p">|&lt;/span> grep NodePort
Type: NodePort
NodePort: &amp;lt;unset&amp;gt; 30080/TCP
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="查看-ui">查看 UI&lt;/h3>
&lt;p>一旦 &lt;em>Pod&lt;/em> 处于 &lt;em>running&lt;/em> 状态，您将能够通过端口 &lt;em>30080&lt;/em> 查看 &lt;em>UI&lt;/em>。使用 &lt;em>URL&lt;/em> 查看页面 &lt;a class="link" href="https://2886795308-30080-kitek05.environments.katacoda.com/" target="_blank" rel="noopener"
>https://2886795308-30080-kitek05.environments.katacoda.com&lt;/a>&lt;/p>
&lt;p>&lt;em>在背后&lt;/em>（Under the covers） &lt;em>PHP&lt;/em> 服务通过 &lt;em>DNS&lt;/em> 发现 &lt;em>Redis&lt;/em> 实例。您现在已经在 &lt;em>Kubernetes&lt;/em> 上部署了一个有效的多层应用程序。&lt;/p></description></item><item><title>Kubernetes初探（四）</title><link>https://www.catfish.top/p/k8s-basic-4/</link><pubDate>Tue, 20 Jul 2021 11:39:00 +0800</pubDate><guid>https://www.catfish.top/p/k8s-basic-4/</guid><description>&lt;img src="https://www.catfish.top/p/k8s-basic-4/kubernates.png" alt="Featured image of post Kubernetes初探（四）" />&lt;blockquote>
&lt;p>Katacoda在线课：&lt;a class="link" href="https://www.katacoda.com/courses/kubernetes/creating-kubernetes-yaml-definitions" target="_blank" rel="noopener"
>Deploy Containers Using YAML&lt;/a>&lt;/p>
&lt;p>本系列教程希望能通过交互式学习网站与传统方式结合，更高效、容易的学习知识。
本系列教程将使用 &lt;a class="link" href="https://www.katacoda.com" target="_blank" rel="noopener"
>Katacoda在线学习平台&lt;/a> 完成学习。&lt;/p>
&lt;/blockquote>
&lt;p>在此场景中，您将学习如何使用 &lt;em>Kubectl&lt;/em> 创建和启动 &lt;em>Deployment&lt;/em>、&lt;em>Replication Controller&lt;/em>，并通过编写 &lt;em>yaml&lt;/em> 定义使用服务开暴露它们。&lt;/p>
&lt;p>&lt;em>YAML&lt;/em> 定义了计划部署的 &lt;em>Kubernetes&lt;/em> 对象。可以以更新对象并将其重新部署到集群的方式来更改配置。&lt;/p>
&lt;h2 id="创建-deployment">创建 Deployment&lt;/h2>
&lt;p>&lt;em>Deployment&lt;/em> 对象是最常见的 &lt;em>Kubernetes&lt;/em> 对象之一。&lt;em>Deployment&lt;/em> 对象定义了所需的容器规范，以及 &lt;em>Kubernetes&lt;/em> 其他部分用来发现和连接到应用程序的名称和标签。&lt;/p>
&lt;h3 id="任务">任务&lt;/h3>
&lt;p>将以下定义复制到编辑器的&lt;em>YAML&lt;/em>文件中。该 &lt;em>YAML&lt;/em> 定义了如何使用在端口 &lt;em>80&lt;/em> 上运行的应用，该应用使用 &lt;em>Docker&lt;/em> 映像 &lt;em>katacoda/docker-http-server&lt;/em> ，启动名为 &lt;em>webapp1&lt;/em> 。&lt;/p>
&lt;p>&lt;strong>deployment.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">katacoda/docker-http-server:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用 &lt;code>kubectl create -f deployment.yaml&lt;/code> 命令向集群部署。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl create -f deployment.yaml
deployment.apps/webapp1 created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>由于它是一个 &lt;em>Deployment&lt;/em> 对象，因此可以通过 &lt;code>kubectl get deployment&lt;/code> 获取所有已部署的 &lt;em>Deployment&lt;/em> 对象的列表。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl get deployment
NAME READY UP-TO-DATE AVAILABLE AGE
webapp1 1/1 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 10s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以使用 &lt;code>kubectl describe deployment webapp1&lt;/code> 输出单个部署的详细信息。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl describe deployment webapp1
Name: webapp1
Namespace: default
CreationTimestamp: Wed, &lt;span class="m">21&lt;/span> Jul &lt;span class="m">2021&lt;/span> 09:31:47 +0000
Labels: &amp;lt;none&amp;gt;
Annotations: deployment.kubernetes.io/revision: &lt;span class="m">1&lt;/span>
Selector: &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>webapp1
Replicas: &lt;span class="m">1&lt;/span> desired &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> updated &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> total &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> available &lt;span class="p">|&lt;/span> &lt;span class="m">0&lt;/span> unavailable
StrategyType: RollingUpdate
MinReadySeconds: &lt;span class="m">0&lt;/span>
RollingUpdateStrategy: 25% max unavailable, 25% max surge
Pod Template:
Labels: &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>webapp1
Containers:
webapp1:
Image: katacoda/docker-http-server:latest
Port: 80/TCP
Host Port: 0/TCP
Environment: &amp;lt;none&amp;gt;
Mounts: &amp;lt;none&amp;gt;
Volumes: &amp;lt;none&amp;gt;
Conditions:
Type Status Reason
---- ------ ------
Available True MinimumReplicasAvailable
Progressing True NewReplicaSetAvailable
OldReplicaSets: &amp;lt;none&amp;gt;
NewReplicaSet: webapp1-6b54fb89d9 &lt;span class="o">(&lt;/span>1/1 replicas created&lt;span class="o">)&lt;/span>
Events:
Type Reason Age From Message
---- ------ ---- ---- -------
Normal ScalingReplicaSet 49s deployment-controller Scaled up replica &lt;span class="nb">set&lt;/span> webapp1-6b54fb89d9 to &lt;span class="m">1&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="创建service">创建Service&lt;/h2>
&lt;p>&lt;em>Kubernetes&lt;/em> 具有强大的网络功能，可以控制应用程序的通信方式。这些网络配置也可以通过 &lt;em>YAML&lt;/em> 定义。&lt;/p>
&lt;h3 id="任务-1">任务&lt;/h3>
&lt;p>将 &lt;em>Service&lt;/em> 定义复制到编辑器。该 &lt;em>Service&lt;/em> 选择带有标签 &lt;em>webapp1&lt;/em> 的所有应用程序。当部署多个副本或实例时，它们将根据此公共标签自动进行负载平衡。该 &lt;em>Service&lt;/em> 通过 &lt;em>NodePort&lt;/em> 的网络连接方式部署。&lt;/p>
&lt;p>&lt;strong>service.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1-svc&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NodePort&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">nodePort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">30080&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">webapp1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>所有 &lt;em>Kubernetes&lt;/em> 对象都一致使用 &lt;em>kubectl&lt;/em> 完成部署。&lt;/p>
&lt;p>使用 &lt;code>kubectl create -f service.yaml&lt;/code> 命令部署 &lt;em>Service&lt;/em>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl create -f service.yaml
service/webapp1-svc created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>和以往一样，使用 &lt;code>kubectl get svc&lt;/code> 可以查看所有已部署的 &lt;em>Service&lt;/em> 对象的信息。通过 &lt;code>kubectl describe svc webapp1-svc&lt;/code> 命令可以查看该 &lt;em>Service&lt;/em> 对象更多的配置信息。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl get svc
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 6m38s
webapp1-svc NodePort 10.111.56.111 &amp;lt;none&amp;gt; 80:30080/TCP 20s
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl describe svc webapp1-svc
Name: webapp1-svc
Namespace: default
Labels: &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>webapp1
Annotations: &amp;lt;none&amp;gt;
Selector: &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>webapp1
Type: NodePort
IP: 10.111.56.111
Port: &amp;lt;unset&amp;gt; 80/TCP
TargetPort: 80/TCP
NodePort: &amp;lt;unset&amp;gt; 30080/TCP
Endpoints: 172.18.0.4:80
Session Affinity: None
External Traffic Policy: Cluster
Events: &amp;lt;none&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;pre>&lt;code>$ curl host01:30080
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-6b54fb89d9-5rzpv&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;h2 id="缩放-deployment">缩放 Deployment&lt;/h2>
&lt;p>由于 &lt;em>Deployment&lt;/em> 需要不同的配置，因此可以更改 &lt;em>YAML&lt;/em> 的详细信息。这遵循基础设施即代码的思维方式。清单应在源代码控制下，并且保证生产环境的配置和源代码控制中的配置一致。&lt;/p>
&lt;h3 id="任务-2">任务&lt;/h3>
&lt;p>更新 &lt;em>deployment.yaml&lt;/em> 文件以增加运行的实例数。例如，该文件应如下所示：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="c"># --&amp;gt; &lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用 &lt;em>kubectl apply&lt;/em> 提交对现有定义的更新。要扩展副本数量，请使用 &lt;code>kubectl apply -f deployment.yaml&lt;/code> 部署更新的 &lt;em>YAML&lt;/em> 文件&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl apply -f deployment.yaml
Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
deployment.apps/webapp1 configured
&lt;/code>&lt;/pre>&lt;/div>&lt;p>集群的状态将立即更新，可通过 &lt;code>kubectl get deployment&lt;/code> 命令 查看&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl get deployment
NAME READY UP-TO-DATE AVAILABLE AGE
webapp1 4/4 &lt;span class="m">4&lt;/span> &lt;span class="m">4&lt;/span> 15m
&lt;/code>&lt;/pre>&lt;/div>&lt;p>根据定义将有额外的 &lt;code>Pods&lt;/code> 被调度到集群中， 使用 &lt;code>kubectl get pods&lt;/code> 查看 &lt;em>Pod&lt;/em> 信息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl get pods
NAME READY STATUS RESTARTS AGE
webapp1-6b54fb89d9-5rzpv 1/1 Running &lt;span class="m">0&lt;/span> 16m
webapp1-6b54fb89d9-ktvz4 1/1 Running &lt;span class="m">0&lt;/span> 2m15s
webapp1-6b54fb89d9-kzdjw 1/1 Running &lt;span class="m">0&lt;/span> 2m15s
webapp1-6b54fb89d9-x8vtv 1/1 Running &lt;span class="m">0&lt;/span> 2m15s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>由于所有 &lt;code>Pod&lt;/code> 具有相同的标签选择器，因此将由已部署的 &lt;em>Service&lt;/em> &lt;em>NodePort&lt;/em> 为这些 &lt;em>Pod&lt;/em> 提供负载平衡能力。&lt;/p>
&lt;p>向目标端口发出多个请求，可以通过返回信息发现，请求是由多个容器进行处理的。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ curl host01:30080
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-6b54fb89d9-5rzpv&amp;lt;/h1&amp;gt;
$ curl host01:30080
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-6b54fb89d9-kzdjw&amp;lt;/h1&amp;gt;
$ curl host01:30080
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-6b54fb89d9-kzdjw&amp;lt;/h1&amp;gt;
$ curl host01:30080
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-6b54fb89d9-x8vtv&amp;lt;/h1&amp;gt;
$ curl host01:30080
&amp;lt;h1&amp;gt;This request was processed by host: webapp1-6b54fb89d9-ktvz4&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>其他 &lt;em>Kubernetes&lt;/em> 网络细节和对象定义将在未来的其他场景中介绍。&lt;/p></description></item><item><title>Kubernetes初探（三）</title><link>https://www.catfish.top/p/k8s-basic-3/</link><pubDate>Tue, 20 Jul 2021 11:27:00 +0800</pubDate><guid>https://www.catfish.top/p/k8s-basic-3/</guid><description>&lt;img src="https://www.catfish.top/p/k8s-basic-3/kubernates.png" alt="Featured image of post Kubernetes初探（三）" />&lt;blockquote>
&lt;p>Katacoda在线课：&lt;a class="link" href="https://www.katacoda.com/courses/kubernetes/kubectl-run-containers" target="_blank" rel="noopener"
>Deploy Containers Using Kubectl&lt;/a>&lt;/p>
&lt;p>本系列教程希望能通过交互式学习网站与传统方式结合，更高效、容易的学习知识。
本系列教程将使用 &lt;a class="link" href="https://www.katacoda.com" target="_blank" rel="noopener"
>Katacoda在线学习平台&lt;/a> 完成学习。&lt;/p>
&lt;/blockquote>
&lt;p>在此场景中，将学习如何使用 &lt;em>Kubectl&lt;/em> 创建和启动 &lt;em>Deployment&lt;/em> 和 &lt;em>Replication Controllers&lt;/em> 并通过 &lt;em>Services&lt;/em> 对外暴露接口。本场景中无需编写 &lt;em>yaml&lt;/em> 定义，便可以快速将容器启动到集群上。&lt;/p>
&lt;h2 id="启动集群">启动集群&lt;/h2>
&lt;p>首先，我们需要启动一个 &lt;em>Kubernetes&lt;/em> 集群。&lt;/p>
&lt;p>执行以下命令启动集群并下载 &lt;em>Kubectl CLI&lt;/em>。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ minikube start --wait&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span>
* minikube v1.8.1 on Ubuntu 18.04
* Using the none driver based on user configuration
* Running on localhost &lt;span class="o">(&lt;/span>&lt;span class="nv">CPUs&lt;/span>&lt;span class="o">=&lt;/span>2, &lt;span class="nv">Memory&lt;/span>&lt;span class="o">=&lt;/span>2460MB, &lt;span class="nv">Disk&lt;/span>&lt;span class="o">=&lt;/span>145651MB&lt;span class="o">)&lt;/span> ...
* OS release is Ubuntu 18.04.4 LTS
* Preparing Kubernetes v1.17.3 on Docker 19.03.6 ...
- kubelet.resolv-conf&lt;span class="o">=&lt;/span>/run/systemd/resolve/resolv.conf
* Launching Kubernetes ...
* Enabling addons: default-storageclass, storage-provisioner
* Configuring &lt;span class="nb">local&lt;/span> host environment ...
* Done! kubectl is now configured to use &lt;span class="s2">&amp;#34;minikube&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>通过 &lt;code>kubectl get nodes&lt;/code> 命令来检查节点是否准备就绪。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl get nodes
NAME STATUS ROLES AGE VERSION
minikube Ready master 19s v1.17.3
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="kubectl-run">Kubectl Run&lt;/h2>
&lt;p>&lt;em>Run&lt;/em> 命令根据指定的参数（例如映像或副本）创建部署。该部署发布给 &lt;em>Kubernetes&lt;/em> 主节点，启动所需 &lt;em>Pod&lt;/em> 和容器的 。 &lt;em>Kubectl run&lt;/em> 类似于 &lt;em>docker run&lt;/em>，但 &lt;em>Kubectl run&lt;/em> 是在集群中运行的。&lt;/p>
&lt;p>命令的格式为 &lt;code>kubectl run &amp;lt;name of deployment&amp;gt; &amp;lt;properties&amp;gt;&lt;/code>&lt;/p>
&lt;h3 id="任务">任务&lt;/h3>
&lt;p>以下命令将启动一个名为 &lt;em>http&lt;/em> 的部署，它将启动一个基于 &lt;em>Docker&lt;/em> 镜像 &lt;em>katacoda/docker-http-server:latest&lt;/em> 的容器。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl run http --image&lt;span class="o">=&lt;/span>katacoda/docker-http-server:latest --replicas&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span>
kubectl run --generator&lt;span class="o">=&lt;/span>deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator&lt;span class="o">=&lt;/span>run-pod/v1 or kubectl create instead.
deployment.apps/http created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用 &lt;em>kubectl&lt;/em> 查看各部署的状态。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl get deployments
NAME READY UP-TO-DATE AVAILABLE AGE
http 1/1 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 2m7s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以通过 &lt;em>describe&lt;/em> 查看 &lt;em>Kubernetes&lt;/em> 创建了哪些内容。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl describe deployment http
Name: http
Namespace: default
CreationTimestamp: Wed, &lt;span class="m">21&lt;/span> Jul &lt;span class="m">2021&lt;/span> 08:04:55 +0000
Labels: &lt;span class="nv">run&lt;/span>&lt;span class="o">=&lt;/span>http
Annotations: deployment.kubernetes.io/revision: &lt;span class="m">1&lt;/span>
Selector: &lt;span class="nv">run&lt;/span>&lt;span class="o">=&lt;/span>http
Replicas: &lt;span class="m">1&lt;/span> desired &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> updated &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> total &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> available &lt;span class="p">|&lt;/span> &lt;span class="m">0&lt;/span> unavailable
StrategyType: RollingUpdate
MinReadySeconds: &lt;span class="m">0&lt;/span>
RollingUpdateStrategy: 25% max unavailable, 25% max surge
Pod Template:
Labels: &lt;span class="nv">run&lt;/span>&lt;span class="o">=&lt;/span>http
Containers:
http:
Image: katacoda/docker-http-server:latest
Port: &amp;lt;none&amp;gt;
Host Port: &amp;lt;none&amp;gt;
Environment: &amp;lt;none&amp;gt;
Mounts: &amp;lt;none&amp;gt;
Volumes: &amp;lt;none&amp;gt;
Conditions:
Type Status Reason
---- ------ ------
Available True MinimumReplicasAvailable
Progressing True NewReplicaSetAvailable
OldReplicaSets: &amp;lt;none&amp;gt;
NewReplicaSet: http-774bb756bb &lt;span class="o">(&lt;/span>1/1 replicas created&lt;span class="o">)&lt;/span>
Events:
Type Reason Age From Message
---- ------ ---- ---- -------
Normal ScalingReplicaSet 4m16s deployment-controller Scaled up replica &lt;span class="nb">set&lt;/span> http-774bb756bb to &lt;span class="m">1&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>描述中包含有多少副本可用、指定的标签以及与部署相关的事件等信息。这些事件将突出显示可能发生的任何问题和错误。&lt;/p>
&lt;p>在下一步中，我们将开放正在运行的服务。&lt;/p>
&lt;h2 id="kubectl-expose">Kubectl Expose&lt;/h2>
&lt;p>创建部署后，我们可以使用 &lt;em>kubectl&lt;/em> 创建一个服务，该服务在特定端口上开放 &lt;em>Pod&lt;/em>。&lt;/p>
&lt;p>通过 &lt;em>kubectl expose&lt;/em> 开放新部署的 &lt;em>http&lt;/em> 部署。该命令允许定义服务的不同参数以及如何开放该部署。&lt;/p>
&lt;h3 id="任务-1">任务&lt;/h3>
&lt;p>使用以下命令将主机上的容器端口 &lt;em>80&lt;/em> 公开 &lt;em>8000&lt;/em> 绑定到主机的 &lt;em>external-ip&lt;/em>。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl expose deployment http --external-ip&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;172.17.0.44&amp;#34;&lt;/span> --port&lt;span class="o">=&lt;/span>&lt;span class="m">8000&lt;/span> --target-port&lt;span class="o">=&lt;/span>&lt;span class="m">80&lt;/span>
service/http exposed
&lt;/code>&lt;/pre>&lt;/div>&lt;p>接下来就能 &lt;em>ping&lt;/em> 主机查看 &lt;em>HTTP&lt;/em> 服务返回的结果。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ curl http://172.17.0.44:8000
&amp;lt;h1&amp;gt;This request was processed by host: http-774bb756bb-m6tjp&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="kubectl-run-and-expose">Kubectl Run and Expose&lt;/h2>
&lt;p>可以单独使用命令 &lt;em>kubectl run&lt;/em> 来创建部署并将其开放。&lt;/p>
&lt;h3 id="任务-2">任务&lt;/h3>
&lt;p>使用命令创建在端口 &lt;em>8001&lt;/em> 上开放的第二个 &lt;em>http&lt;/em> 服务。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl run httpexposed --image&lt;span class="o">=&lt;/span>katacoda/docker-http-server:latest --replicas&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> --port&lt;span class="o">=&lt;/span>&lt;span class="m">80&lt;/span> --hostport&lt;span class="o">=&lt;/span>&lt;span class="m">8001&lt;/span>
kubectl run --generator&lt;span class="o">=&lt;/span>deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator&lt;span class="o">=&lt;/span>run-pod/v1 or kubectl create instead.
deployment.apps/httpexposed created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>接下来可以使用 &lt;code>curl http://172.17.0.41:8001&lt;/code> 来访问该服务。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ curl http://172.17.0.44:8001
&amp;lt;h1&amp;gt;This request was processed by host: httpexposed-68cb8c8d4-r7qtt&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>在服务内，通过 &lt;em>Docker&lt;/em> 端口映射开放了 &lt;em>Pod&lt;/em>。因此，您将看不到使用 &lt;code>kubectl get svc&lt;/code> 列出的服务&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl get svc
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
http ClusterIP 10.97.103.237 172.17.0.44 8000/TCP 4m47s
kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 44m
&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以通过 &lt;code>docker ps | grep httpexposed&lt;/code> 命令查看详细信息。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ docker ps &lt;span class="p">|&lt;/span> grep httpexposed
1690c6682f93 katacoda/docker-http-server &lt;span class="s2">&amp;#34;/app&amp;#34;&lt;/span> &lt;span class="m">2&lt;/span> minutes ago Up &lt;span class="m">2&lt;/span> minutes k8s_httpexposed_httpexposed-68cb8c8d4-r7qtt_default_6fb23c14-277e-4298-b325-c52ef4eb09a9_0
d9ae0076a0d4 k8s.gcr.io/pause:3.1 &lt;span class="s2">&amp;#34;/pause&amp;#34;&lt;/span> &lt;span class="m">2&lt;/span> minutes ago Up &lt;span class="m">2&lt;/span> minutes 0.0.0.0:8001-&amp;gt;80/tcp k8s_POD_httpexposed-68cb8c8d4-r7qtt_default_6fb23c14-277e-4298-b325-c52ef4eb09a9_0
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="暂停容器">暂停容器&lt;/h3>
&lt;p>运行上面的命令，你会注意到端口暴露在 &lt;em>Pod&lt;/em> 上，而不是 &lt;em>http&lt;/em> 容器本身。 &lt;em>Pause&lt;/em> 容器负责为 &lt;em>Pod&lt;/em> 定义网络。 &lt;em>Pod&lt;/em> 中的其他容器共享相同的网络命名空间。允许多个容器通过同一网络接口进行通信，提高了网络性能。&lt;/p>
&lt;h2 id="容器扩展">容器扩展&lt;/h2>
&lt;p>随着我们的部署运行，我们现在可以使用 &lt;em>kubectl&lt;/em> 来扩展副本的数量。&lt;/p>
&lt;p>扩展部署将请求 &lt;em>Kubernetes&lt;/em> 启动额外的 &lt;em>Pod&lt;/em>。然后，这些 &lt;em>Pod&lt;/em> 将使用开放服务自动进行负载平衡。&lt;/p>
&lt;h3 id="任务-3">任务&lt;/h3>
&lt;p>&lt;em>kubectl scale&lt;/em> 命令能够为特定 &lt;em>Deployment&lt;/em> 或 &lt;em>Replication Controller&lt;/em> 调整运行的 &lt;em>Pod&lt;/em> 数量。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl scale --replicas&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> deployment http
deployment.apps/http scaled
&lt;/code>&lt;/pre>&lt;/div>&lt;p>列出所有 &lt;em>pod&lt;/em>，能够看到三个正在运行的 &lt;em>http&lt;/em> 部署。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl get pods
NAME READY STATUS RESTARTS AGE
http-774bb756bb-m6tjp 1/1 Running &lt;span class="m">0&lt;/span> 20m
http-774bb756bb-q29v8 1/1 Running &lt;span class="m">0&lt;/span> 45s
http-774bb756bb-x2xxv 1/1 Running &lt;span class="m">0&lt;/span> 45s
httpexposed-68cb8c8d4-r7qtt 1/1 Running &lt;span class="m">0&lt;/span> 9m3s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>一旦每个 &lt;em>Pod&lt;/em> 启动，就会被添加到负载均衡器服务中。通过 &lt;em>describe&lt;/em>，可以查看包含的端点和与之关联的 &lt;em>Pod&lt;/em>。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl describe svc http
Name: http
Namespace: default
Labels: &lt;span class="nv">run&lt;/span>&lt;span class="o">=&lt;/span>http
Annotations: &amp;lt;none&amp;gt;
Selector: &lt;span class="nv">run&lt;/span>&lt;span class="o">=&lt;/span>http
Type: ClusterIP
IP: 10.97.103.237
External IPs: 172.17.0.44
Port: &amp;lt;unset&amp;gt; 8000/TCP
TargetPort: 80/TCP
Endpoints: 172.18.0.4:80,172.18.0.6:80,172.18.0.7:80
Session Affinity: None
Events: &amp;lt;none&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>向服务发出多次请求，可以通过返回信息看出请求将在不同的节点处理。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ curl http://172.17.0.44:8000
&amp;lt;h1&amp;gt;This request was processed by host: http-774bb756bb-x2xxv&amp;lt;/h1&amp;gt;
$ curl http://172.17.0.44:8000
&amp;lt;h1&amp;gt;This request was processed by host: http-774bb756bb-q29v8&amp;lt;/h1&amp;gt;
$ curl http://172.17.0.44:8000
&amp;lt;h1&amp;gt;This request was processed by host: http-774bb756bb-q29v8&amp;lt;/h1&amp;gt;
$ curl http://172.17.0.44:8000
&amp;lt;h1&amp;gt;This request was processed by host: http-774bb756bb-x2xxv&amp;lt;/h1&amp;gt;
$ curl http://172.17.0.44:8000
&amp;lt;h1&amp;gt;This request was processed by host: http-774bb756bb-q29v8&amp;lt;/h1&amp;gt;
$ curl http://172.17.0.44:8000
&amp;lt;h1&amp;gt;This request was processed by host: http-774bb756bb-q29v8&amp;lt;/h1&amp;gt;
$ curl http://172.17.0.44:8000
&amp;lt;h1&amp;gt;This request was processed by host: http-774bb756bb-m6tjp&amp;lt;/h1&amp;gt;
$ curl http://172.17.0.44:8000
&amp;lt;h1&amp;gt;This request was processed by host: http-774bb756bb-x2xxv&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Kubernetes初探（二）</title><link>https://www.catfish.top/p/k8s-basic-2/</link><pubDate>Tue, 20 Jul 2021 11:05:00 +0800</pubDate><guid>https://www.catfish.top/p/k8s-basic-2/</guid><description>&lt;img src="https://www.catfish.top/p/k8s-basic-2/kubernates.png" alt="Featured image of post Kubernetes初探（二）" />&lt;blockquote>
&lt;p>Katacoda在线课：&lt;a class="link" href="https://www.katacoda.com/courses/kubernetes/getting-started-with-kubeadm" target="_blank" rel="noopener"
>Launch a multi-node cluster using Kubeadm&lt;/a>&lt;/p>
&lt;p>本系列教程希望能通过交互式学习网站与传统方式结合，更高效、容易的学习知识。
本系列教程将使用 &lt;a class="link" href="https://www.katacoda.com" target="_blank" rel="noopener"
>Katacoda在线学习平台&lt;/a> 完成学习。&lt;/p>
&lt;/blockquote>
&lt;p>在此场景中，您将学习如何使用 &lt;em>Kubeadm&lt;/em> 启动 &lt;em>Kubernetes&lt;/em> 集群。&lt;/p>
&lt;p>&lt;em>Kubeadm&lt;/em> 解决了TLS 加密配置、 Kubernetes 核心组件部署和额外节点集群加入的问题。启动的集群通过 RBAC 等机制开箱即用。&lt;/p>
&lt;p>关于 &lt;em>Kubeadm&lt;/em> 的更多信息可以参考： &lt;a class="link" href="https://github.com/kubernetes/kubeadm" target="_blank" rel="noopener"
>https://github.com/kubernetes/kubeadm&lt;/a>&lt;/p>
&lt;h2 id="初始化-master">初始化 Master&lt;/h2>
&lt;p>&lt;em>Kubeadm&lt;/em> 已经安装在节点上。软件包适用于 Ubuntu 16.04+、CentOS 7 或 HypriotOS v1.0.1+。&lt;/p>
&lt;p>初始化集群的第一步是启动 &lt;em>Master节点&lt;/em> 。 &lt;em>Master节点&lt;/em> 负责运行控制平面组件、&lt;em>etcd&lt;/em> 和 &lt;em>API&lt;/em> 服务器。客户端能够与 &lt;em>API&lt;/em> 通信，能够完成工作负载的调度和集群状态的管理。&lt;/p>
&lt;h3 id="任务">任务&lt;/h3>
&lt;p>下面的命令将使用已知的 &lt;em>Token&lt;/em> 简化初始化集群的步骤。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubeadm init --token&lt;span class="o">=&lt;/span>102952.1a7dd4cc8d1f4cc5 --kubernetes-version &lt;span class="k">$(&lt;/span>kubeadm version -o short&lt;span class="k">)&lt;/span>
&lt;span class="o">[&lt;/span>init&lt;span class="o">]&lt;/span> Using Kubernetes version: v1.14.0
&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Running pre-flight checks
&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Pulling images required &lt;span class="k">for&lt;/span> setting up a Kubernetes cluster
&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> This might take a minute or two, depending on the speed of your internet connection
&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> You can also perform this action in beforehand using &lt;span class="s1">&amp;#39;kubeadm config images pull&amp;#39;&lt;/span>
&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Writing kubelet environment file with flags to file &lt;span class="s2">&amp;#34;/var/lib/kubelet/kubeadm-flags.env&amp;#34;&lt;/span>
&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Writing kubelet configuration to file &lt;span class="s2">&amp;#34;/var/lib/kubelet/config.yaml&amp;#34;&lt;/span>
&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Activating the kubelet service
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Using certificateDir folder &lt;span class="s2">&amp;#34;/etc/kubernetes/pki&amp;#34;&lt;/span>
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/ca&amp;#34;&lt;/span> certificate and key
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/healthcheck-client&amp;#34;&lt;/span> certificate and key
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/server&amp;#34;&lt;/span> certificate and key
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> etcd/server serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>controlplane localhost&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>172.17.0.86 127.0.0.1 ::1&lt;span class="o">]&lt;/span>
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/peer&amp;#34;&lt;/span> certificate and key
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> etcd/peer serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>controlplane localhost&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>172.17.0.86 127.0.0.1 ::1&lt;span class="o">]&lt;/span>
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver-etcd-client&amp;#34;&lt;/span> certificate and key
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;ca&amp;#34;&lt;/span> certificate and key
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver&amp;#34;&lt;/span> certificate and key
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> apiserver serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>controlplane kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>10.96.0.1 172.17.0.86&lt;span class="o">]&lt;/span>
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver-kubelet-client&amp;#34;&lt;/span> certificate and key
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;front-proxy-ca&amp;#34;&lt;/span> certificate and key
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;front-proxy-client&amp;#34;&lt;/span> certificate and key
&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;sa&amp;#34;&lt;/span> key and public key
&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Using kubeconfig folder &lt;span class="s2">&amp;#34;/etc/kubernetes&amp;#34;&lt;/span>
&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;admin.conf&amp;#34;&lt;/span> kubeconfig file
&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;kubelet.conf&amp;#34;&lt;/span> kubeconfig file
&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;controller-manager.conf&amp;#34;&lt;/span> kubeconfig file
&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;scheduler.conf&amp;#34;&lt;/span> kubeconfig file
&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Using manifest folder &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>
&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-apiserver&amp;#34;&lt;/span>
&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-controller-manager&amp;#34;&lt;/span>
&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-scheduler&amp;#34;&lt;/span>
&lt;span class="o">[&lt;/span>etcd&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="nb">local&lt;/span> etcd in &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>
&lt;span class="o">[&lt;/span>wait-control-plane&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> the kubelet to boot up the control plane as static Pods from directory &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>. This can take up to 4m0s
&lt;span class="o">[&lt;/span>apiclient&lt;span class="o">]&lt;/span> All control plane components are healthy after 17.503676 seconds
&lt;span class="o">[&lt;/span>upload-config&lt;span class="o">]&lt;/span> storing the configuration used in ConfigMap &lt;span class="s2">&amp;#34;kubeadm-config&amp;#34;&lt;/span> in the &lt;span class="s2">&amp;#34;kube-system&amp;#34;&lt;/span> Namespace
&lt;span class="o">[&lt;/span>kubelet&lt;span class="o">]&lt;/span> Creating a ConfigMap &lt;span class="s2">&amp;#34;kubelet-config-1.14&amp;#34;&lt;/span> in namespace kube-system with the configuration &lt;span class="k">for&lt;/span> the kubelets in the cluster
&lt;span class="o">[&lt;/span>upload-certs&lt;span class="o">]&lt;/span> Skipping phase. Please see --experimental-upload-certs
&lt;span class="o">[&lt;/span>mark-control-plane&lt;span class="o">]&lt;/span> Marking the node controlplane as control-plane by adding the label &lt;span class="s2">&amp;#34;node-role.kubernetes.io/master=&amp;#39;&amp;#39;&amp;#34;&lt;/span>
&lt;span class="o">[&lt;/span>mark-control-plane&lt;span class="o">]&lt;/span> Marking the node controlplane as control-plane by adding the taints &lt;span class="o">[&lt;/span>node-role.kubernetes.io/master:NoSchedule&lt;span class="o">]&lt;/span>
&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Using token: 102952.1a7dd4cc8d1f4cc5
&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order &lt;span class="k">for&lt;/span> nodes to get long term certificate credentials
&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> configured RBAC rules to allow certificate rotation &lt;span class="k">for&lt;/span> all node client certificates in the cluster
&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> creating the &lt;span class="s2">&amp;#34;cluster-info&amp;#34;&lt;/span> ConfigMap in the &lt;span class="s2">&amp;#34;kube-public&amp;#34;&lt;/span> namespace
&lt;span class="o">[&lt;/span>addons&lt;span class="o">]&lt;/span> Applied essential addon: CoreDNS
&lt;span class="o">[&lt;/span>addons&lt;span class="o">]&lt;/span> Applied essential addon: kube-proxy
Your Kubernetes control-plane has initialized successfully!
To start using your cluster, you need to run the following as a regular user:
mkdir -p &lt;span class="nv">$HOME&lt;/span>/.kube
sudo cp -i /etc/kubernetes/admin.conf &lt;span class="nv">$HOME&lt;/span>/.kube/config
sudo chown &lt;span class="k">$(&lt;/span>id -u&lt;span class="k">)&lt;/span>:&lt;span class="k">$(&lt;/span>id -g&lt;span class="k">)&lt;/span> &lt;span class="nv">$HOME&lt;/span>/.kube/config
You should now deploy a pod network to the cluster.
Run &lt;span class="s2">&amp;#34;kubectl apply -f [podnetwork].yaml&amp;#34;&lt;/span> with one of the options listed at:
https://kubernetes.io/docs/concepts/cluster-administration/addons/
Then you can join any number of worker nodes by running the following on each as root:
kubeadm join 172.17.0.86:6443 --token 102952.1a7dd4cc8d1f4cc5 &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> --discovery-token-ca-cert-hash sha256:ab56a643a2d683bc1deeb483f0f946d4a774c4
&lt;/code>&lt;/pre>&lt;/div>&lt;p>在生产环境中，建议排除使用 &lt;em>kubeadm&lt;/em> 生成的令牌。&lt;/p>
&lt;p>需要客户端配置和证书来管理 &lt;em>Kubernetes&lt;/em> 集群。这个配置是在 &lt;em>kubeadm&lt;/em> 初始化集群时创建的。该命令将配置复制到用户主目录并设置用于 &lt;em>CLI&lt;/em> 的环境变量。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ sudo cp /etc/kubernetes/admin.conf &lt;span class="nv">$HOME&lt;/span>/
controlplane $ sudo chown &lt;span class="k">$(&lt;/span>id -u&lt;span class="k">)&lt;/span>:&lt;span class="k">$(&lt;/span>id -g&lt;span class="k">)&lt;/span> &lt;span class="nv">$HOME&lt;/span>/admin.conf
controlplane $ &lt;span class="nb">export&lt;/span> &lt;span class="nv">KUBECONFIG&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$HOME&lt;/span>/admin.conf
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="部署容器网络接口-container-networking-interface-cni">部署容器网络接口 Container Networking Interface (CNI)&lt;/h2>
&lt;p>容器网络接口 ( &lt;em>CNI&lt;/em> ) 定义了不同节点及其工作负载是如何通信的。有多个网络提供商可用，其中一些在 &lt;a class="link" href="https://kubernetes.io/docs/admin/addons/" target="_blank" rel="noopener"
>here&lt;/a> 中列出。&lt;/p>
&lt;h3 id="任务-1">任务&lt;/h3>
&lt;p>在这个场景中，我们将使用 &lt;em>WeaveWorks&lt;/em> 的 &lt;em>CNI&lt;/em> 。&lt;/p>
&lt;p>&lt;strong>/opt/weave-kube.yaml&lt;/strong>
可以通过 &lt;code>cat /opt/weave-kube.yaml&lt;/code> 命令查看部署定义。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">List&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">items&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ServiceAccount&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">annotations&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud.weave.works/launcher-info&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|-&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> {
&lt;/span>&lt;span class="sd"> &amp;#34;original-request&amp;#34;: {
&lt;/span>&lt;span class="sd"> &amp;#34;url&amp;#34;: &amp;#34;/k8s/v1.10/net.yaml?k8s-version=v1.16.0&amp;#34;,
&lt;/span>&lt;span class="sd"> &amp;#34;date&amp;#34;: &amp;#34;Mon Oct 28 2019 18:38:09 GMT+0000 (UTC)&amp;#34;
&lt;/span>&lt;span class="sd"> },
&lt;/span>&lt;span class="sd"> &amp;#34;email-address&amp;#34;: &amp;#34;support@weave.works&amp;#34;
&lt;/span>&lt;span class="sd"> }&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-system&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rbac.authorization.k8s.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ClusterRole&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">annotations&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud.weave.works/launcher-info&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|-&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> {
&lt;/span>&lt;span class="sd"> &amp;#34;original-request&amp;#34;: {
&lt;/span>&lt;span class="sd"> &amp;#34;url&amp;#34;: &amp;#34;/k8s/v1.10/net.yaml?k8s-version=v1.16.0&amp;#34;,
&lt;/span>&lt;span class="sd"> &amp;#34;date&amp;#34;: &amp;#34;Mon Oct 28 2019 18:38:09 GMT+0000 (UTC)&amp;#34;
&lt;/span>&lt;span class="sd"> },
&lt;/span>&lt;span class="sd"> &amp;#34;email-address&amp;#34;: &amp;#34;support@weave.works&amp;#34;
&lt;/span>&lt;span class="sd"> }&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">rules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">apiGroups&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">pods&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">namespaces&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">nodes&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">verbs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">get&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">list&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">watch&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">apiGroups&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">networking.k8s.io&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">networkpolicies&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">verbs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">get&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">list&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">watch&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">apiGroups&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">nodes/status&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">verbs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">patch&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">update&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rbac.authorization.k8s.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ClusterRoleBinding&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">annotations&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud.weave.works/launcher-info&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|-&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> {
&lt;/span>&lt;span class="sd"> &amp;#34;original-request&amp;#34;: {
&lt;/span>&lt;span class="sd"> &amp;#34;url&amp;#34;: &amp;#34;/k8s/v1.10/net.yaml?k8s-version=v1.16.0&amp;#34;,
&lt;/span>&lt;span class="sd"> &amp;#34;date&amp;#34;: &amp;#34;Mon Oct 28 2019 18:38:09 GMT+0000 (UTC)&amp;#34;
&lt;/span>&lt;span class="sd"> },
&lt;/span>&lt;span class="sd"> &amp;#34;email-address&amp;#34;: &amp;#34;support@weave.works&amp;#34;
&lt;/span>&lt;span class="sd"> }&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">roleRef&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ClusterRole&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">apiGroup&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rbac.authorization.k8s.io&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">subjects&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ServiceAccount&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-system&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rbac.authorization.k8s.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Role&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">annotations&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud.weave.works/launcher-info&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|-&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> {
&lt;/span>&lt;span class="sd"> &amp;#34;original-request&amp;#34;: {
&lt;/span>&lt;span class="sd"> &amp;#34;url&amp;#34;: &amp;#34;/k8s/v1.10/net.yaml?k8s-version=v1.16.0&amp;#34;,
&lt;/span>&lt;span class="sd"> &amp;#34;date&amp;#34;: &amp;#34;Mon Oct 28 2019 18:38:09 GMT+0000 (UTC)&amp;#34;
&lt;/span>&lt;span class="sd"> },
&lt;/span>&lt;span class="sd"> &amp;#34;email-address&amp;#34;: &amp;#34;support@weave.works&amp;#34;
&lt;/span>&lt;span class="sd"> }&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-system&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">rules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">apiGroups&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resourceNames&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">configmaps&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">verbs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">get&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">update&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">apiGroups&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">configmaps&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">verbs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">create&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rbac.authorization.k8s.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">RoleBinding&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">annotations&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud.weave.works/launcher-info&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|-&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> {
&lt;/span>&lt;span class="sd"> &amp;#34;original-request&amp;#34;: {
&lt;/span>&lt;span class="sd"> &amp;#34;url&amp;#34;: &amp;#34;/k8s/v1.10/net.yaml?k8s-version=v1.16.0&amp;#34;,
&lt;/span>&lt;span class="sd"> &amp;#34;date&amp;#34;: &amp;#34;Mon Oct 28 2019 18:38:09 GMT+0000 (UTC)&amp;#34;
&lt;/span>&lt;span class="sd"> },
&lt;/span>&lt;span class="sd"> &amp;#34;email-address&amp;#34;: &amp;#34;support@weave.works&amp;#34;
&lt;/span>&lt;span class="sd"> }&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-system&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">roleRef&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Role&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">apiGroup&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rbac.authorization.k8s.io&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">subjects&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ServiceAccount&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-system&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">DaemonSet&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">annotations&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud.weave.works/launcher-info&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|-&lt;/span>&lt;span class="sd">
&lt;/span>&lt;span class="sd"> {
&lt;/span>&lt;span class="sd"> &amp;#34;original-request&amp;#34;: {
&lt;/span>&lt;span class="sd"> &amp;#34;url&amp;#34;: &amp;#34;/k8s/v1.10/net.yaml?k8s-version=v1.16.0&amp;#34;,
&lt;/span>&lt;span class="sd"> &amp;#34;date&amp;#34;: &amp;#34;Mon Oct 28 2019 18:38:09 GMT+0000 (UTC)&amp;#34;
&lt;/span>&lt;span class="sd"> },
&lt;/span>&lt;span class="sd"> &amp;#34;email-address&amp;#34;: &amp;#34;support@weave.works&amp;#34;
&lt;/span>&lt;span class="sd"> }&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kube-system&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">minReadySeconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">5&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">/home/weave/launch.sh&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">env&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">IPALLOC_RANGE&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10.32.0.0&lt;/span>&lt;span class="l">/24&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">HOSTNAME&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">valueFrom&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">fieldRef&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">fieldPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">spec.nodeName&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;docker.io/weaveworks/weave-kube:2.6.0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">readinessProbe&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">httpGet&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">127.0.0.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/status&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">6784&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">requests&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">cpu&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">10m&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">securityContext&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">privileged&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weavedb&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/weavedb&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cni-bin&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/host/opt&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cni-bin2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/host/home&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cni-conf&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/host/etc&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dbus&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/host/var/lib/dbus&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">lib-modules&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/lib/modules&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">xtables-lock&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/run/xtables.lock&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-npc&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">env&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">HOSTNAME&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">valueFrom&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">fieldRef&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">fieldPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">spec.nodeName&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;docker.io/weaveworks/weave-npc:2.6.0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">requests&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">cpu&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">10m&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">securityContext&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">privileged&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">xtables-lock&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/run/xtables.lock&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostNetwork&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPID&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">restartPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Always&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">securityContext&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">seLinuxOptions&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceAccountName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weave-net&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">tolerations&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">effect&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NoSchedule&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">operator&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Exists&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">weavedb&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/var/lib/weave&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cni-bin&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/opt&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cni-bin2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/home&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cni-conf&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/etc&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dbus&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/var/lib/dbus&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">lib-modules&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/lib/modules&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">xtables-lock&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/run/xtables.lock&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">FileOrCreate&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">updateStrategy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">RollingUpdate&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用 &lt;code>kubectl apply&lt;/code> 命令来完成部署工作。.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl apply -f /opt/weave-kube.yaml
serviceaccount/weave-net created
clusterrole.rbac.authorization.k8s.io/weave-net created
clusterrolebinding.rbac.authorization.k8s.io/weave-net created
role.rbac.authorization.k8s.io/weave-net created
rolebinding.rbac.authorization.k8s.io/weave-net created
daemonset.apps/weave-net created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>Weave&lt;/em> 现在将在集群上部署为一系列的 &lt;em>Pod&lt;/em>。
可以通过 &lt;code>kubectl get pod -n kube-system&lt;/code> 命令查看状态。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pod -n kube-system
NAME READY STATUS RESTARTS AGE
coredns-fb8b8dccf-gw8z6 1/1 Running &lt;span class="m">0&lt;/span> 12m
coredns-fb8b8dccf-qzd49 1/1 Running &lt;span class="m">0&lt;/span> 12m
etcd-controlplane 1/1 Running &lt;span class="m">0&lt;/span> 12m
kube-apiserver-controlplane 1/1 Running &lt;span class="m">0&lt;/span> 11m
kube-controller-manager-controlplane 1/1 Running &lt;span class="m">0&lt;/span> 11m
kube-proxy-2kjsl 1/1 Running &lt;span class="m">0&lt;/span> 13m
kube-scheduler-controlplane 1/1 Running &lt;span class="m">1&lt;/span> 11m
weave-net-2dtbs 2/2 Running &lt;span class="m">0&lt;/span> 82s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>需要安装 &lt;em>Weave&lt;/em> 在你的集群中时，可以在 &lt;a class="link" href="https://www.weave.works/docs/net/latest/kube-addon/" target="_blank" rel="noopener"
>https://www.weave.works/docs/net/latest/kube-addon/&lt;/a> 找到更多详细信息。&lt;/p>
&lt;h2 id="加入集群">加入集群&lt;/h2>
&lt;p>一旦 &lt;code>Master&lt;/code> 和 &lt;code>CNI&lt;/code> 初始化完成，其他节点只要拥有正确的令牌就可以加入集群。令牌可以通过 &lt;code>kubeadm token&lt;/code> 进行管理，例如 &lt;code>kubeadm token list&lt;/code>。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubeadm token list
TOKEN TTL EXPIRES USAGES DESCRIPTION EXTRA GROUPS
102952.1a7dd4cc8d1f4cc5 23h 2021-07-21T10:00:20Z authentication,signing The default bootstrap token generated by &lt;span class="s1">&amp;#39;kubeadm init&amp;#39;&lt;/span>. system:bootstrappers:kubeadm:default-node-token
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="任务-2">任务&lt;/h3>
&lt;p>在第二个节点上，使用主节点的 IP 地址，运行命令加入集群。&lt;/p>
&lt;pre>&lt;code>node01 $ kubeadm join --discovery-token-unsafe-skip-ca-verification --token=102952.1a7dd4cc8d1f4cc5 172.17.0.86:6443
[preflight] Running pre-flight checks
[preflight] Reading configuration from the cluster...
[preflight] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'
[kubelet-start] Downloading configuration for the kubelet from the &amp;quot;kubelet-config-1.14&amp;quot; ConfigMap in the kube-system namespace
[kubelet-start] Writing kubelet configuration to file &amp;quot;/var/lib/kubelet/config.yaml&amp;quot;
[kubelet-start] Writing kubelet environment file with flags to file &amp;quot;/var/lib/kubelet/kubeadm-flags.env&amp;quot;
[kubelet-start] Activating the kubelet service
[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...
This node has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.
Run 'kubectl get nodes' on the control-plane to see this node join the cluster.
&lt;/code>&lt;/pre>&lt;p>&lt;code>Node01&lt;/code>节点与 &lt;code>Master&lt;/code> 节点初始化提供的命令相同。&lt;/p>
&lt;p>&lt;code>--discovery-token-unsafe-skip-ca-verification&lt;/code> 标签用于绕过 Discovery Token 验证。由于此令牌是动态生成的，因此我们无法将其包含在步骤中。在生产环境中，使用 &lt;code>kubeadm init&lt;/code> 提供的令牌。&lt;/p>
&lt;h2 id="查看节点">查看节点&lt;/h2>
&lt;p>集群现已初始化。主节点将负责管理集群，另一个工作节点将负责运行我们的容器工作负载。&lt;/p>
&lt;h3 id="任务-3">任务&lt;/h3>
&lt;p>Kubernetes CLI，称为 &lt;em>kubectl&lt;/em>，现在可以使用配置访问集群。例如，下面的命令将返回我们集群中的两个节点信息。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get nodes
NAME STATUS ROLES AGE VERSION
controlplane Ready master 25m v1.14.0
node01 Ready &amp;lt;none&amp;gt; 2m v1.14.0
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="部署-pod">部署 Pod&lt;/h2>
&lt;p>集群中两个节点的状态现在应该是 &lt;code>Ready&lt;/code>。这表示接下来可以进行调度和启动部署。&lt;/p>
&lt;p>使用 &lt;code>Kubectl&lt;/code>，可以部署 &lt;code>Pod&lt;/code>。命令总是由 &lt;code>Master&lt;/code> 发出，每个节点只负责运行工作负载。&lt;/p>
&lt;p>下面的命令是基于 &lt;code>Docker&lt;/code> 镜像 &lt;em>katacoda/docker-http-server&lt;/em> 创建一个 &lt;code>Pod&lt;/code>。&lt;/p>
&lt;pre>&lt;code>controlplane $ kubectl create deployment http --image=katacoda/docker-http-server:latest
deployment.apps/http created
&lt;/code>&lt;/pre>&lt;p>可以使用&lt;code>kubectl get pods&lt;/code>查看&lt;code>Pod&lt;/code>创建的状态&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pods
NAME READY STATUS RESTARTS AGE
http-7f8cbdf584-jcdrj 1/1 Running &lt;span class="m">0&lt;/span> 70s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>运行后，可以看到节点上&lt;code>Docker&lt;/code> 容器的运行状态。&lt;/p>
&lt;pre>&lt;code>node01 $ docker ps | grep docker-http-server
d874d8c3151b katacoda/docker-http-server &amp;quot;/app&amp;quot; About a minute ago Up About a minute k8s_docker-http-server_http-7f8cbdf584-jcdrj_default_2894ce10-e945-11eb-b87f-0242ac110056_0
&lt;/code>&lt;/pre>&lt;h2 id="部署仪表盘">部署仪表盘&lt;/h2>
&lt;p>Kubernetes 有一个基于 Web 的仪表板应用，提供对 Kubernetes 集群的查看与管理能力。&lt;/p>
&lt;h3 id="任务-4">任务&lt;/h3>
&lt;p>使用 &lt;code>kubectl apply -f dashboard.yaml&lt;/code> 命令部署仪表板。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl apply -f dashboard.yaml
secret/kubernetes-dashboard-certs created
serviceaccount/kubernetes-dashboard created
role.rbac.authorization.k8s.io/kubernetes-dashboard-minimal created
rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard-minimal created
deployment.apps/kubernetes-dashboard created
service/kubernetes-dashboard created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>仪表板将部署到 &lt;em>kube-system&lt;/em> 命名空间中。使用 &lt;code>kubectl get pods -n kube-system&lt;/code>命令 查看部署状态。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl get pods -n kube-system
NAME READY STATUS RESTARTS AGE
coredns-fb8b8dccf-rjzxp 1/1 Running &lt;span class="m">1&lt;/span> 88s
coredns-fb8b8dccf-tw8cm 1/1 Running &lt;span class="m">1&lt;/span> 88s
etcd-controlplane 1/1 Running &lt;span class="m">0&lt;/span> 16s
kube-apiserver-controlplane 1/1 Running &lt;span class="m">0&lt;/span> 23s
kube-controller-manager-controlplane 1/1 Running &lt;span class="m">1&lt;/span> 61s
kube-proxy-6xv6k 1/1 Running &lt;span class="m">0&lt;/span> 84s
kube-proxy-fn84g 1/1 Running &lt;span class="m">0&lt;/span> 88s
kube-scheduler-controlplane 1/1 Running &lt;span class="m">2&lt;/span> 61s
kubernetes-dashboard-5f57845f9d-jblx7 1/1 Running &lt;span class="m">0&lt;/span> 5s
weave-net-6gcbd 2/2 Running &lt;span class="m">1&lt;/span> 88s
weave-net-8s6bt 2/2 Running &lt;span class="m">1&lt;/span> 84s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>需要 &lt;code>ServiceAccount&lt;/code> 才能登录。 &lt;code>ClusterRoleBinding&lt;/code> 用于为新的 ServiceAccount (&lt;em>admin-user&lt;/em>) 分配集群上的 &lt;em>cluster-admin&lt;/em> 角色。&lt;/p>
&lt;pre>&lt;code>cat &amp;lt;&amp;lt;EOF | kubectl create -f -
apiVersion: v1
kind: ServiceAccount
metadata:
name: admin-user
namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRoleBinding
metadata:
name: admin-user
roleRef:
apiGroup: rbac.authorization.k8s.io
kind: ClusterRole
name: cluster-admin
subjects:
- kind: ServiceAccount
name: admin-user
namespace: kube-system
EOF
&lt;/code>&lt;/pre>&lt;p>&lt;code>Dashboard&lt;/code>可以控制 Kubernetes 的所有方面。通过 &lt;code>ClusterRoleBinding&lt;/code> 和 &lt;code>RBAC&lt;/code>，可以根据安全要求来定义不同级别的权限。有关为仪表板创建用户的更多信息，请参考 &lt;a class="link" href="https://github.com/kubernetes/dashboard/wiki/Creating-sample-user" target="_blank" rel="noopener"
>Dashboard documentation&lt;/a>。&lt;/p>
&lt;p>创建 &lt;code>ServiceAccount&lt;/code> 后，可以通过以下方式获取登录令牌：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">controlplane $ kubectl -n kube-system describe secret &lt;span class="k">$(&lt;/span>kubectl -n kube-system get secret &lt;span class="p">|&lt;/span> grep admin-user &lt;span class="p">|&lt;/span> awk &lt;span class="s1">&amp;#39;{print $1}&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
Name: attachdetach-controller-token-bltlp
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: attachdetach-controller
kubernetes.io/service-account.uid: 0ced9bf4-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhdHRhY2hkZXRhY2gtY29udHJvbGxlci10b2tlbi1ibHRscCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJhdHRhY2hkZXRhY2gtY29udHJvbGxlciIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjBjZWQ5YmY0LWU5ZDQtMTFlYi1iMjViLTAyNDJhYzExMDAwOSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTphdHRhY2hkZXRhY2gtY29udHJvbGxlciJ9.x0a2m2SpBrwj8sARrvRfuct2ghrDydxYzyFmDL93hATdS_59zaueB4SrgHner8gOu_zrx9PLWcSoZNBxRblZuxJj8Di9TKUTjyDBE6txc4_0H8nseuQzljvRTbjUjEcL7fp8H1j4MrJgT4GrYU-n1gAOl6NIfk8FmpFpuUUS6G_IfIDfS60YpZRlqZGp14NuaL0RC71PsERnP6ZYnuRKTbYNfVNeURqVR4pY7XwCcQZFALaJcTf9SgwJLAAqLQFgKd9c2MYnHdnU5cnqjrYxi_b5kGBKUcRzACrHjh0uGG6ErHeo6-GbA-0NDdIMI7qKa3If0oh_GOQKmyB5cyx-Rw
Name: bootstrap-signer-token-cstqm
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: bootstrap-signer
kubernetes.io/service-account.uid: 0dc1b223-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJib290c3RyYXAtc2lnbmVyLXRva2VuLWNzdHFtIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImJvb3RzdHJhcC1zaWduZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwZGMxYjIyMy1lOWQ0LTExZWItYjI1Yi0wMjQyYWMxMTAwMDkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06Ym9vdHN0cmFwLXNpZ25lciJ9.hkciM9KpWYYPyi5MJbm67oqzuskjDB_Rj4Fz5THhtN_jJAO6go4oxz-NPparOi7kxaEU0yBLb_xLY42jOXvG_Q2Dd6gR2u9yc7nfwr67koW3lck4S0PCYSuGo-FqUndXS1a3BpT5SFAHhb52FdwEYiedevLz9C5wUDT8sVgMYSnHvEX_jwBmjrhhOohGxTNs_-_HyGMNNLfEOSbjaEtzkDFos0n3qPAJ95uaGKJ2laDsctVpHCeRx5hNCv8E7dvvR1Qp4XXDVDQrodkzkuG4LSKviYLzMLX1DM2XES3HQ7Q2uTtAICqxIDBjRlhfAPv_z02tqAbCf4fF6_CFlYK1ag
Name: bootstrap-token-102952
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: &amp;lt;none&amp;gt;
Type: bootstrap.kubernetes.io/token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
token-secret: &lt;span class="m">16&lt;/span> bytes
usage-bootstrap-authentication: &lt;span class="m">4&lt;/span> bytes
usage-bootstrap-signing: &lt;span class="m">4&lt;/span> bytes
auth-extra-groups: &lt;span class="m">47&lt;/span> bytes
description: &lt;span class="m">56&lt;/span> bytes
expiration: &lt;span class="m">20&lt;/span> bytes
token-id: &lt;span class="m">6&lt;/span> bytes
Name: certificate-controller-token-mw9rl
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: certificate-controller
kubernetes.io/service-account.uid: 0cf891ba-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJjZXJ0aWZpY2F0ZS1jb250cm9sbGVyLXRva2VuLW13OXJsIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImNlcnRpZmljYXRlLWNvbnRyb2xsZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwY2Y4OTFiYS1lOWQ0LTExZWItYjI1Yi0wMjQyYWMxMTAwMDkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06Y2VydGlmaWNhdGUtY29udHJvbGxlciJ9.NIZpVmhuJUcrpbZJApUt7ODgqIPU9RN4UZcr6he83xA_66-4ORQVddj1oQQg4G0p4fSPckWfP0n7pSxahZ90VZ-NCxPeCVLThLZ563PUOIljsjfROgFLQ4eeWfRML0OHyhAgoTtfEdcHi4_IzyhSrvCOweM9oPFfdx9MdTNAG9znyQsCi4g1YNHwn7t4r8h-BouW4yRYMEOM9HVZkcDVWhmF9PDv9s235INvIAjco5JvCAeDKvw48hdSrm4RWQPmZ7yE71iBDymDF_Ntr9w12H_4FPOYcARfFOmIj1k5binKiHaOlWtfbKYGYFM4tAxqI-ErFx4lshkLNJm3ICMJSQ
Name: clusterrole-aggregation-controller-token-xh52b
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: clusterrole-aggregation-controller
kubernetes.io/service-account.uid: 0acea7db-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJjbHVzdGVycm9sZS1hZ2dyZWdhdGlvbi1jb250cm9sbGVyLXRva2VuLXhoNTJiIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImNsdXN0ZXJyb2xlLWFnZ3JlZ2F0aW9uLWNvbnRyb2xsZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwYWNlYTdkYi1lOWQ0LTExZWItYjI1Yi0wMjQyYWMxMTAwMDkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06Y2x1c3RlcnJvbGUtYWdncmVnYXRpb24tY29udHJvbGxlciJ9.SgSxj_9uNLbAU9zYK4sTUYL4STx9CSYflGe0GwqGz_f3K7Db5NhpCuCoCcLYVJ7I2xogXICDJV016ZaNEAKJHWNJNeO-Ye378zjgddYmLAxX0uNw9OfSSiHKq-ksHgkKmoxwixgzVw2Df6PZGeYrKZZMSGuW96hkzd5JJx9Jhg2c4k8Fpqcpg5t-N4F5ZC8Ix4THpOmBueB8BaKox6OS5kUxqBAmdkJxZur1Wl8BvJV3Pnl6qbzYa0oPqun6N-WckGjVLrOlll1E6moABT1i8udZeRSrsX7YjjWgnbVyuyP0vzY7T1OQz-jcS0Lw3shMSIeANpwfFFB5XNvacsIV9A
Name: coredns-token-z5tnd
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: coredns
kubernetes.io/service-account.uid: 0ce34e5b-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJjb3JlZG5zLXRva2VuLXo1dG5kIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImNvcmVkbnMiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwY2UzNGU1Yi1lOWQ0LTExZWItYjI1Yi0wMjQyYWMxMTAwMDkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06Y29yZWRucyJ9.vTVtFW7YZ-_dxjyiHjrkJnxyw3Q1c2oy43wEfs71tnD5GIDcXjioGXRn4OFvGJYzUzSM7fujZy6e6lXUDZBx-PkiRZzaqbxZTuY1skfTKdAm31h6xbOESSvuFcR97eASVMv5WNdFNSXZik4P3_pEoF7XUKnOnY-o3nk-MZNWRhmdcOvj-BhBmTqXY9CQDvaW-P2MSQhaGvP-yVYBFHqNvOH_XgaBVdW5c35AuLGz3pVAiBl9s_Ghrkc5h0KrhU_eko5YAMGcXHUQPask-EVy4MYes_3ube_PbQLTvTgVZ6XwMjPNIOkYvrGsZrRZbRCDXKqc0KBFi2YT_dQWaoiNgg
ca.crt: &lt;span class="m">1025&lt;/span> bytes
Name: cronjob-controller-token-6hfqf
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: cronjob-controller
kubernetes.io/service-account.uid: 0e4b090e-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJjcm9uam9iLWNvbnRyb2xsZXItdG9rZW4tNmhmcWYiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiY3JvbmpvYi1jb250cm9sbGVyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMGU0YjA5MGUtZTlkNC0xMWViLWIyNWItMDI0MmFjMTEwMDA5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmNyb25qb2ItY29udHJvbGxlciJ9.SKICsFaSIGnrn9pfqWg_Vrw1jBvYz_bc95tJ53FL_M9b6YQKgHRQZZH1DQciGdSd27nYSWnoG9L-ftKEZhaU7ABAAga3lNzyDJhgPdYtCy8OlxzY2nY2RdDbCsFRjaK76aIJQf_u0z8K-JSz6CjELBj294WWbXoAreCtZiQGRrrupgtUIPjUloaqx07BO2Y29N2ZMkELj_Ye5rSeffnz_djSFdwTIt6B3Jtxjp55DZjMzaj_coqmVXfGq4K90wkKlWLIbbAGYlRqEfJCpIK2OeCy5WF2EahlAUECHEQi5NqEQ1DoiVUj1LtdwQOGKXlQYT6h6GSLY_E1Q1Xv3vWFjQ
Name: daemon-set-controller-token-6ftrt
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: daemon-set-controller
kubernetes.io/service-account.uid: 0e251630-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYWVtb24tc2V0LWNvbnRyb2xsZXItdG9rZW4tNmZ0cnQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFlbW9uLXNldC1jb250cm9sbGVyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMGUyNTE2MzAtZTlkNC0xMWViLWIyNWItMDI0MmFjMTEwMDA5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRhZW1vbi1zZXQtY29udHJvbGxlciJ9.OTdB75fb-wdKbbcZJ3mS08JuJsq3urdovVUgiADbpAZnL4pVZWdAmrLadYVKFNqfXOlCaSqQefLNgSWsGcJee-YSQT6snP87Wplfo7VH05h9Xwnoz21uWpkjhIlioWbcKL1asBuBsvpSczqg4Bt3cyByxdrIJjBmBvoJpFhwf04IqyJ6ugxDLPTH-8CC5r5Xn6etm8Ey-p1rwQJb1u2FEq8K97nihv87TByrHLQv-CMn1wxfGHDYOEAneis2s0pWotvxrHWkFg1WnriDAq4hryGPDA9GRLqveFdCL76XTuT9plYFYMxLRF-8_EuwOwTa0F-LYm98o3iDhbvwkTDhiA
ca.crt: &lt;span class="m">1025&lt;/span> bytes
Name: default-token-jw2ql
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: default
kubernetes.io/service-account.uid: 0fdb30ea-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkZWZhdWx0LXRva2VuLWp3MnFsIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImRlZmF1bHQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwZmRiMzBlYS1lOWQ0LTExZWItYjI1Yi0wMjQyYWMxMTAwMDkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06ZGVmYXVsdCJ9.ijnMq7u2xRTNKXov89YF67O27Jn7uLqnRYzK4V95pWt22dN3Qayf7U-jlLm6uWec79FLKNM_08IjnobzVxnzrFhRqLqOT55mkyLfXdNdR9EE__CrPOs-PiSIsHNbAG64bUSDOwbGaFjKROFBz1dwHj1O_XQZfLNaH3_LhLzOHtxJ4_FyOOf-hhjEWgjOptptTMkU3N_z7TRU4zzX9BUWTDg5s6JBpFkDSbZ-_yu-uzl4JiEBUwf0MY3YC79caRp9uFgwuaMCoFJYV7gSqWA5IpqgQe225LBTBS2HHLPJE67WLlSrkiEe4gvngnGtO_1RkO2MBCXgVp5icSFw4zxEzw
Name: deployment-controller-token-fctz8
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: deployment-controller
kubernetes.io/service-account.uid: 0cd7cffc-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkZXBsb3ltZW50LWNvbnRyb2xsZXItdG9rZW4tZmN0ejgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGVwbG95bWVudC1jb250cm9sbGVyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMGNkN2NmZmMtZTlkNC0xMWViLWIyNWItMDI0MmFjMTEwMDA5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRlcGxveW1lbnQtY29udHJvbGxlciJ9.uobekKRLj02hr-qsNZCPNZWER2mYiZj8NCygiXz5c_r9B7AjhHkq3MlcfPe1RoU89P3hofrNWQpTY1Kikl9nspKQ_Yve2ykZidGGGoOtuaqI2h-SfNMjeqHGXM0CmQAEigrmkQtDrkwt-lz3pXEacRbh5pmS8BOWvpgfc5e8qt39YebFTKygNvCYvMgYMy5MsufSDeifFcb7J12hhXczxvYLDcbgDewhEnpxA887KaQlCML8soNmM36bC5qEU3nrGnKg1a5kvjjxaxres7VRb4U9fs0xogLAzcAsuOd40Re7QY8wNdY7dcUg2qivFSm7P-3vbiZ9Twr1kftazuR6Gg
Name: disruption-controller-token-x8n2f
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: disruption-controller
kubernetes.io/service-account.uid: 0cf3a17c-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkaXNydXB0aW9uLWNvbnRyb2xsZXItdG9rZW4teDhuMmYiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGlzcnVwdGlvbi1jb250cm9sbGVyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMGNmM2ExN2MtZTlkNC0xMWViLWIyNWItMDI0MmFjMTEwMDA5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRpc3J1cHRpb24tY29udHJvbGxlciJ9.mu_3XUNoOGZwHlTyhKygDwAFjIWY0Uf0foIiS4vGNsnBBe5AUz3bN7gD0f7EpRZoI7KeIL-OWYGLvjtsCgC-1lYCRm9DNLmNxYnoDiNcbpCFx-xHF4E4yl4v51oJtXG1Bc-Xva-S15US673Gzv-soVAfpVKOzYQVklM1cbim__Eb_vXEZ_i0r-KD1DRNERMZWjvJ159DuiKMjd6CCzkgXCSQV1K4jS2jd2taiARKUcGNw0rQBeHh1_IN460jnMGCLM0lzbcZZAA4YKhdMfsU2AjIlsvK4k6VS5G-w4lo3PA1JW4Ve-Z-Im94Lqd67A2MSqUhWLPw1cn4PGGyWTaiJA
ca.crt: &lt;span class="m">1025&lt;/span> bytes
Name: endpoint-controller-token-qbz7h
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: endpoint-controller
kubernetes.io/service-account.uid: 0ab80371-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJlbmRwb2ludC1jb250cm9sbGVyLXRva2VuLXFiejdoIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImVuZHBvaW50LWNvbnRyb2xsZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwYWI4MDM3MS1lOWQ0LTExZWItYjI1Yi0wMjQyYWMxMTAwMDkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06ZW5kcG9pbnQtY29udHJvbGxlciJ9.z4jN9B3eHKiw7RTSz-UM0RqGiPXX2-7bV9d6N-6hkfPDCfOj3BwjApxqc3FoDiPeazVSNT-cmORpgAP3b5UMYYnN5wNw2R4XfysUXfY46i1clQJqZ14o9olfX1KegC1T-yZOC8MoEHMFvngem5gEfQquW6cIM6hYQ-kgWHaYRZwH00OqPg9YchBpmmm7erx5PZXmlWmZ76lobAyi-nAzShqJA5mKl0amSwzfQfd7ErZJhsHJrWynqpJi_SSTRsDL2zYY79aiNEMaXe4nXa0rlyVNZmRRiaA3_ca665S840KTMjvLfub4fShxpRib8EEnRJOAJft6kyfCn6bf2Uf1Og
Name: expand-controller-token-q7k8m
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: expand-controller
kubernetes.io/service-account.uid: 0fc0ecea-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJleHBhbmQtY29udHJvbGxlci10b2tlbi1xN2s4bSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJleHBhbmQtY29udHJvbGxlciIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjBmYzBlY2VhLWU5ZDQtMTFlYi1iMjViLTAyNDJhYzExMDAwOSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTpleHBhbmQtY29udHJvbGxlciJ9.w0CjgPX7fKK1huV-Lt0ZRGLo5JgMiAR9yn11R0CrsIyDyPGRlwOrUoDSRxNn0t__Bq6YSjblPDAjz0hh2PToc44g4abe1aSfF2cXtps1y87Jee78jQ3rF9vGzinqPCJGmiXCZNvAunEAT88KkiaND74X3rHgPU-E0XjlNVyjlwMRUQWpA4Z7rqMTSb448L9vjFETbT4n7jdFib3iijeP8MgcKDxiZYpkKhQcsvvO-r-r6ndHRw7_eO06Yyl-nW20NALbc3CB8gl-1JLuFkB0CsVE2J8D3s8vkQ1rd0fMPo67cgqnc5jCULRgKWYoKOaGtcCc_UdxOg_P_9gS3zfhjA
ca.crt: &lt;span class="m">1025&lt;/span> bytes
Name: generic-garbage-collector-token-qkjc7
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: generic-garbage-collector
kubernetes.io/service-account.uid: 0f46f27b-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJnZW5lcmljLWdhcmJhZ2UtY29sbGVjdG9yLXRva2VuLXFramM3Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImdlbmVyaWMtZ2FyYmFnZS1jb2xsZWN0b3IiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwZjQ2ZjI3Yi1lOWQ0LTExZWItYjI1Yi0wMjQyYWMxMTAwMDkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06Z2VuZXJpYy1nYXJiYWdlLWNvbGxlY3RvciJ9.cVdg68sCtTFnHtZenBGyzJx5RRxPekXORa8L4et-5F5WVoAyvVLIc4g1kPEWgdrGQwAbXsgjowYEGZiZZM7VjHLTKpiHaYuYyFjPVtK-bBc4EuB4bPhX-5h0w5A5e1npDTqRHohIel9Q4Tx9bCfMGtzoP9C33Dog5kIFbNA1h45YaT5DUSIe9lnD8MbDbf6JoLLitB-jJdv9B7oscm7b-azrZpoU6ffe6KifzkZmlfbjwuQJtXDzgL4fD0wzTCfNP1Iun69u5NdejbEhWA2lS0Gt4KNgMX3wSQgL_4_htOs2__PwlH3d1F-VmZFweVJD6CSBqpttsgBEO3y1dwkM8w
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
Name: horizontal-pod-autoscaler-token-v46ss
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: horizontal-pod-autoscaler
kubernetes.io/service-account.uid: 0d30b7d4-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJob3Jpem9udGFsLXBvZC1hdXRvc2NhbGVyLXRva2VuLXY0NnNzIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6Imhvcml6b250YWwtcG9kLWF1dG9zY2FsZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwZDMwYjdkNC1lOWQ0LTExZWItYjI1Yi0wMjQyYWMxMTAwMDkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06aG9yaXpvbnRhbC1wb2QtYXV0b3NjYWxlciJ9.0nwfw8R2M_qtziNugziYCoGFn-aXOHUrCWea6akqBGXBaIXVW0OCeLip3oW2WO2Il4LMHAFL_xSeqCkrIXgCO_LYGGbnQ0yS_QfLsDTDUzPOZzx4_o9COOWF-rfz_7OK8T01k5xns5_Gjxhh7sWpXv5IrrGeFhIWAS10d-CPXAOx-pt2r0aG4Vg-Pn3bPVi7DZvgED5LURx-kFSTsRRN8HX32jNmLKCcQ_mn3MRrBeOohf2tvCISqVzkMZfSN-fHiemZLXqQQlD25fC1zkLLQzDHoQn_A1VKH53Ac12xso0Z1r1tK4F38L85QLhV7QE-471kYjgJMJsSWv3SbcmnRg
Name: job-controller-token-cmwfj
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: job-controller
kubernetes.io/service-account.uid: 0ac95588-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJqb2ItY29udHJvbGxlci10b2tlbi1jbXdmaiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJqb2ItY29udHJvbGxlciIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjBhYzk1NTg4LWU5ZDQtMTFlYi1iMjViLTAyNDJhYzExMDAwOSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTpqb2ItY29udHJvbGxlciJ9.JFVVRYktyZFtJTwkepgJ5xFLJZXJReBN11ebo242b7LmembqxN3dw6qaNqd9gKJpaekzcUSJaCQDlHBivbW637YSfBsR2zov3US1_lVfm1jRCJ9Li8787-V8YcQmUCyM-gxbqwER15Sx3fGYhQicgDDVLuQ1JDfz3-9RTScKKTHOoFdpU0cmfB4kfgi4OaSl5hRvW33mi4psxLem-TjXV6EmYgGvfduVm6TGoewT-3uU2K7b9_rMLDLz6B85uolAJ_V0wajv8ZZjerTon3NyLFo5Uta_zt-gauEzaxGTVk4GHYIMhQ6-PTPZ2KpQVN8MI3j7kF9KJ9-nZ5gsvyEI4A
ca.crt: &lt;span class="m">1025&lt;/span> bytes
Name: kube-proxy-token-ssgzc
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: kube-proxy
kubernetes.io/service-account.uid: 0cea9f15-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJrdWJlLXByb3h5LXRva2VuLXNzZ3pjIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6Imt1YmUtcHJveHkiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwY2VhOWYxNS1lOWQ0LTExZWItYjI1Yi0wMjQyYWMxMTAwMDkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06a3ViZS1wcm94eSJ9.IzyixUsktQs4oQAQ-r1PTbtRrBrVf7elWCypxBkUHDhBjNQOZIjt0VnIjRoTdJenIOCH6tAmeMddJMWs8nYRMte_Pi-_XylesQypzAeiuE4oT8bxGZAC2H6JJV1D2OIrYaABWJzVejqakkrtsk5RQBbMMyXlkFK1_R1YP-5XmhzyNyfCaKzi9cprbQNX3IV72I9R9DUo6YwO3j0r_5cnKMfgPAk95ACrwqglYMpLWCFFRDjS7vWSW_ue65Yohvs85xBvYiG_ybkN75eegQYt-1AS6T0S-TBY2V3lyfO4k52VomAm34d1WgPjUyWUEun5ywH9ucDU7T_tGH4rzf66Kw
Name: kubernetes-dashboard-certs
Namespace: kube-system
Labels: k8s-app&lt;span class="o">=&lt;/span>kubernetes-dashboard
Annotations:
Type: Opaque
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
Name: kubernetes-dashboard-key-holder
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: &amp;lt;none&amp;gt;
Type: Opaque
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
priv: &lt;span class="m">1679&lt;/span> bytes
pub: &lt;span class="m">459&lt;/span> bytes
Name: kubernetes-dashboard-token-njndv
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: kubernetes-dashboard
kubernetes.io/service-account.uid: 41afcd0e-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZC10b2tlbi1uam5kdiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjQxYWZjZDBlLWU5ZDQtMTFlYi1iMjViLTAyNDJhYzExMDAwOSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTprdWJlcm5ldGVzLWRhc2hib2FyZCJ9.LirJ7cHBUyF30S6KKjKMNI27WLL2MC2gPPhJc1GovzWgTwUWVPYImNcXYoUOVUZ-ZJwqT9ukOH_0vxF2kblKW3xSmB_rHQ3cvs6daVNA5-HPeBT8kq0EhiRlFALYezgKpCgkpiXvTE6MGNjMhHPJ0C8yi8jEY6OC9Y4DZQXmPQV3B2Xpk7ZoaMXoHFHfPTDSpNdeWSUJN9JErrmVBFpWeTuGI6m9A2wInQY1zjLiCm-iH9y0AbpwYg1QKGWNvKVSwYkS4ViDA6qKEzGWQxWSbCdsCIGhjGNz_nxMoVm1yPeU4W1yn-Psk6LLiIzSpizZTl-3VfIR0dl5mNHq7N3KPg
Name: namespace-controller-token-smw7m
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: namespace-controller
kubernetes.io/service-account.uid: 0f20a4d0-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJuYW1lc3BhY2UtY29udHJvbGxlci10b2tlbi1zbXc3bSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJuYW1lc3BhY2UtY29udHJvbGxlciIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjBmMjBhNGQwLWU5ZDQtMTFlYi1iMjViLTAyNDJhYzExMDAwOSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTpuYW1lc3BhY2UtY29udHJvbGxlciJ9.pQGalvSM_lh41fNKsY2ddZghUe_lJuz9Y9rmbXY0V-RjmF0BagSobz9SxucHAAOttIraamgTKksbxLEoAV509Yfxf62ybE4cW9KPggozc8iluwGLkdWYdGZxVe4midlnYcIpYTv4Zueav8f-9W2cGWyzHustTZf3R9b2A5N02uT91aZ38QWllsy_WKMVAaDLCLel71koJ_HjjDqrZ_ObO-YAtBeA9zslY0nhH-mpj0WsjW76Af4pVTotFBGdqtO9eV3Oe_H6sy6y2BAjxItGDTU9xvq7f3-taa-SB9j5XbEPJ1I8ObxcOLhYtvyCcHf2ZbxR9vVJ1CLR4ymry1mD2w
Name: node-controller-token-9ppdt
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: node-controller
kubernetes.io/service-account.uid: 0d0b0ff7-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJub2RlLWNvbnRyb2xsZXItdG9rZW4tOXBwZHQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoibm9kZS1jb250cm9sbGVyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMGQwYjBmZjctZTlkNC0xMWViLWIyNWItMDI0MmFjMTEwMDA5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOm5vZGUtY29udHJvbGxlciJ9.Hg-v6PYzmoSmC-FVhE07OVOtLSGb7eIDPeY77k9l4tlCT8wDPNSo3zF8LKlsKCehDeKVfQL6bdcG596ECF_Vh0zHjswZrZMCsOWO0sBArDLzOu6Zo2wgvbkPZHYA0X7nt5jc10W_q-Nw1Ud3WLNtW7v4iWpbeGZGz7EgCrqW5XqYxA9P8CA4jdMBmdit-zwjaJUu5jjIYRbeYQhKF8hrC00vMXyYMRZp2dzGSMAmI4yF2OO-QdKc1Mieq-w4i8pOl7gO4nYRLQCAcdY2TjCO5VbcigZ6IWzzQb120WgC2Iqd5mhSzcmMFcrT1IbzOm91bFkgwGAs1oQw8Cy8iCV9SQ
Name: persistent-volume-binder-token-9hjlk
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: persistent-volume-binder
kubernetes.io/service-account.uid: 0fb0da85-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJwZXJzaXN0ZW50LXZvbHVtZS1iaW5kZXItdG9rZW4tOWhqbGsiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoicGVyc2lzdGVudC12b2x1bWUtYmluZGVyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMGZiMGRhODUtZTlkNC0xMWViLWIyNWItMDI0MmFjMTEwMDA5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOnBlcnNpc3RlbnQtdm9sdW1lLWJpbmRlciJ9.MbBQ48J2l7rgogx8YWgbX5ys_oyNBLBOn0xsuhO5_8jIKLwV5hup5X2JdjwTCw0uGZ0lkYgYANXnnK2Q39mlsJLMYCudaVWGZm7IumjyLuu9CkvhUmEHhYmqY2if-PAAXxaO_hKSbEpsmBEQKWGnU69wUdsEoQdBwqlHg4jZ69dXvrMsBgJ96ic_511e9B8R_GPKS1IXocTJtFcbCp-rpbk9REBGYQB-Fjh2UBpPvmeFQcfZ39yvBRMmi1LWW7sTQtwEiTErgYcIPpr7klSguSApm9un75P4tCjLPNFbIjUbf3lCqonwtEwADD1sKg2f9TSxdverIhoXX90IBJBTUA
Name: pod-garbage-collector-token-l42r5
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: pod-garbage-collector
kubernetes.io/service-account.uid: 0dfebd7d-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJwb2QtZ2FyYmFnZS1jb2xsZWN0b3ItdG9rZW4tbDQycjUiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoicG9kLWdhcmJhZ2UtY29sbGVjdG9yIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMGRmZWJkN2QtZTlkNC0xMWViLWIyNWItMDI0MmFjMTEwMDA5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOnBvZC1nYXJiYWdlLWNvbGxlY3RvciJ9.VaMklkb7hlu7MRkn0rE2Tlu-lJoeXQI4aB7qVGGHisp3nGVOjSodrldgQUxFnO3oJ9invV6RcYIS-yCaBfL8c0tak7yrGSWI2gjIrM-nS16PgLDYPjbZqJk9wXKIdzqt63Nt8HvQfBdi0IKmyM8eszOXywpHX9wyJFBGH5PYRdBs3HbpzNg5_GdjPO2IGbQGwZyyonb0o1_xk4GH-bAfbe3fCsHN5N1zY39DNo-qJ6xWC89Xfufgw95-_JxR_Pd7IiuUyqFN9KxqrbvdqdtML2ZS53fvpNqZ62_a9nK6xefGIgfxBXov_eqsjlBKh7R0vXyFAHpn3yTLUKZP-zHtGg
Name: pv-protection-controller-token-qp2xr
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: pv-protection-controller
kubernetes.io/service-account.uid: 0ed4594d-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJwdi1wcm90ZWN0aW9uLWNvbnRyb2xsZXItdG9rZW4tcXAyeHIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoicHYtcHJvdGVjdGlvbi1jb250cm9sbGVyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMGVkNDU5NGQtZTlkNC0xMWViLWIyNWItMDI0MmFjMTEwMDA5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOnB2LXByb3RlY3Rpb24tY29udHJvbGxlciJ9.e52Sqc6aGtwNO4ecQRqddvzWsqkVOvj0MtMT8DmLf21sxv3W0yDDJYYTz6rzljqJPOkP7JBoNVoZL80e0NCXArmA27B4vCPTzCnSCrSSquoljMvxFmalnnJke6TQZKhplDtMy16orAM00Dr4KAUcphDP0uwO2Lsu6uSyFxiMQ53nRxzRt8fIf2HJZecHnvxA3qYKDpJ9ceZK0EgtzSBCSY8qNW9hVvAlUUjCkoJHeSzBeIrJTrI9GzYkkeqWfIdLy9fBpYHiCSxScKg7IVQ7iPqyZjYoo9BFKeXiIS87fD9qCh_xOAIKtmjAWmgaabEqcUx-kefbVTNKLhWn1AUyGw
Name: pvc-protection-controller-token-b6q9s
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: pvc-protection-controller
kubernetes.io/service-account.uid: 0ad1b174-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJwdmMtcHJvdGVjdGlvbi1jb250cm9sbGVyLXRva2VuLWI2cTlzIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6InB2Yy1wcm90ZWN0aW9uLWNvbnRyb2xsZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwYWQxYjE3NC1lOWQ0LTExZWItYjI1Yi0wMjQyYWMxMTAwMDkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06cHZjLXByb3RlY3Rpb24tY29udHJvbGxlciJ9.TeJQ1uCU_Jx5c7L6eZ2Is20BT9SmwvadmZdK7fF4W0jGzlohLbS-ACQQJTMszWxti9BiAxke_bijrUoKZElDlbNpgXqiqnxaIAUdJIkVPm8IQpVN7d0GfYmEeHcUl5kUHO5Oc9AFqFcQeknxcTo8RI839SXp595DHTq0SPT3gaMfSqpV3dHIlSHixBke9oG9bTYo4OoAOljfq2OT30JQSk_Z-6-_ftvCxyVtgGZGs9jyC462ic5oxQ8U4BwJoPxmTCXn_aQPXygmlONMsAo4HIRzCmv2eey44oKvGBR5cInhGaoP-SUWuc0JG1PZFDLIllU2lod-DBSdxm7err6cTQ
Name: replicaset-controller-token-9mx8t
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: replicaset-controller
kubernetes.io/service-account.uid: 0cf1ad30-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJyZXBsaWNhc2V0LWNvbnRyb2xsZXItdG9rZW4tOW14OHQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoicmVwbGljYXNldC1jb250cm9sbGVyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMGNmMWFkMzAtZTlkNC0xMWViLWIyNWItMDI0MmFjMTEwMDA5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOnJlcGxpY2FzZXQtY29udHJvbGxlciJ9.c5PbPe1CGfhMX1LzxQcQKPm3bNIFjwf9HXtSHs-wzF3caLtwNqiqczQid6F2Nf2EWbgG-ZarSJ1ESMdoPEvNprF-prVNXxeoTAuX4C9re-0zcCuZTGpxRvLq_IPZRJUHj12d3Lr8JAXdgJFBRvwQZhgDe0Tyinh5JJnNwlWvZ07mMBOVbAgcq2Ut_oAwu9DCiNv-gZHqBI-BISH6a7uF6YIdBOKIJxkTs3D3aaPYtyw-a0qBp2bAlRa3Un0IgjDUe9eiCGAc1cYRYuWUV-Ro2zrOBxwvVCh6r7iIWIuHb7y8Lc9NkbTXnxOSLwOyaCCkuioiSa_LytFlhCJlC09ubA
Name: replication-controller-token-99sjd
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: replication-controller
kubernetes.io/service-account.uid: 0efa8a2d-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJyZXBsaWNhdGlvbi1jb250cm9sbGVyLXRva2VuLTk5c2pkIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6InJlcGxpY2F0aW9uLWNvbnRyb2xsZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwZWZhOGEyZC1lOWQ0LTExZWItYjI1Yi0wMjQyYWMxMTAwMDkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06cmVwbGljYXRpb24tY29udHJvbGxlciJ9.d157wtS1_qaJdrOFJsmZR37qe7XwvIypzUOJHU4UZpvynL2Na2Wim1xH9-n5AlS-fO_VdwrkBSG7Ef8XV_sziJ9jJmLU2vXo_ZH6CVohviJyxkAob465QCVjjuvKwCgxS7vYCpJ78Y5Vdr7PDFu28X_kd3tNAIuhPMlhj5aeL5NWUmsRSo5aXl4DhoossqF81GkcmKe-kuMSnm9BOFNxokTDA2zFWbOtT6oK7ZSz2oKVN8YoIu5534nmH7-ydokDrcNgUnqy9ByTA8BAZp7ueMlIc5xktJlvt6sQ8a3gNg90j_3H2RCA1wQZJcIaB8IVVXe2bt0ZaQI9wrYBBb7vEg
Name: resourcequota-controller-token-hdch8
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: resourcequota-controller
kubernetes.io/service-account.uid: 0e881d99-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJyZXNvdXJjZXF1b3RhLWNvbnRyb2xsZXItdG9rZW4taGRjaDgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoicmVzb3VyY2VxdW90YS1jb250cm9sbGVyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMGU4ODFkOTktZTlkNC0xMWViLWIyNWItMDI0MmFjMTEwMDA5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOnJlc291cmNlcXVvdGEtY29udHJvbGxlciJ9.omLEn20jTg0sn6P8Gihen5l3IuxFNIxK79wv_q00aOsGsAK1BbFQlIOWKHqaO81yvS3T_7UXSyCr01HTVhXabsJPS82t1Gr7jzzN4AKM230nHW_VGRjgU2gN4GxgAYByOTXBootTINz37J9Kmz0HSdTkIuqylXR6pUVrLKYJU2YqPqWe1fcoOi8P66d5qmpXfj806hw2SJgvxrf36v9cGMeoK5JDa1rI7VFAVLR-kWy9LgLQpVzDfuNqHAznay1wBcT3_Kb6l4JOkd_QdNZRl0xsP1NZMVaPqrbsxxO5us3_idNtZvo9fSsQU9itxodtnqBeSSlnvZH1Kr4tVa-7eg
Name: service-account-controller-token-n268k
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: service-account-controller
kubernetes.io/service-account.uid: 0ad49e7f-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJzZXJ2aWNlLWFjY291bnQtY29udHJvbGxlci10b2tlbi1uMjY4ayIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJzZXJ2aWNlLWFjY291bnQtY29udHJvbGxlciIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjBhZDQ5ZTdmLWU5ZDQtMTFlYi1iMjViLTAyNDJhYzExMDAwOSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTpzZXJ2aWNlLWFjY291bnQtY29udHJvbGxlciJ9.gVr-OJa0nVuUTFjsUwdAeiQQHEFVztiXUQfV7AgRmi850C1QiwpiBAejT8wOK6lwhOrhzT5EQ77ITqmTQZz1BC_PfZRgdNdZz6Ytw01TW4AeWe3A723yiqFDnasmFB7XhbKDQxFLd0dw5VjlDsdaEu0IIU0rdQKul8EUiccJolP2s-5V4FvvPfcPqnuFTlbbTiv509DE9G1ZTcZ4TxcBx4-0aiIe_vdUjuE2ECaOIPry0rN1yg3JNA5mJhOM6hAfmaz-DzH7DNh134RiWdHxQxQqeoRrlby2aS7IayT_JSiSZecoYGvL-CFteJdzMEWqWzIzMuDb9uzHJ1CBzOezbQ
Name: service-controller-token-dgqch
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: service-controller
kubernetes.io/service-account.uid: 0ce95734-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJzZXJ2aWNlLWNvbnRyb2xsZXItdG9rZW4tZGdxY2giLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoic2VydmljZS1jb250cm9sbGVyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMGNlOTU3MzQtZTlkNC0xMWViLWIyNWItMDI0MmFjMTEwMDA5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOnNlcnZpY2UtY29udHJvbGxlciJ9.b7Y5beL-iAl64nYe_gTiD8ogwl5GTLpeE9GBxaEMKy3KbLiags3p-0ZqXLoDD_e91BaPxpmUyRfavWV5lZ85uzzBdH-q4aD6FnwHBmoTwbw3TK1znxCeri9xObQNmxDPH7CjVQLVHbksMFGum1L1xWCf3dw0p2ZrPbgzRzq93uUYjiW-w2H40Ub0q9TFTp9ic-T6wRq4DqT8XgBKa__nNblCHiM8hlZ6ufHFYeE4aAFcLLc1RaKvFxH7oO10AJ0fB45NwaMPa1iC0O5dTl57jQbh9mxusLtKAysAMMugObnCJ9yYSA65n9p9OsYTYZVp0OOCRGu7P4lO3XR3ZLr1-Q
Name: statefulset-controller-token-j7858
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: statefulset-controller
kubernetes.io/service-account.uid: 0ce28a94-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJzdGF0ZWZ1bHNldC1jb250cm9sbGVyLXRva2VuLWo3ODU4Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6InN0YXRlZnVsc2V0LWNvbnRyb2xsZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwY2UyOGE5NC1lOWQ0LTExZWItYjI1Yi0wMjQyYWMxMTAwMDkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06c3RhdGVmdWxzZXQtY29udHJvbGxlciJ9.ju-pOwheRoeE61w_NiQ8jLXFFhIb0SA6uaOFcKR5SmaN4bhQYIdlK0IywWQwu6RzCzIgCr4XrGrWsxblNpBMQC2-dNIuELWIMAFR5gjKQZh4v2Zmh4ysXGhbj7repAOLYvcseN-tGW3hax4IywN0GI5Pw257xoHPXZToA9lnqnIPiVdzlSOe8WBfhv6omdeGmtrgNGkgAjh2LiXViwPW7V3DVPjIY5d3k0v3pqzHSuxNYTRdjqcg53TMNTUFe2LKTVbzmgLngdKufOPmtabtnxU21r1ua887BCxl9RO7FUm01CTBlofKF5wkaGr5_w6zXRVgLE6Fo4YrhILf1z1BaQ
Name: token-cleaner-token-9fvhw
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: token-cleaner
kubernetes.io/service-account.uid: 0eb7ce45-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJ0b2tlbi1jbGVhbmVyLXRva2VuLTlmdmh3Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6InRva2VuLWNsZWFuZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwZWI3Y2U0NS1lOWQ0LTExZWItYjI1Yi0wMjQyYWMxMTAwMDkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06dG9rZW4tY2xlYW5lciJ9.QDNslXVqy5OPVb2mKpgsBDpWbTIaSgaZtjnvwwlsxyARYyLDuBHHpik2_IcmVI94riv3LF-WKI2m3fw9uAlkQRmebQCNCDYKWiJEttvEXIgb6vcwEIO3Bp2Q-nbwPjzxvGHmxluidzKZ4EIusyxqsxoMCPevMmsYHQWhegIvezE8tL_7oUPIx_rGW1lqB6ohZwjSPHTXvnmzqvP1zQDmwPMDN4Neqy3W-ahOAmBdlGx1cnPtEWY7z4cN7oMqY_l4CXwbZbq54Dh6M9ODZmiwd5TarLGv2fqaNpiG5YZwtlnRz9cAIC8GfGz_OAsj9bMLkt3yC_SHHdXeQ3UYQijYkA
Name: ttl-controller-token-wpd5f
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: ttl-controller
kubernetes.io/service-account.uid: 0d9b87be-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJ0dGwtY29udHJvbGxlci10b2tlbi13cGQ1ZiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJ0dGwtY29udHJvbGxlciIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjBkOWI4N2JlLWU5ZDQtMTFlYi1iMjViLTAyNDJhYzExMDAwOSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTp0dGwtY29udHJvbGxlciJ9.jSUdoCKEBQYkAL5GtVQWCzFmH4FQ6GaenbDm9Cu5psOGhAd7_fpPejjmTinedpCmv0KgYIfOpzWyjQ-b1lJciZ9OFBapVDh--51kYR-enbhXpa5EP8T5O0PcnzXRojRZPMGPgQBWbn4JgTrfplzLRlrjFInTJVXA08a6B5rYXXmdABMCD08eaba9M4XeFuCIYoStmNhYw-fBPbtBegTif2ToT47-EojkMJnL8qI-oOL1nAbFHwaHSPC-czpf7VgSRBpnfTzbGrtrRwUX3vbYrrSTGo2RK87P9Qqb7HPWLnM1LDKHlgwkNmUpp9Dt8Tmun8XYWOpfQwaAqn6zRpbsPA
Name: weave-net-token-fn28h
Namespace: kube-system
Labels: &amp;lt;none&amp;gt;
Annotations: kubernetes.io/service-account.name: weave-net
kubernetes.io/service-account.uid: 0d455a77-e9d4-11eb-b25b-0242ac110009
Type: kubernetes.io/service-account-token
&lt;span class="nv">Data&lt;/span>
&lt;span class="o">====&lt;/span>
ca.crt: &lt;span class="m">1025&lt;/span> bytes
namespace: &lt;span class="m">11&lt;/span> bytes
token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJ3ZWF2ZS1uZXQtdG9rZW4tZm4yOGgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoid2VhdmUtbmV0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMGQ0NTVhNzctZTlkNC0xMWViLWIyNWItMDI0MmFjMTEwMDA5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOndlYXZlLW5ldCJ9.PpqFn31z-GiFAdE-Nd9-R8xuW8ESiisX53Vn_niAvFQ2DPII8q4150iNJDedLZ6nZiXBgV4e7b3NcZzNGhwRVAUyRgLrIqjdgNk-04YJ40bdP4d_5hSUylEn_QH1dgON6tMV9cK6skC0weFZzpPptGhA0bhyFdNl3DvGKGGmMgfyQsf3tEjZjEyqOuPLPtW0TPF2h98UmSsBzWbn-tCM_GEZTVY-3uxzfn2AfkuSI-e9ri1W4X8_W1z_cFIXk4Pwg0q7RWcJi44BCBJE079ezRLIWbowjXOXpqrZwe_jw_F-fJI_7ddxWDx68-wBwhjVIdNqnnMvzB-RKfgaIcWEiw
&lt;/code>&lt;/pre>&lt;/div>&lt;p>部署仪表板时，它使用 externalIPs 将服务绑定到端口 8443。这使得仪表板可供集群外部使用，并可在 &lt;a class="link" href="https://2886795309-8443-elsy05.environments.katacoda.com/" target="_blank" rel="noopener"
>https://2886795309-8443-elsy05.environments.katacoda.com/&lt;/a> 中查看&lt;/p>
&lt;p>使用 &lt;em>admin-user&lt;/em> 令牌访问仪表板。&lt;/p>
&lt;p>对于生产环境，建议使用 &lt;code>kubectl proxy&lt;/code> 来访问仪表板，而不是 externalIP。在 &lt;a class="link" href="https://github.com/kubernetes/dashboard" target="_blank" rel="noopener"
>https://github.com/kubernetes/dashboard&lt;/a> 上查看更多详细信息。&lt;/p></description></item><item><title>Kubernetes初探（一）</title><link>https://www.catfish.top/p/k8s-basic-1/</link><pubDate>Tue, 20 Jul 2021 10:21:00 +0800</pubDate><guid>https://www.catfish.top/p/k8s-basic-1/</guid><description>&lt;img src="https://www.catfish.top/p/k8s-basic-1/kubernates.png" alt="Featured image of post Kubernetes初探（一）" />&lt;blockquote>
&lt;p>Katacoda在线课：&lt;a class="link" href="https://www.katacoda.com/courses/kubernetes/launch-single-node-cluster" target="_blank" rel="noopener"
>Launch A Single Node Cluster&lt;/a>&lt;/p>
&lt;p>本系列教程希望能通过交互式学习网站与传统方式结合，更高效、容易的学习知识。
本系列教程将使用 &lt;a class="link" href="https://www.katacoda.com" target="_blank" rel="noopener"
>Katacoda在线学习平台&lt;/a> 完成学习。&lt;/p>
&lt;/blockquote>
&lt;p>&lt;em>Minikube&lt;/em> 是一个可以轻松在本地运行 &lt;em>Kubernetes&lt;/em> 的工具。 &lt;em>Minikube&lt;/em> 是一个在本地上计算机的虚拟机内运行一个单节点 &lt;em>Kubernetes&lt;/em> 集群，便于用户能够完成日常开发工作，同时也能够让新用户快速了解 &lt;em>Kubernetes&lt;/em> 。&lt;/p>
&lt;p>详情见： &lt;a class="link" href="https://github.com/kubernetes/minikube" target="_blank" rel="noopener"
>https://github.com/kubernetes/minikube&lt;/a>&lt;/p>
&lt;h2 id="步骤-1---启动-minikube">步骤 1 - 启动 &lt;em>Minikube&lt;/em>&lt;/h2>
&lt;p>&lt;em>Minikube&lt;/em> 已经安装并配置到环境中。通过运行 &lt;code>minikube version&lt;/code> 命令检查它是否已正确安装。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ minikube version
minikube version: v1.8.1
commit: cbda04cf6bbe65e987ae52bb393c10099ab62014
&lt;/code>&lt;/pre>&lt;/div>&lt;p>通过运行 &lt;code>minikube start&lt;/code> 命令启动集群。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ minikube start --wait&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span>
* minikube v1.8.1 on Ubuntu 18.04
* Using the none driver based on user configuration
* Running on localhost &lt;span class="o">(&lt;/span>&lt;span class="nv">CPUs&lt;/span>&lt;span class="o">=&lt;/span>2, &lt;span class="nv">Memory&lt;/span>&lt;span class="o">=&lt;/span>2460MB, &lt;span class="nv">Disk&lt;/span>&lt;span class="o">=&lt;/span>145651MB&lt;span class="o">)&lt;/span> ...
* OS release is Ubuntu 18.04.4 LTS
* Preparing Kubernetes v1.17.3 on Docker 19.03.6 ...
- kubelet.resolv-conf&lt;span class="o">=&lt;/span>/run/systemd/resolve/resolv.conf
* Launching Kubernetes ...
* Enabling addons: default-storageclass, storage-provisioner
* Configuring &lt;span class="nb">local&lt;/span> host environment ...
* Done! kubectl is now configured to use &lt;span class="s2">&amp;#34;minikube&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>现在，您的在线终端中有一个正在运行的 &lt;em>Kubernetes&lt;/em> 集群。 &lt;em>Minikube&lt;/em> 会启动一个虚拟机为 &lt;em>K8S&lt;/em> 集群提供运行环境。&lt;/p>
&lt;h2 id="步骤-2---集群信息">步骤 2 - 集群信息&lt;/h2>
&lt;p>用户使用 &lt;em>kubectl&lt;/em> 客户端与集群交互。该工具用于管理 &lt;em>Kubernetes&lt;/em> 和在集群上运行的应用程序.&lt;/p>
&lt;p>通过 &lt;code>kubectl cluster-info&lt;/code> 命令查看集群详情信息和健康状态。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl cluster-info
Kubernetes master is running at https://172.17.0.10:8443
KubeDNS is running at https://172.17.0.10:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
To further debug and diagnose cluster problems, use &lt;span class="s1">&amp;#39;kubectl cluster-info dump&amp;#39;&lt;/span>.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>通过 &lt;code>kubectl get nodes&lt;/code> 查看集群中的各节点信息。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl get nodes
NAME STATUS ROLES AGE VERSION
minikube Ready master 9m15s v1.17.3
&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果节点被标记为 &lt;strong>NotReady&lt;/strong> 则它仍在启动组件阶段。&lt;/p>
&lt;p>此命令显示可用于托管我们的应用程序的所有节点。现在我们只有一个节点，可以看到它的状态是 &lt;strong>Ready&lt;/strong>。&lt;/p>
&lt;h2 id="步骤-3---部署容器">步骤 3 - 部署容器&lt;/h2>
&lt;p>现在可以通过 &lt;em>Kubernetes&lt;/em> 集群来部署容器。&lt;/p>
&lt;p>&lt;code>kubectl run&lt;/code> 命令能够将容器部署到集群中。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl create deployment first-deployment --image&lt;span class="o">=&lt;/span>katacoda/docker-http-server
deployment.apps/first-deployment created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>部署状态可以通过 &lt;em>Pods&lt;/em> 的运行状态得知。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl get pods
NAME READY STATUS RESTARTS AGE
first-deployment-666c48b44-n7qjz 1/1 Running &lt;span class="m">0&lt;/span> 60s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>容器运行后，可以根据需求使用不同的网络选项公开暴露接口。其中的一种解决方案是 &lt;em>NodePort&lt;/em> ，它为容器提供动态端口。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl expose deployment first-deployment --port&lt;span class="o">=&lt;/span>&lt;span class="m">80&lt;/span> --type&lt;span class="o">=&lt;/span>NodePort
service/first-deployment exposed
&lt;/code>&lt;/pre>&lt;/div>&lt;p>下面的命令能够查询到绑定的端口，并且能够发送HTTP请求进行测试。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">PORT&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>kubectl get svc first-deployment -o go-template&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;{{range.spec.ports}}{{if .nodePort}}{{.nodePort}}{{&amp;#34;\n&amp;#34;}}{{end}}{{end}}&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
$ &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Accessing host01:&lt;/span>&lt;span class="nv">$PORT&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
Accessing host01:32492
$ curl host01:&lt;span class="nv">$PORT&lt;/span>
&amp;lt;h1&amp;gt;This request was processed by host: first-deployment-666c48b44-n7qjz&amp;lt;/h1&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示的是处理请求的容器。&lt;/p>
&lt;h2 id="步骤-4---仪表盘">步骤 4 - 仪表盘&lt;/h2>
&lt;p>使用 &lt;em>Minikube&lt;/em> 命令启用仪表板&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ minikube addons &lt;span class="nb">enable&lt;/span> dashboard
* The &lt;span class="s1">&amp;#39;dashboard&amp;#39;&lt;/span> addon is enabled
&lt;/code>&lt;/pre>&lt;/div>&lt;p>通过使用 &lt;em>yaml&lt;/em> 文件来定义部署 &lt;em>Kubernetes Dashboard&lt;/em> 。&lt;strong>该配置仅适用于&lt;code>Katacoda&lt;/code>&lt;/strong>&lt;/p>
&lt;p>&lt;strong>/opt/kubernetes-dashboard.yaml&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Namespace&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">addonmanager.kubernetes.io/mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Reconcile&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kubernetes.io/minikube-addons&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dashboard&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kubernetes-dashboard&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selfLink&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/api/v1/namespaces/kubernetes-dashboard&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">finalizers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">kubernetes&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">status&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">phase&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Active&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kubernetes-dashboard&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kubernetes-dashboard-katacoda&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kubernetes-dashboard&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">protocol&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TCP&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">targetPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">9090&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">nodePort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">30000&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">k8s-app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kubernetes-dashboard&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NodePort&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl apply -f /opt/kubernetes-dashboard.yaml
namespace/kubernetes-dashboard configured
service/kubernetes-dashboard-katacoda created
&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以使用 &lt;em>Kubernetes&lt;/em> 仪表板查看部署到集群中的应用程序。仪表板将部署在 &lt;em>30000&lt;/em> 端口，但需要一段时间才能完成启动。&lt;/p>
&lt;p>要查看 &lt;em>Dashboard&lt;/em> 启动的进度，请使用 &lt;code>kubectl get pods -n kubernetes-dashboard -w&lt;/code> 查看 &lt;em>kube-system&lt;/em> 命名空间中的 &lt;em>Pod&lt;/em>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ kubectl get pods -n kubernetes-dashboard -w
NAME READY STATUS RESTARTS AGE
dashboard-metrics-scraper-7b64584c5c-jmkls 1/1 Running &lt;span class="m">0&lt;/span> 6m15s
kubernetes-dashboard-79d9cd965-fcb4t 1/1 Running &lt;span class="m">0&lt;/span> 6m14s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>启动好后，仪表盘的在线访问地址为： &lt;a class="link" href="https://2886795306-30000-ollie07.environments.katacoda.com/" target="_blank" rel="noopener"
>https://2886795306-30000-ollie07.environments.katacoda.com/&lt;/a>&lt;/p></description></item><item><title>Katacoda 在线学习神器</title><link>https://www.catfish.top/p/katacoda/</link><pubDate>Mon, 19 Jul 2021 17:57:00 +0800</pubDate><guid>https://www.catfish.top/p/katacoda/</guid><description>&lt;img src="https://www.catfish.top/p/katacoda/katacoda.jpg" alt="Featured image of post Katacoda 在线学习神器" />&lt;h2 id="介绍">介绍&lt;/h2>
&lt;p>&lt;code>Katacoda&lt;/code> 是一个面向软件工程师的交互式学习和培训平台，可在浏览器中使用真实环境学习和测试新技术，帮助开发人员学习，并掌握最佳实践。&lt;/p>
&lt;p>&lt;code>Katacoda&lt;/code> 的目标是消除新技术和技能的障碍。&lt;/p>
&lt;p>&lt;code>Katacoda&lt;/code> 提供了一个平台来构建实时交互式演示和培训环境。运行环境可以根据应用要求进行定制。分步指导路径旨在确保用户以最佳方式学习。用户可以根据设计好的引导步骤，通过浏览器上的终端界面操作一套完整的环境，一步步的学习和实践。&lt;code>Katacoda&lt;/code> 的出现很好的解决了这些问题。课程设计者可以定制应用程序所需环境，并设计循序渐进的指导路径，旨在确保用户以最佳方式学习。&lt;/p>
&lt;p>&lt;code>Katacoda&lt;/code> 同样也是&lt;code>Kubernetes&lt;/code>官网的学习工具，能够快速帮助开发者掌握&lt;code>K8s&lt;/code>知识与应用，同时能够节省大量搭建部署环境的时间与精力，能够让开发者专注于学习掌握&lt;code>K8s&lt;/code>。&lt;/p>
&lt;p>&lt;code>Playground&lt;/code>功能更是为开发者带来一种新的开发体验。借助于&lt;code>Katacoda&lt;/code>平台，能够快速构建满足应用要求的各类环境，开发者能够在这之中，专注于完成创造、验证等工作。&lt;/p>
&lt;h2 id="使用体验">使用体验&lt;/h2>
&lt;h3 id="课程">课程&lt;/h3>
&lt;h3 id="playground">Playground&lt;/h3>
&lt;h2 id="中文翻译-目录">中文翻译-目录&lt;/h2>
&lt;h3 id="kubernetes-basic">Kubernetes Basic&lt;/h3>
&lt;p>原文：&lt;a class="link" href="https://www.katacoda.com/courses/kubernetes" target="_blank" rel="noopener"
>https://www.katacoda.com/courses/kubernetes&lt;/a>&lt;/p>
&lt;h4 id="launch-a-single-node-cluster">Launch A Single Node Cluster&lt;/h4>
&lt;p>原文：&lt;a class="link" href="https://www.katacoda.com/courses/kubernetes/launch-single-node-cluster" target="_blank" rel="noopener"
>https://www.katacoda.com/courses/kubernetes/launch-single-node-cluster&lt;/a>&lt;/p></description></item><item><title>MIT 6.824 分布式系统初探（一）</title><link>https://www.catfish.top/p/mit6.824-1/</link><pubDate>Thu, 07 Sep 2017 01:21:00 +0800</pubDate><guid>https://www.catfish.top/p/mit6.824-1/</guid><description>&lt;img src="https://www.catfish.top/p/mit6.824-1/hadoop.png" alt="Featured image of post MIT 6.824 分布式系统初探（一）" />&lt;h2 id="概述">概述&lt;/h2>
&lt;p>Google工程师Jeffrey Dean 和 Sanjay Ghemawat在2004年发表了一篇论文&lt;a class="link" href="https://pdos.csail.mit.edu/6.824/papers/mapreduce.pdf" target="_blank" rel="noopener"
>MapReduce: Simplified Data Processing on Large Clusters&lt;/a>，MapReduce作为大规模数据处理的需求下孕育而生的产物，被创造的初衷是为了解决Google公司内部搜索引擎中大规模数据的并行化处理。&lt;/p>
&lt;p>引用&lt;a class="link" href="https://zh.wikipedia.org/wiki/MapReduce" target="_blank" rel="noopener"
>维基百科&lt;/a>中对MapReduce的介绍：&lt;/p>
&lt;blockquote>
&lt;p>MapReduce是Google提出的一个软件架构，用于大规模数据集（大于1TB）的并行运算。&lt;/p>
&lt;/blockquote>
&lt;p>概念“&lt;strong>Map（映射）&lt;/strong>”和“&lt;strong>Reduce（归纳）&lt;/strong>”，及他们的主要思想，都是从函数式编程语言借来的，还有从矢量编程语言借来的特性。当前的软件实现是指定一个Map（映射）函数，用来把一组键值对映射成一组新的键值对，指定并发的Reduce（归纳）函数，用来保证所有映射的键值对中的每一个共享相同的键组。&lt;/p>
&lt;p>本系列将根据&lt;a class="link" href="https://pdos.csail.mit.edu/6.824/schedule.html" target="_blank" rel="noopener"
>MIT6.824&lt;/a>课程进行学习
MapReduce&lt;/p>
&lt;hr>
&lt;p>简单看来，MapReduce的架构正如其名，分为Map和Reduce两部分。&lt;/p>
&lt;p>&lt;figure style="flex-grow: 139; flex-basis: 334px">
&lt;a href="https://www.catfish.top/p/mit6.824-1/mapreduce_1.png" data-size="631x453">&lt;img src="https://www.catfish.top/p/mit6.824-1/mapreduce_1.png"
srcset="https://www.catfish.top/p/mit6.824-1/mapreduce_1_hu5bd887eb443ed765e1e333d85ebea25c_47658_480x0_resize_box_3.png 480w, https://www.catfish.top/p/mit6.824-1/mapreduce_1_hu5bd887eb443ed765e1e333d85ebea25c_47658_1024x0_resize_box_3.png 1024w"
width="631"
height="453"
loading="lazy"
alt="MapReduce Overview">
&lt;/a>
&lt;figcaption>MapReduce Overview&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>作为一个计算框架，其最大的核心便在于&lt;strong>计算&lt;/strong>二字，以往处理计算的模式为单机运行，在大数据的情况下只能使用具有更强算力的计算机来完成计算工作，而算力的提升是需要花费极大的成本，这样在成本上是极为不划算的。在这一背景下MapReduce孕育而生，有个这样一个框架，就可以将数台不同算力的计算机组成一个集群，和适度的调度下并行计算提高效率降低成本。&lt;/p>
&lt;p>根据上图，MapReduce中存在3中角色，Master，Worker（Map），Worker(Reduce）,Master负责Map，Reduce两层的调度管理,Worker(Map)负责进行Map操作，Worker（Reduce）负责进行Reduce操作&lt;/p>
&lt;p>现在以该课程&lt;a class="link" href="https://pdos.csail.mit.edu/6.824/labs/lab-1.html" target="_blank" rel="noopener"
>lab1&lt;/a>为例来进行细致的学习，整套课程将由&lt;a class="link" href="https://golang.org/" target="_blank" rel="noopener"
>Go&lt;/a>语言来实现。
lab1主要是对MapReduce模型进行初步的学习，实现一个本机的&lt;code>MapReduce&lt;/code>模型，完成对多个文件的词频统计。&lt;/p>
&lt;h3 id="示例程序流程">示例程序流程&lt;/h3>
&lt;p>入口由上层程序控制，这个地方从master调度开始，预先定义Reduce任务个数m，再根据文本文件输入数量n。&lt;/p>
&lt;p>master将n传递给doMap也就是Map调度层，告诉Map调度层执行n次Map计算，每个Map计算层对应输入各个文本文件的数据。&lt;/p>
&lt;p>Map调度层将输出m*n个文件作为Map和Reduce的中间数据传递媒介，举例假设现在m为2、n为3，输出文件&lt;code>mid-0-0&lt;/code> &lt;code>mid-0-1&lt;/code> &lt;code>mid-1-0&lt;/code> &lt;code>mid-1-1&lt;/code> &lt;code>mid-2-0&lt;/code> &lt;code>mid-2-1&lt;/code>这六个文件,其中&lt;code>mid-0-0&lt;/code> &lt;code>mid-0-1&lt;/code>为第一个文本Map操作后的到的切分开的两个中间数据文件，剩下的以此类推。&lt;/p>
&lt;p>在Reduce调度层中便会将这六个文件交由Reduce计算层处理，将件&lt;code>mid-0-0&lt;/code> &lt;code>mid-1-0&lt;/code> &lt;code>mid-2-0&lt;/code>交由编号为0的Reduce计算任务处理，显然，编号为1的任务则负责剩下3个文件的规约操作。Reduce调度层中仍然会将每个Reduce计算层任务得到的数据分别存入文件，根据Reduce任务的数量m为2，则文件编号分别为&lt;code>res-0&lt;/code> &lt;code>res-1&lt;/code>，这样Map、Reduce两种操作完成，但整个任务还为完成。&lt;/p>
&lt;p>Merge操作则是最后一个步骤通常由master来完成，通过merge操作将上述的&lt;code>res-0&lt;/code> &lt;code>res-1&lt;/code>合并，将所有结果存入到一个文件中，这样，整个MapReduce实现的多文本词频统计程序执行完毕。&lt;/p>
&lt;hr>
&lt;h2 id="数据结构">数据结构&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">type&lt;/span> &lt;span class="nx">KeyValue&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">Key&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;span class="nx">Value&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="实现">实现&lt;/h2>
&lt;h3 id="master调度">Master调度&lt;/h3>
&lt;p>&lt;strong>master.go&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">
&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">mr&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Master&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">jobName&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">files&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">nreduce&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">schedule&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">phase&lt;/span> &lt;span class="nx">jobPhase&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="nx">finish&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">mr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">jobName&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">jobName&lt;/span>
&lt;span class="nx">mr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">files&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">files&lt;/span>
&lt;span class="nx">mr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">nReduce&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">nreduce&lt;/span>
&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%s: Starting Map/Reduce task %s\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">mr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">address&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">mr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">jobName&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nf">schedule&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mapPhase&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//map层进行操作
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nf">schedule&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">reducePhase&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//reduce层进行操作
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nf">finish&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1">//结束所有worker
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">mr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">merge&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1">//合并
&lt;/span>&lt;span class="c1">&lt;/span>
&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%s: Map/Reduce task completed\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">mr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">address&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">mr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">doneChannel&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>这部分展示了master如何对map、reduce进行调度的过程，首先执行所有的map操作，执行完毕后执行所有的reduce操作进行规约，最后merge合并所有reduce之后的结果，把所有的结果汇总并存储。&lt;/p>
&lt;hr>
&lt;h3 id="map调度层">Map调度层&lt;/h3>
&lt;p>&lt;strong>common_map.go&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="nf">doMap&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="nx">jobName&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// MapReduce任务名
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">mapTaskNumber&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// Map任务序号
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">inFile&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">nReduce&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// Reduce Worker数量 (&amp;#34;R&amp;#34; in the paper)
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">mapF&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">file&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">contents&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">KeyValue&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">dat&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">ioutil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ReadFile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">inFile&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//读文本文件
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">res&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">mapF&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">inFile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dat&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1">//根据文件中的内容进行单文件Map操作
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">m&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">nReduce&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//对于每个文本文件，将使用KeyValue的slice来存放，之后会对这部分数据进行切分，根据nReduce（reduce层worker数量）来决定划分数目
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">kv&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">res&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">index&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">ihash&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">kv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Key&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="nx">nReduce&lt;/span> &lt;span class="c1">//序号划分，根据Key做hash处理，对结果模你Reduce得到划分序号
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">m&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">index&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">m&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">index&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">m&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">index&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="nx">kv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Key&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">kv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">nReduce&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">filename&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">reduceName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">jobName&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">mapTaskNumber&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">jsonObj&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Marshal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">m&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="c1">//使用json作为中间数据
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">ioutil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WriteFile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">filename&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">jsonObj&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mo">0644&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//将数据写入到文件中 //将json数据写入到文件中，供Reduce操作使用
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Map调度层提供数据的输入与输出，不关心计算过程&lt;/p>
&lt;hr>
&lt;h3 id="map计算层">Map计算层&lt;/h3>
&lt;p>&lt;strong>wc.go&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">//filename 为输入文件文件名
&lt;/span>&lt;span class="c1">//contents 为文本内容
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">mapF&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">filename&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">contents&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">mapreduce&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">KeyValue&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">res&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">mapreduce&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">KeyValue&lt;/span>
&lt;span class="nx">m&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">reg&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">regexp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">MustCompile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;\n|\r|\t|[ ]+|[\\-]+|\\(|\\)&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">contents&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">reg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ReplaceAllString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">contents&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34; &amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">reg&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">regexp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">MustCompile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[^(a-zA-Z )]&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">contents&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">reg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ReplaceAllString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">contents&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1">//fmt.Println(contents)
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">s&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">strings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">contents&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34; &amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">str&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">strings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">TrimSpace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">])&lt;/span>
&lt;span class="nx">m&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">strings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ToLower&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">str&lt;/span>&lt;span class="p">)]&lt;/span>&lt;span class="o">++&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">k&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">v&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">m&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">val&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">strconv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Itoa&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">v&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">res&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">res&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">mapreduce&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">KeyValue&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">val&lt;/span> &lt;span class="p">})&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">res&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Map计算层根据输入的文本内容完成下列步骤：&lt;/p>
&lt;ol>
&lt;li>使用正则表达式将&lt;code>\n&lt;/code> &lt;code>\t&lt;/code> &lt;code>\r&lt;/code>替换为空格&lt;/li>
&lt;li>使用正则表达式将无关字符删除&lt;/li>
&lt;li>使用&lt;code>strings.Split&lt;/code>方法根据空格进行划分&lt;/li>
&lt;li>取出划分后的每个词，使用&lt;code>strings.TrimSpace&lt;/code>方法去除两端空格，使用&lt;code>map[string] int&lt;/code>结构的m来完成统计&lt;/li>
&lt;li>将&lt;code>map[string] int&lt;/code>转换为&lt;code>[]KeyValue&lt;/code>返回&lt;/li>
&lt;/ol>
&lt;p>&lt;em>&lt;strong>Map计算层和Map调度层共同组成的Map的结构，一个负责计算，一个负责IO，分工明确&lt;/strong>&lt;/em>&lt;/p>
&lt;hr>
&lt;h3 id="reduce调度层">Reduce调度层&lt;/h3>
&lt;p>&lt;strong>common_reduce.go&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="nf">doReduce&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="nx">jobName&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// MapReduce任务名
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">reduceTaskNumber&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// Reduce任务序号
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">outFile&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 输出文件路径
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">nMap&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// Map任务数 (&amp;#34;M&amp;#34; in the paper)
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">reduceF&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">key&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">values&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">m&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">][]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">nMap&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">filename&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">reduceName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">jobName&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reduceTaskNumber&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">filename&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">ioutil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ReadFile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">filename&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">tm&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">string&lt;/span>
&lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unmarshal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">tm&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">v&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">tm&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">m&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">k&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">m&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">k&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="nx">v&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">dataM&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="nx">KeyValue&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">v&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">m&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">ans&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">reduceF&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">v&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">dataM&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dataM&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">KeyValue&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">k&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">ans&lt;/span>&lt;span class="p">})&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">jsonData&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Marshal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dataM&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">ioutil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WriteFile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">outFile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">jsonData&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mo">0644&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Reduce调度层完成的工作是将Map执行后的文件读入为数据交有Reduce来规约，同样也不负责Reduce具体的过程，仅负责数据的读入（文件读入）和数据的保存（文件写出）&lt;/p>
&lt;hr>
&lt;h3 id="reduce计算层">Reduce计算层&lt;/h3>
&lt;p>&lt;strong>wc.go&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">//key为文本中的单词
&lt;/span>&lt;span class="c1">//values为各个Map处理后得到的单词的个数
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">reduceF&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">key&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">values&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">sum&lt;/span> &lt;span class="o">:=&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">v&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">values&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">num&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">strconv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Atoi&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">v&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//string转int
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="kc">nil&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">sum&lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="nx">num&lt;/span> &lt;span class="c1">//累加
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">strconv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Itoa&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">sum&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//将int转string返回
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Reduce计算层则仅仅负责数据的规约，步骤如下：&lt;/p>
&lt;ol>
&lt;li>遍历整个values切片&lt;/li>
&lt;li>将values的数值累加&lt;/li>
&lt;li>将累加总和作为结果返回&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="merge">Merge&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">mr&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Master&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">merge&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">kvs&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//总的数据存放
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">mr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">nReduce&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">p&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">mergeName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">jobName&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//merge文件名生成
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">file&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span>&lt;span class="nx">ioutil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ReadFile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">p&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Merge: &amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">var&lt;/span> &lt;span class="nx">jsonObj&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">KeyValue&lt;/span>
&lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unmarshal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">file&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">jsonObj&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//json解码
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Merge: &amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">v&lt;/span>&lt;span class="o">:=&lt;/span>&lt;span class="k">range&lt;/span> &lt;span class="nx">jsonObj&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">kvs&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Key&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Value&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Merge操作便将Reduce操作得到的数据进行合并，完成最后一步工作。&lt;/p>
&lt;hr>
&lt;h2 id="总结">总结&lt;/h2>
&lt;p>通过这几天短暂的学习，MapReduce模型确实能够极大的利用现有计算资源来打造一个算力强劲的计算机集群，但是本实例中也存在几个局限性：&lt;/p>
&lt;ol>
&lt;li>本实例仅在单机中运行&lt;/li>
&lt;li>操作间数据交换使用文件，在性能上可能会有一定影响&lt;/li>
&lt;li>任务划分的科学性也应该是性能上应该考虑的问题，集群中计算机算力各不相同的时候，能者多劳，任务的划分应更加合理，才可能避免水桶原理造成的性能上的损失&lt;/li>
&lt;/ol>
&lt;p>如有不足之处，恳请提出批评！&lt;/p></description></item><item><title>Blog 第一帖 - 字符坑 BOM</title><link>https://www.catfish.top/p/bom/</link><pubDate>Wed, 18 May 2016 00:36:00 +0800</pubDate><guid>https://www.catfish.top/p/bom/</guid><description>&lt;img src="https://www.catfish.top/p/bom/bom.jpg" alt="Featured image of post Blog 第一帖 - 字符坑 BOM" />&lt;h2 id="字符编码">字符编码&lt;/h2>
&lt;p>字集码是把字符集中的字符编码为指定集合中某一对象（例如：比特模式、自然数序列、8位组或者电脉冲），以便文本在计算机中存储和通过通信网络的传递。&lt;/p>
&lt;p>常见的例子包括将拉丁字母表编码成摩斯电码和ASCII。其中，ASCII将字母、数字和其它符号编号，并用7比特的二进制来表示这个整数。通常会额外使用一个扩充的比特，以便于以1个字节的方式存储。
常见的字符编码有： ASCII、UTF-8、Unicode、GBK等&lt;/p>
&lt;p>详见&lt;a class="link" href="https://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81" target="_blank" rel="noopener"
>WikiPedia&lt;/a>&lt;/p>
&lt;hr>
&lt;h2 id="ascii">ASCII&lt;/h2>
&lt;p>&lt;strong>ASCII&lt;/strong> ( &lt;strong>A&lt;/strong> merican &lt;strong>S&lt;/strong> tandard &lt;strong>C&lt;/strong> ode for &lt;strong>I&lt;/strong> nformation &lt;strong>I&lt;/strong> nterchange) 即美国信息交换标准代码。&lt;/p>
&lt;p>ASCII第一次以规范标准的型态发表是在1967年，最后一次更新则是在1986年，至今为止共定义了128个字符；其中33个字符无法显示（一些终端提供了扩展，使得这些字符可显示为诸如笑脸、扑克牌花式等8-bit符号），且这33个字符多数都已是陈废的控制字符。控制字符的用途主要是用来操控已经处理过的文字。在33个字符之外的是95个可显示的字符，包含用键盘敲下空白键所产生的空白字符也算1个可显示字符（显示为空白）。&lt;/p>
&lt;p>ASCII的局限在于只能显示26个基本拉丁字母、阿拉伯数目字和英式标点符号，因此只能用于显示现代美国英语（而且在处理英语当中的外来词如naïve、café、élite等等时，所有重音符号都不得不去掉，即使这样做会违反拼写规则）。而EASCII虽然解决了部分西欧语言的显示问题，但对更多其他语言依然无能为力。因此现在的软件系统大多采用Unicode。&lt;/p>
&lt;p>详见&lt;a class="link" href="https://zh.wikipedia.org/wiki/ASCII" target="_blank" rel="noopener"
>WikiPedia&lt;/a>&lt;/p>
&lt;hr>
&lt;h2 id="unicode">Unicode&lt;/h2>
&lt;hr>
&lt;p>&lt;img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ab/Unicode_logo.svg/108px-Unicode_logo.svg.png" alt="Unicode" />&lt;/p>
&lt;p>&lt;strong>Unicode&lt;/strong> 是为了解决传统的字符编码方案的局限而产生的，例如ISO 8859-1所定义的字符虽然在不同的国家中广泛地使用，可是在不同国家间却经常出现不兼容的情况。&lt;/p>
&lt;p>很多传统的编码方式都有一个共同的问题，即容许电脑处理双语环境（通常使用拉丁字母以及其本地语言），但却无法同时支持多语言环境（指可同时处理多种语言混合的情况）。&lt;/p>
&lt;p>目前，几乎所有电脑系统都支持基本拉丁字母，并各自支持不同的其他编码方式。Unicode为了和它们相互兼容，其首256字符保留给ISO 8859-1所定义的字符，使既有的西欧语系文字的转换不需特别考量；并且把大量相同的字符重复编到不同的字符码中去，使得旧有纷杂的编码方式得以和Unicode编码间互相直接转换，而不会丢失任何信息。举例来说，全角格式区块包含了主要的拉丁字母的全角格式，在中文、日文、以及韩文字形当中，这些字符以全角的方式来呈现，而不以常见的半角形式显示，这对竖排文字和等宽排列文字有重要作用。&lt;/p>
&lt;p>详见&lt;a class="link" href="https://zh.wikipedia.org/wiki/Unicode" target="_blank" rel="noopener"
>WikiPedia&lt;/a>&lt;/p>
&lt;hr>
&lt;h2 id="utf-8">UTF-8&lt;/h2>
&lt;hr>
&lt;p>&lt;strong>UTF-8&lt;/strong> （8-bit Unicode Transformation Format）是一种针对Unicode的可变长度字符编码，也是一种前缀码。&lt;/p>
&lt;p>它可以用来表示Unicode标准中的任何字符，且其编码中的第一个字节仍与ASCII兼容，这使得原来处理ASCII字符的软件无须或只须做少部分修改，即可继续使用。因此，它逐渐成为电子邮件、网页及其他存储或发送文字的应用中，优先采用的编码。&lt;/p>
&lt;p>&lt;strong>UTF-8&lt;/strong> 现已经作为通用的字符编码，应用于各中网页编码，数据编码，数据库字符编码等。编码的统一能够写出的程序或网页在中文环境下大大减少乱码的出现。dddddddddddddddddd&lt;/p>
&lt;p>详见&lt;a class="link" href="https://zh.wikipedia.org/wiki/UTF-8" target="_blank" rel="noopener"
>WikiPedia&lt;/a>&lt;/p>
&lt;hr>
&lt;h2 id="gbk">GBK&lt;/h2>
&lt;hr>
&lt;p>&lt;strong>汉字内码扩展规范&lt;/strong> ，称GBK，全名为《汉字内码扩展规范(GBK)》1.0版，由中华人民共和国全国信息技术标准化技术委员会1995年12月1日制订，国家技术监督局标准化司和电子工业部科技与质量监督司1995年12月15日联合以《技术标函[1995]229号》文件的形式公布。&lt;/p>
&lt;p>GBK的K为汉语拼音Kuo Zhan（扩展）中“扩”字的声母。英文全称Chinese Internal Code Extension Specification。&lt;/p>
&lt;p>GBK 只为“技术规范指导性文件”，不属于国家标准。国家质量技术监督局于2000年3月17日推出了GB 18030-2000标准，以取代GBK。&lt;/p>
&lt;hr>
&lt;h2 id="bom--byte-order-mark--">BOM ( Byte Order Mark )&lt;/h2>
&lt;hr>
&lt;p>&lt;strong>这个才是重点，BOM头。&lt;/strong>&lt;/p>
&lt;p>在UTF-8编码文件中BOM在文件头部，占用三个字节，用来标示该文件属于UTF-8编码，现在已经有很多软件识别BOM头，但是还有些不能识别BOM头，比如Windows自带的记事本软件，这也是用记事本编辑UTF-8编码后执行就会出错的原因了。&lt;/p>
&lt;p>Windows下&lt;/p>
&lt;ul>
&lt;li>
&lt;p>支持BOM的编辑器
Notepad++&lt;/p>
&lt;/li>
&lt;li>
&lt;p>不支持BOM的编辑器
Windows自带的记事本 （&lt;strong>坑&lt;/strong>）&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>正因有BOM头的存在，使我在本地Jekyll的调试环境中，页面不能正常显示。&lt;/p>
&lt;p>&lt;strong>请使用Windows的童鞋一定注意该问题&lt;/strong>&lt;/p>
&lt;p>目前已经切换为 &lt;a class="link" href="https://github.com/gohugoio/hugo" target="_blank" rel="noopener"
>Hugo&lt;/a> + &lt;a class="link" href="https://github.com/features/actions" target="_blank" rel="noopener"
>GitHub Action&lt;/a> 的方式来完成静态网站的生成&lt;/p></description></item></channel></rss>